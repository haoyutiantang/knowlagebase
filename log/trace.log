2021-08-26 05:01:22.199 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2021-08-26 05:01:22.206 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :55   [32m                  [0;39m Starting KnowlagebaseApplication using Java 1.8.0_261 on DESKTOP-CTIIJC1 with PID 2588 (E:\code\java\knowlagebase\target\classes started by MECHREVO in E:\code\java\knowlagebase)
2021-08-26 05:01:22.207 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-08-26 05:01:22.252 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2021-08-26 05:01:22.253 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2021-08-26 05:01:23.122 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-08-26 05:01:23.124 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-08-26 05:01:23.141 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2021-08-26 05:01:23.766 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8880 (http)
2021-08-26 05:01:23.773 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8880"]
2021-08-26 05:01:23.774 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-08-26 05:01:23.774 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2021-08-26 05:01:23.836 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-08-26 05:01:23.837 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 1584 ms
2021-08-26 05:01:24.605 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2021-08-26 05:01:24.892 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2021-08-26 05:01:24.930 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2021-08-26 05:01:24.948 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8880"]
2021-08-26 05:01:24.960 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8880 (http) with context path ''
2021-08-26 05:01:24.970 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :61   [32m                  [0;39m Started KnowlagebaseApplication in 3.208 seconds (JVM running for 4.411)
2021-08-26 05:01:24.972 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :28   [32m                  [0;39m 启动成功！
2021-08-26 05:01:24.972 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :29   [32m                  [0;39m 地址：	http://127.0.0.1:8880
2021-08-26 05:01:25.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85840982200946688 [0;39m 生成今日电子书快照开始
2021-08-26 05:01:25.018 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m85840982200946688 [0;39m HikariPool-1 - Starting...
2021-08-26 05:01:25.963 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m85840982200946688 [0;39m HikariPool-1 - Start completed.
2021-08-26 05:01:25.970 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85840982200946688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:01:25.989 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85840982200946688 [0;39m ==> Parameters: 
2021-08-26 05:01:26.068 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85840982200946688 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:01:30.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841003164078080 [0;39m 生成今日电子书快照开始
2021-08-26 05:01:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841003164078080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:01:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841003164078080 [0;39m ==> Parameters: 
2021-08-26 05:01:30.013 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841003164078080 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:01:35.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85841024160763904 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:01:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841024160763904 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:01:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841024160763904 [0;39m ==> Parameters: 
2021-08-26 05:01:35.023 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841024160763904 [0;39m <==    Updates: 5
2021-08-26 05:01:35.023 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85841024160763904 [0;39m 更新电子书下的文档数据结束，耗时：14毫秒
2021-08-26 05:01:35.024 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841024223678464 [0;39m 生成今日电子书快照开始
2021-08-26 05:01:35.024 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841024223678464 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:01:35.025 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841024223678464 [0;39m ==> Parameters: 
2021-08-26 05:01:35.029 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841024223678464 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:01:40.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841045102923776 [0;39m 生成今日电子书快照开始
2021-08-26 05:01:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841045102923776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:01:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841045102923776 [0;39m ==> Parameters: 
2021-08-26 05:01:40.012 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841045102923776 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:01:45.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841066107998208 [0;39m 生成今日电子书快照开始
2021-08-26 05:01:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841066107998208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:01:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841066107998208 [0;39m ==> Parameters: 
2021-08-26 05:01:45.018 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841066107998208 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:01:50.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841087087906816 [0;39m 生成今日电子书快照开始
2021-08-26 05:01:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841087087906816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:01:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841087087906816 [0;39m ==> Parameters: 
2021-08-26 05:01:50.020 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841087087906816 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:01:55.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841108013289472 [0;39m 生成今日电子书快照开始
2021-08-26 05:01:55.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841108013289472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:01:55.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841108013289472 [0;39m ==> Parameters: 
2021-08-26 05:01:55.009 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841108013289472 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:02:00.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841128984809472 [0;39m 生成今日电子书快照开始
2021-08-26 05:02:00.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841128984809472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:02:00.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841128984809472 [0;39m ==> Parameters: 
2021-08-26 05:02:00.009 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841128984809472 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:02:05.001 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85841149956329472 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:02:05.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841149956329472 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:02:05.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841149956329472 [0;39m ==> Parameters: 
2021-08-26 05:02:05.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841149956329472 [0;39m <==    Updates: 5
2021-08-26 05:02:05.003 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85841149956329472 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:02:05.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841149968912384 [0;39m 生成今日电子书快照开始
2021-08-26 05:02:05.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841149968912384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:02:05.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841149968912384 [0;39m ==> Parameters: 
2021-08-26 05:02:05.012 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841149968912384 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:02:10.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841170953015296 [0;39m 生成今日电子书快照开始
2021-08-26 05:02:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841170953015296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:02:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841170953015296 [0;39m ==> Parameters: 
2021-08-26 05:02:10.015 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841170953015296 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:02:15.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841191941312512 [0;39m 生成今日电子书快照开始
2021-08-26 05:02:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841191941312512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:02:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841191941312512 [0;39m ==> Parameters: 
2021-08-26 05:02:15.022 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841191941312512 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:02:20.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841212921221120 [0;39m 生成今日电子书快照开始
2021-08-26 05:02:20.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841212921221120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:02:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841212921221120 [0;39m ==> Parameters: 
2021-08-26 05:02:20.021 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841212921221120 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:02:25.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841233888546816 [0;39m 生成今日电子书快照开始
2021-08-26 05:02:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841233888546816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:02:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841233888546816 [0;39m ==> Parameters: 
2021-08-26 05:02:25.021 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841233888546816 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:02:30.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841254860066816 [0;39m 生成今日电子书快照开始
2021-08-26 05:02:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841254860066816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:02:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841254860066816 [0;39m ==> Parameters: 
2021-08-26 05:02:30.022 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841254860066816 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:02:35.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85841275810615296 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:02:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841275810615296 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:02:35.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841275810615296 [0;39m ==> Parameters: 
2021-08-26 05:02:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841275810615296 [0;39m <==    Updates: 5
2021-08-26 05:02:35.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85841275810615296 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:02:35.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841275823198208 [0;39m 生成今日电子书快照开始
2021-08-26 05:02:35.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841275823198208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:02:35.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841275823198208 [0;39m ==> Parameters: 
2021-08-26 05:02:35.017 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841275823198208 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:02:40.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841296782135296 [0;39m 生成今日电子书快照开始
2021-08-26 05:02:40.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841296782135296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:02:40.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841296782135296 [0;39m ==> Parameters: 
2021-08-26 05:02:40.015 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841296782135296 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:02:45.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841317757849600 [0;39m 生成今日电子书快照开始
2021-08-26 05:02:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841317757849600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:02:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841317757849600 [0;39m ==> Parameters: 
2021-08-26 05:02:45.015 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841317757849600 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:02:50.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841338733563904 [0;39m 生成今日电子书快照开始
2021-08-26 05:02:50.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841338733563904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:02:50.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841338733563904 [0;39m ==> Parameters: 
2021-08-26 05:02:50.017 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841338733563904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:02:55.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841359705083904 [0;39m 生成今日电子书快照开始
2021-08-26 05:02:55.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841359705083904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:02:55.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841359705083904 [0;39m ==> Parameters: 
2021-08-26 05:02:55.020 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841359705083904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:03:00.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841380705964032 [0;39m 生成今日电子书快照开始
2021-08-26 05:03:00.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841380705964032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:03:00.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841380705964032 [0;39m ==> Parameters: 
2021-08-26 05:03:00.025 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841380705964032 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:03:05.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85841401660706816 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:03:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841401660706816 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:03:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841401660706816 [0;39m ==> Parameters: 
2021-08-26 05:03:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841401660706816 [0;39m <==    Updates: 5
2021-08-26 05:03:05.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85841401660706816 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:03:05.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841401669095424 [0;39m 生成今日电子书快照开始
2021-08-26 05:03:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841401669095424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:03:05.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841401669095424 [0;39m ==> Parameters: 
2021-08-26 05:03:05.021 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841401669095424 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:03:10.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841422602866688 [0;39m 生成今日电子书快照开始
2021-08-26 05:03:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841422602866688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:03:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841422602866688 [0;39m ==> Parameters: 
2021-08-26 05:03:10.011 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841422602866688 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:03:15.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841443599552512 [0;39m 生成今日电子书快照开始
2021-08-26 05:03:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841443599552512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:03:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841443599552512 [0;39m ==> Parameters: 
2021-08-26 05:03:15.019 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841443599552512 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:03:20.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841464529129472 [0;39m 生成今日电子书快照开始
2021-08-26 05:03:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841464529129472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:03:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841464529129472 [0;39m ==> Parameters: 
2021-08-26 05:03:20.011 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841464529129472 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:03:25.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841485513232384 [0;39m 生成今日电子书快照开始
2021-08-26 05:03:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841485513232384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:03:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841485513232384 [0;39m ==> Parameters: 
2021-08-26 05:03:25.013 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841485513232384 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:03:30.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841506501529600 [0;39m 生成今日电子书快照开始
2021-08-26 05:03:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841506501529600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:03:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841506501529600 [0;39m ==> Parameters: 
2021-08-26 05:03:30.015 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841506501529600 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:03:35.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85841527485632512 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:03:35.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841527485632512 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:03:35.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841527485632512 [0;39m ==> Parameters: 
2021-08-26 05:03:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841527485632512 [0;39m <==    Updates: 5
2021-08-26 05:03:35.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85841527485632512 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:03:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841527494021120 [0;39m 生成今日电子书快照开始
2021-08-26 05:03:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841527494021120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:03:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841527494021120 [0;39m ==> Parameters: 
2021-08-26 05:03:35.021 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841527494021120 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:03:40.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841548436180992 [0;39m 生成今日电子书快照开始
2021-08-26 05:03:40.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841548436180992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:03:40.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841548436180992 [0;39m ==> Parameters: 
2021-08-26 05:03:40.013 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841548436180992 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:03:45.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841569386729472 [0;39m 生成今日电子书快照开始
2021-08-26 05:03:45.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841569386729472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:03:45.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841569386729472 [0;39m ==> Parameters: 
2021-08-26 05:03:45.008 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841569386729472 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:03:50.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841590408581120 [0;39m 生成今日电子书快照开始
2021-08-26 05:03:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841590408581120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:03:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841590408581120 [0;39m ==> Parameters: 
2021-08-26 05:03:50.021 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841590408581120 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:03:55.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841611342352384 [0;39m 生成今日电子书快照开始
2021-08-26 05:03:55.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841611342352384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:03:55.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841611342352384 [0;39m ==> Parameters: 
2021-08-26 05:03:55.013 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841611342352384 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:04:00.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841632309678080 [0;39m 生成今日电子书快照开始
2021-08-26 05:04:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841632309678080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:04:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841632309678080 [0;39m ==> Parameters: 
2021-08-26 05:04:00.011 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841632309678080 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:04:05.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841653285392384 [0;39m 生成今日电子书快照开始
2021-08-26 05:04:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841653285392384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:04:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841653285392384 [0;39m ==> Parameters: 
2021-08-26 05:04:05.013 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841653285392384 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:04:05.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85841653327335424 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:04:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841653327335424 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:04:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841653327335424 [0;39m ==> Parameters: 
2021-08-26 05:04:05.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841653327335424 [0;39m <==    Updates: 5
2021-08-26 05:04:05.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85841653327335424 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 05:04:10.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841674298855424 [0;39m 生成今日电子书快照开始
2021-08-26 05:04:10.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841674298855424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:04:10.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841674298855424 [0;39m ==> Parameters: 
2021-08-26 05:04:10.021 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841674298855424 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:04:15.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841695232626688 [0;39m 生成今日电子书快照开始
2021-08-26 05:04:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841695232626688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:04:15.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841695232626688 [0;39m ==> Parameters: 
2021-08-26 05:04:15.014 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841695232626688 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:04:20.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841716204146688 [0;39m 生成今日电子书快照开始
2021-08-26 05:04:20.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841716204146688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:04:20.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841716204146688 [0;39m ==> Parameters: 
2021-08-26 05:04:20.013 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841716204146688 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:04:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841737196638208 [0;39m 生成今日电子书快照开始
2021-08-26 05:04:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841737196638208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:04:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841737196638208 [0;39m ==> Parameters: 
2021-08-26 05:04:25.017 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841737196638208 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:04:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841758147186688 [0;39m 生成今日电子书快照开始
2021-08-26 05:04:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841758147186688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:04:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841758147186688 [0;39m ==> Parameters: 
2021-08-26 05:04:30.012 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841758147186688 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:04:35.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841779148066816 [0;39m 生成今日电子书快照开始
2021-08-26 05:04:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841779148066816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:04:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841779148066816 [0;39m ==> Parameters: 
2021-08-26 05:04:35.019 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841779148066816 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:04:35.019 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85841779177426944 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:04:35.019 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841779177426944 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:04:35.019 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841779177426944 [0;39m ==> Parameters: 
2021-08-26 05:04:35.020 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841779177426944 [0;39m <==    Updates: 5
2021-08-26 05:04:35.020 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85841779177426944 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 05:04:40.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841800107003904 [0;39m 生成今日电子书快照开始
2021-08-26 05:04:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841800107003904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:04:40.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841800107003904 [0;39m ==> Parameters: 
2021-08-26 05:04:40.018 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841800107003904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:04:45.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841821061746688 [0;39m 生成今日电子书快照开始
2021-08-26 05:04:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841821061746688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:04:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841821061746688 [0;39m ==> Parameters: 
2021-08-26 05:04:45.013 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841821061746688 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:04:50.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841842050043904 [0;39m 生成今日电子书快照开始
2021-08-26 05:04:50.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841842050043904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:04:50.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841842050043904 [0;39m ==> Parameters: 
2021-08-26 05:04:50.016 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841842050043904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:04:55.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841862988009472 [0;39m 生成今日电子书快照开始
2021-08-26 05:04:55.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841862988009472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:04:55.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841862988009472 [0;39m ==> Parameters: 
2021-08-26 05:04:55.008 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841862988009472 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:05:00.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841884005666816 [0;39m 生成今日电子书快照开始
2021-08-26 05:05:00.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841884005666816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:05:00.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841884005666816 [0;39m ==> Parameters: 
2021-08-26 05:05:00.021 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841884005666816 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:05:05.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841904943632384 [0;39m 生成今日电子书快照开始
2021-08-26 05:05:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841904943632384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:05:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841904943632384 [0;39m ==> Parameters: 
2021-08-26 05:05:05.011 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841904943632384 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:05:05.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85841904977186816 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:05:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841904977186816 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:05:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841904977186816 [0;39m ==> Parameters: 
2021-08-26 05:05:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85841904977186816 [0;39m <==    Updates: 5
2021-08-26 05:05:05.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85841904977186816 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:05:10.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841925906763776 [0;39m 生成今日电子书快照开始
2021-08-26 05:05:10.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841925906763776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:05:10.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841925906763776 [0;39m ==> Parameters: 
2021-08-26 05:05:10.009 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841925906763776 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:05:15.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841946911838208 [0;39m 生成今日电子书快照开始
2021-08-26 05:05:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841946911838208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:05:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841946911838208 [0;39m ==> Parameters: 
2021-08-26 05:05:15.018 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841946911838208 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:05:20.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841967879163904 [0;39m 生成今日电子书快照开始
2021-08-26 05:05:20.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841967879163904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:05:20.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841967879163904 [0;39m ==> Parameters: 
2021-08-26 05:05:20.017 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841967879163904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:05:25.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85841988825518080 [0;39m 生成今日电子书快照开始
2021-08-26 05:05:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841988825518080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:05:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85841988825518080 [0;39m ==> Parameters: 
2021-08-26 05:05:25.010 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85841988825518080 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:05:30.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842009838981120 [0;39m 生成今日电子书快照开始
2021-08-26 05:05:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842009838981120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:05:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842009838981120 [0;39m ==> Parameters: 
2021-08-26 05:05:30.019 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842009838981120 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:05:35.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842030823084032 [0;39m 生成今日电子书快照开始
2021-08-26 05:05:35.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842030823084032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:05:35.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842030823084032 [0;39m ==> Parameters: 
2021-08-26 05:05:35.023 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842030823084032 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:05:35.023 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85842030852444160 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:05:35.023 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842030852444160 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:05:35.023 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842030852444160 [0;39m ==> Parameters: 
2021-08-26 05:05:35.024 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842030852444160 [0;39m <==    Updates: 5
2021-08-26 05:05:35.024 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85842030852444160 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 05:05:40.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842051735883776 [0;39m 生成今日电子书快照开始
2021-08-26 05:05:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842051735883776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:05:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842051735883776 [0;39m ==> Parameters: 
2021-08-26 05:05:40.007 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842051735883776 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:05:45.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842072761929728 [0;39m 生成今日电子书快照开始
2021-08-26 05:05:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842072761929728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:05:45.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842072761929728 [0;39m ==> Parameters: 
2021-08-26 05:05:45.023 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842072761929728 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:05:50.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842093674729472 [0;39m 生成今日电子书快照开始
2021-08-26 05:05:50.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842093674729472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:05:50.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842093674729472 [0;39m ==> Parameters: 
2021-08-26 05:05:50.008 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842093674729472 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:05:55.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842114704969728 [0;39m 生成今日电子书快照开始
2021-08-26 05:05:55.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842114704969728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:05:55.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842114704969728 [0;39m ==> Parameters: 
2021-08-26 05:05:55.023 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842114704969728 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:06:00.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842135651323904 [0;39m 生成今日电子书快照开始
2021-08-26 05:06:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842135651323904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:06:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842135651323904 [0;39m ==> Parameters: 
2021-08-26 05:06:00.017 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842135651323904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:06:05.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85842156635426816 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:06:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842156635426816 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:06:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842156635426816 [0;39m ==> Parameters: 
2021-08-26 05:06:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842156635426816 [0;39m <==    Updates: 5
2021-08-26 05:06:05.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85842156635426816 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:06:05.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842156643815424 [0;39m 生成今日电子书快照开始
2021-08-26 05:06:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842156643815424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:06:05.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842156643815424 [0;39m ==> Parameters: 
2021-08-26 05:06:05.022 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842156643815424 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:06:10.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842177573392384 [0;39m 生成今日电子书快照开始
2021-08-26 05:06:10.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842177573392384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:06:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842177573392384 [0;39m ==> Parameters: 
2021-08-26 05:06:10.010 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842177573392384 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:06:15.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842198561689600 [0;39m 生成今日电子书快照开始
2021-08-26 05:06:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842198561689600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:06:15.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842198561689600 [0;39m ==> Parameters: 
2021-08-26 05:06:15.016 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842198561689600 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:06:20.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842219512238080 [0;39m 生成今日电子书快照开始
2021-08-26 05:06:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842219512238080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:06:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842219512238080 [0;39m ==> Parameters: 
2021-08-26 05:06:20.012 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842219512238080 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:06:25.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842240479563776 [0;39m 生成今日电子书快照开始
2021-08-26 05:06:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842240479563776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:06:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842240479563776 [0;39m ==> Parameters: 
2021-08-26 05:06:25.012 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842240479563776 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:08:02.369 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2021-08-26 05:08:02.371 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :55   [32m                  [0;39m Starting KnowlagebaseApplication using Java 1.8.0_261 on DESKTOP-CTIIJC1 with PID 17668 (E:\code\java\knowlagebase\target\classes started by MECHREVO in E:\code\java\knowlagebase)
2021-08-26 05:08:02.372 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-08-26 05:08:02.411 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2021-08-26 05:08:02.412 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2021-08-26 05:08:02.818 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-08-26 05:08:02.819 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-08-26 05:08:02.831 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 3 ms. Found 0 Redis repository interfaces.
2021-08-26 05:08:03.306 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8880 (http)
2021-08-26 05:08:03.311 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8880"]
2021-08-26 05:08:03.312 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-08-26 05:08:03.312 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2021-08-26 05:08:03.363 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-08-26 05:08:03.364 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 952 ms
2021-08-26 05:08:03.976 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2021-08-26 05:08:04.245 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2021-08-26 05:08:04.279 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2021-08-26 05:08:04.296 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8880"]
2021-08-26 05:08:04.307 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8880 (http) with context path ''
2021-08-26 05:08:04.316 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :61   [32m                  [0;39m Started KnowlagebaseApplication in 2.297 seconds (JVM running for 3.32)
2021-08-26 05:08:04.318 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :28   [32m                  [0;39m 启动成功！
2021-08-26 05:08:04.318 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :29   [32m                  [0;39m 地址：	http://127.0.0.1:8880
2021-08-26 05:08:05.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85842659918352384 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:08:05.020 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m85842659918352384 [0;39m HikariPool-1 - Starting...
2021-08-26 05:08:05.745 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m85842659918352384 [0;39m HikariPool-1 - Start completed.
2021-08-26 05:08:05.749 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842659918352384 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:08:05.764 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842659918352384 [0;39m ==> Parameters: 
2021-08-26 05:08:05.766 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842659918352384 [0;39m <==    Updates: 5
2021-08-26 05:08:05.767 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85842659918352384 [0;39m 更新电子书下的文档数据结束，耗时：763毫秒
2021-08-26 05:08:05.767 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842663118606336 [0;39m 生成今日电子书快照开始
2021-08-26 05:08:05.768 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842663118606336 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:08:05.769 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842663118606336 [0;39m ==> Parameters: 
2021-08-26 05:08:05.807 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842663118606336 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:08:10.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842680936009728 [0;39m 生成今日电子书快照开始
2021-08-26 05:08:10.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842680936009728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:08:10.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842680936009728 [0;39m ==> Parameters: 
2021-08-26 05:08:10.021 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842680936009728 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:08:15.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842701853003776 [0;39m 生成今日电子书快照开始
2021-08-26 05:08:15.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842701853003776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:08:15.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842701853003776 [0;39m ==> Parameters: 
2021-08-26 05:08:15.010 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842701853003776 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:08:20.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842722853883904 [0;39m 生成今日电子书快照开始
2021-08-26 05:08:20.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842722853883904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:08:20.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842722853883904 [0;39m ==> Parameters: 
2021-08-26 05:08:20.017 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842722853883904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:08:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842743829598208 [0;39m 生成今日电子书快照开始
2021-08-26 05:08:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842743829598208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:08:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842743829598208 [0;39m ==> Parameters: 
2021-08-26 05:08:25.018 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842743829598208 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:08:30.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842764813701120 [0;39m 生成今日电子书快照开始
2021-08-26 05:08:30.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842764813701120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:08:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842764813701120 [0;39m ==> Parameters: 
2021-08-26 05:08:30.020 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842764813701120 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:08:35.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842785764249600 [0;39m 生成今日电子书快照开始
2021-08-26 05:08:35.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842785764249600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:08:35.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842785764249600 [0;39m ==> Parameters: 
2021-08-26 05:08:35.016 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842785764249600 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:08:35.017 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85842785801998336 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:08:35.017 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842785801998336 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:08:35.017 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842785801998336 [0;39m ==> Parameters: 
2021-08-26 05:08:35.018 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842785801998336 [0;39m <==    Updates: 5
2021-08-26 05:08:35.019 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85842785801998336 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:08:40.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842806769324032 [0;39m 生成今日电子书快照开始
2021-08-26 05:08:40.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842806769324032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:08:40.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842806769324032 [0;39m ==> Parameters: 
2021-08-26 05:08:40.060 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842806769324032 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:08:45.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842827740844032 [0;39m 生成今日电子书快照开始
2021-08-26 05:08:45.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842827740844032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:08:45.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842827740844032 [0;39m ==> Parameters: 
2021-08-26 05:08:45.025 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842827740844032 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:08:50.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842848683003904 [0;39m 生成今日电子书快照开始
2021-08-26 05:08:50.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842848683003904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:08:50.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842848683003904 [0;39m ==> Parameters: 
2021-08-26 05:08:50.017 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842848683003904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:08:55.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842869679689728 [0;39m 生成今日电子书快照开始
2021-08-26 05:08:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842869679689728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:08:55.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842869679689728 [0;39m ==> Parameters: 
2021-08-26 05:08:55.023 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842869679689728 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:09:00.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842890617655296 [0;39m 生成今日电子书快照开始
2021-08-26 05:09:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842890617655296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:09:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842890617655296 [0;39m ==> Parameters: 
2021-08-26 05:09:00.015 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842890617655296 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:09:05.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842911564009472 [0;39m 生成今日电子书快照开始
2021-08-26 05:09:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842911564009472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:09:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842911564009472 [0;39m ==> Parameters: 
2021-08-26 05:09:05.011 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842911564009472 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:09:05.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85842911605952512 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:09:05.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842911605952512 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:09:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842911605952512 [0;39m ==> Parameters: 
2021-08-26 05:09:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85842911605952512 [0;39m <==    Updates: 5
2021-08-26 05:09:05.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85842911605952512 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:09:10.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842932560695296 [0;39m 生成今日电子书快照开始
2021-08-26 05:09:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842932560695296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:09:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842932560695296 [0;39m ==> Parameters: 
2021-08-26 05:09:10.016 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842932560695296 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:09:15.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842953519632384 [0;39m 生成今日电子书快照开始
2021-08-26 05:09:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842953519632384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:09:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842953519632384 [0;39m ==> Parameters: 
2021-08-26 05:09:15.014 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842953519632384 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:09:20.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842974537289728 [0;39m 生成今日电子书快照开始
2021-08-26 05:09:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842974537289728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:09:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842974537289728 [0;39m ==> Parameters: 
2021-08-26 05:09:20.026 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842974537289728 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:09:25.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85842995475255296 [0;39m 生成今日电子书快照开始
2021-08-26 05:09:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842995475255296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:09:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85842995475255296 [0;39m ==> Parameters: 
2021-08-26 05:09:25.015 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85842995475255296 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:09:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843016442580992 [0;39m 生成今日电子书快照开始
2021-08-26 05:09:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843016442580992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:09:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843016442580992 [0;39m ==> Parameters: 
2021-08-26 05:09:30.015 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843016442580992 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:09:35.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843037409906688 [0;39m 生成今日电子书快照开始
2021-08-26 05:09:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843037409906688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:09:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843037409906688 [0;39m ==> Parameters: 
2021-08-26 05:09:35.013 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843037409906688 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:09:35.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85843037443461120 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:09:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85843037443461120 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:09:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85843037443461120 [0;39m ==> Parameters: 
2021-08-26 05:09:35.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85843037443461120 [0;39m <==    Updates: 5
2021-08-26 05:09:35.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85843037443461120 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:09:40.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843058423369728 [0;39m 生成今日电子书快照开始
2021-08-26 05:09:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843058423369728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:09:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843058423369728 [0;39m ==> Parameters: 
2021-08-26 05:09:40.025 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843058423369728 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:09:45.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843079369723904 [0;39m 生成今日电子书快照开始
2021-08-26 05:09:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843079369723904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:09:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843079369723904 [0;39m ==> Parameters: 
2021-08-26 05:09:45.054 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843079369723904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:09:50.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843100345438208 [0;39m 生成今日电子书快照开始
2021-08-26 05:09:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843100345438208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:09:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843100345438208 [0;39m ==> Parameters: 
2021-08-26 05:09:50.020 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843100345438208 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:09:55.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843121295986688 [0;39m 生成今日电子书快照开始
2021-08-26 05:09:55.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843121295986688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:09:55.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843121295986688 [0;39m ==> Parameters: 
2021-08-26 05:09:55.052 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843121295986688 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:10:00.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843142305255424 [0;39m 生成今日电子书快照开始
2021-08-26 05:10:00.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843142305255424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:10:00.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843142305255424 [0;39m ==> Parameters: 
2021-08-26 05:10:00.025 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843142305255424 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:10:05.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843163268386816 [0;39m 生成今日电子书快照开始
2021-08-26 05:10:05.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843163268386816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:10:05.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843163268386816 [0;39m ==> Parameters: 
2021-08-26 05:10:05.058 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843163268386816 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:10:05.058 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85843163461324800 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:10:05.059 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85843163461324800 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:10:05.059 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85843163461324800 [0;39m ==> Parameters: 
2021-08-26 05:10:05.060 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85843163461324800 [0;39m <==    Updates: 5
2021-08-26 05:10:05.060 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85843163461324800 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:10:10.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843184256684032 [0;39m 生成今日电子书快照开始
2021-08-26 05:10:10.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843184256684032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:10:10.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843184256684032 [0;39m ==> Parameters: 
2021-08-26 05:10:10.059 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843184256684032 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:10:15.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843205207232512 [0;39m 生成今日电子书快照开始
2021-08-26 05:10:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843205207232512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:10:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843205207232512 [0;39m ==> Parameters: 
2021-08-26 05:10:15.018 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843205207232512 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:10:20.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843226149392384 [0;39m 生成今日电子书快照开始
2021-08-26 05:10:20.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843226149392384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:10:20.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843226149392384 [0;39m ==> Parameters: 
2021-08-26 05:10:20.010 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843226149392384 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:10:25.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843247150272512 [0;39m 生成今日电子书快照开始
2021-08-26 05:10:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843247150272512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:10:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843247150272512 [0;39m ==> Parameters: 
2021-08-26 05:10:25.056 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843247150272512 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:10:30.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843268088238080 [0;39m 生成今日电子书快照开始
2021-08-26 05:10:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843268088238080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:10:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843268088238080 [0;39m ==> Parameters: 
2021-08-26 05:10:30.011 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843268088238080 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:10:35.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843289105895424 [0;39m 生成今日电子书快照开始
2021-08-26 05:10:35.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843289105895424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:10:35.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843289105895424 [0;39m ==> Parameters: 
2021-08-26 05:10:35.020 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843289105895424 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:10:35.020 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85843289131061248 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:10:35.020 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85843289131061248 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:10:35.020 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85843289131061248 [0;39m ==> Parameters: 
2021-08-26 05:10:35.021 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85843289131061248 [0;39m <==    Updates: 5
2021-08-26 05:10:35.022 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85843289131061248 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:10:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843310077415424 [0;39m 生成今日电子书快照开始
2021-08-26 05:10:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843310077415424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:10:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843310077415424 [0;39m ==> Parameters: 
2021-08-26 05:10:40.024 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843310077415424 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:10:45.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843331032158208 [0;39m 生成今日电子书快照开始
2021-08-26 05:10:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843331032158208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:10:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843331032158208 [0;39m ==> Parameters: 
2021-08-26 05:10:45.017 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843331032158208 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:10:50.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85843352020455424 [0;39m 生成今日电子书快照开始
2021-08-26 05:10:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843352020455424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:10:50.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85843352020455424 [0;39m ==> Parameters: 
2021-08-26 05:10:50.021 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85843352020455424 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:15:03.934 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :55   [32m                  [0;39m Starting KnowlagebaseApplication using Java 1.8.0_261 on DESKTOP-CTIIJC1 with PID 9944 (E:\code\java\knowlagebase\target\classes started by MECHREVO in E:\code\java\knowlagebase)
2021-08-26 05:15:03.934 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2021-08-26 05:15:03.937 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-08-26 05:15:03.982 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2021-08-26 05:15:03.982 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2021-08-26 05:15:04.428 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-08-26 05:15:04.430 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-08-26 05:15:04.441 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 3 ms. Found 0 Redis repository interfaces.
2021-08-26 05:15:04.945 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8880 (http)
2021-08-26 05:15:04.951 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8880"]
2021-08-26 05:15:04.952 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-08-26 05:15:04.952 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2021-08-26 05:15:05.011 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-08-26 05:15:05.012 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 1029 ms
2021-08-26 05:15:05.653 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2021-08-26 05:15:05.953 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2021-08-26 05:15:05.992 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2021-08-26 05:15:06.010 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8880"]
2021-08-26 05:15:06.023 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8880 (http) with context path ''
2021-08-26 05:15:06.032 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :61   [32m                  [0;39m Started KnowlagebaseApplication in 2.491 seconds (JVM running for 3.641)
2021-08-26 05:15:06.034 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :28   [32m                  [0;39m 启动成功！
2021-08-26 05:15:06.034 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :29   [32m                  [0;39m 地址：	http://127.0.0.1:8880
2021-08-26 05:15:10.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844442543689728 [0;39m 生成今日电子书快照开始
2021-08-26 05:15:10.026 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m85844442543689728 [0;39m HikariPool-1 - Starting...
2021-08-26 05:15:10.775 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m85844442543689728 [0;39m HikariPool-1 - Start completed.
2021-08-26 05:15:10.781 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844442543689728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:15:10.798 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844442543689728 [0;39m ==> Parameters: 
2021-08-26 05:15:10.839 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844442543689728 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:15:15.000 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844463452295168 [0;39m 生成今日电子书快照开始
2021-08-26 05:15:15.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844463452295168 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:15:15.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844463452295168 [0;39m ==> Parameters: 
2021-08-26 05:15:15.009 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844463452295168 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:15:20.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844484486729728 [0;39m 生成今日电子书快照开始
2021-08-26 05:15:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844484486729728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:15:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844484486729728 [0;39m ==> Parameters: 
2021-08-26 05:15:20.022 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844484486729728 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:15:25.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844505462444032 [0;39m 生成今日电子书快照开始
2021-08-26 05:15:25.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844505462444032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:15:25.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844505462444032 [0;39m ==> Parameters: 
2021-08-26 05:15:25.024 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844505462444032 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:15:30.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844526400409600 [0;39m 生成今日电子书快照开始
2021-08-26 05:15:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844526400409600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:15:30.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844526400409600 [0;39m ==> Parameters: 
2021-08-26 05:15:30.018 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844526400409600 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:15:35.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844547359346688 [0;39m 生成今日电子书快照开始
2021-08-26 05:15:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844547359346688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:15:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844547359346688 [0;39m ==> Parameters: 
2021-08-26 05:15:35.012 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844547359346688 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:15:35.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85844547388706816 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:15:35.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85844547388706816 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:15:35.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85844547388706816 [0;39m ==> Parameters: 
2021-08-26 05:15:35.017 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85844547388706816 [0;39m <==    Updates: 5
2021-08-26 05:15:35.018 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85844547388706816 [0;39m 更新电子书下的文档数据结束，耗时：6毫秒
2021-08-26 05:15:40.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844568326672384 [0;39m 生成今日电子书快照开始
2021-08-26 05:15:40.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844568326672384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:15:40.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844568326672384 [0;39m ==> Parameters: 
2021-08-26 05:15:40.013 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844568326672384 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:15:45.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844589306580992 [0;39m 生成今日电子书快照开始
2021-08-26 05:15:45.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844589306580992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:15:45.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844589306580992 [0;39m ==> Parameters: 
2021-08-26 05:15:45.015 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844589306580992 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:15:50.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844610273906688 [0;39m 生成今日电子书快照开始
2021-08-26 05:15:50.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844610273906688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:15:50.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844610273906688 [0;39m ==> Parameters: 
2021-08-26 05:15:50.014 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844610273906688 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:15:55.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844631262203904 [0;39m 生成今日电子书快照开始
2021-08-26 05:15:55.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844631262203904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:15:55.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844631262203904 [0;39m ==> Parameters: 
2021-08-26 05:15:55.055 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844631262203904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:16:00.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844652242112512 [0;39m 生成今日电子书快照开始
2021-08-26 05:16:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844652242112512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:16:00.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844652242112512 [0;39m ==> Parameters: 
2021-08-26 05:16:00.020 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844652242112512 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:16:05.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844673205243904 [0;39m 生成今日电子书快照开始
2021-08-26 05:16:05.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844673205243904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:16:05.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844673205243904 [0;39m ==> Parameters: 
2021-08-26 05:16:05.053 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844673205243904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:16:05.053 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85844673389793280 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:16:05.053 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85844673389793280 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:16:05.054 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85844673389793280 [0;39m ==> Parameters: 
2021-08-26 05:16:05.055 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85844673389793280 [0;39m <==    Updates: 5
2021-08-26 05:16:05.055 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85844673389793280 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:16:10.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844694168375296 [0;39m 生成今日电子书快照开始
2021-08-26 05:16:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844694168375296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:16:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844694168375296 [0;39m ==> Parameters: 
2021-08-26 05:16:10.052 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844694168375296 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:16:15.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844715118923776 [0;39m 生成今日电子书快照开始
2021-08-26 05:16:15.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844715118923776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:16:15.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844715118923776 [0;39m ==> Parameters: 
2021-08-26 05:16:15.047 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844715118923776 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:16:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844736140775424 [0;39m 生成今日电子书快照开始
2021-08-26 05:16:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844736140775424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:16:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844736140775424 [0;39m ==> Parameters: 
2021-08-26 05:16:20.023 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844736140775424 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:16:25.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844757116489728 [0;39m 生成今日电子书快照开始
2021-08-26 05:16:25.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844757116489728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:16:25.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844757116489728 [0;39m ==> Parameters: 
2021-08-26 05:16:25.060 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844757116489728 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:16:30.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844778071232512 [0;39m 生成今日电子书快照开始
2021-08-26 05:16:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844778071232512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:16:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844778071232512 [0;39m ==> Parameters: 
2021-08-26 05:16:30.021 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844778071232512 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:16:35.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85844799042752512 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:16:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85844799042752512 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:16:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85844799042752512 [0;39m ==> Parameters: 
2021-08-26 05:16:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85844799042752512 [0;39m <==    Updates: 5
2021-08-26 05:16:35.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85844799042752512 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:16:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844799051141120 [0;39m 生成今日电子书快照开始
2021-08-26 05:16:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844799051141120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:16:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844799051141120 [0;39m ==> Parameters: 
2021-08-26 05:16:35.021 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844799051141120 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:16:40.000 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844819968135168 [0;39m 生成今日电子书快照开始
2021-08-26 05:16:40.000 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844819968135168 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:16:40.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844819968135168 [0;39m ==> Parameters: 
2021-08-26 05:16:40.008 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844819968135168 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:16:45.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844840969015296 [0;39m 生成今日电子书快照开始
2021-08-26 05:16:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844840969015296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:16:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844840969015296 [0;39m ==> Parameters: 
2021-08-26 05:16:45.017 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844840969015296 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:16:50.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844861953118208 [0;39m 生成今日电子书快照开始
2021-08-26 05:16:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844861953118208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:16:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844861953118208 [0;39m ==> Parameters: 
2021-08-26 05:16:50.016 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844861953118208 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:16:55.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844882924638208 [0;39m 生成今日电子书快照开始
2021-08-26 05:16:55.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844882924638208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:16:55.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844882924638208 [0;39m ==> Parameters: 
2021-08-26 05:16:55.020 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844882924638208 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:17:00.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844903858409472 [0;39m 生成今日电子书快照开始
2021-08-26 05:17:00.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844903858409472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:17:00.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844903858409472 [0;39m ==> Parameters: 
2021-08-26 05:17:00.048 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844903858409472 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:17:05.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85844924850900992 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:17:05.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85844924850900992 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:17:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85844924850900992 [0;39m ==> Parameters: 
2021-08-26 05:17:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85844924850900992 [0;39m <==    Updates: 5
2021-08-26 05:17:05.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85844924850900992 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:17:05.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844924859289600 [0;39m 生成今日电子书快照开始
2021-08-26 05:17:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844924859289600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:17:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844924859289600 [0;39m ==> Parameters: 
2021-08-26 05:17:05.015 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844924859289600 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:17:10.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844945855975424 [0;39m 生成今日电子书快照开始
2021-08-26 05:17:10.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844945855975424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:17:10.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844945855975424 [0;39m ==> Parameters: 
2021-08-26 05:17:10.020 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844945855975424 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:17:15.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844966802329600 [0;39m 生成今日电子书快照开始
2021-08-26 05:17:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844966802329600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:17:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844966802329600 [0;39m ==> Parameters: 
2021-08-26 05:17:15.017 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844966802329600 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:17:20.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85844987786432512 [0;39m 生成今日电子书快照开始
2021-08-26 05:17:20.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844987786432512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:17:20.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85844987786432512 [0;39m ==> Parameters: 
2021-08-26 05:17:20.018 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85844987786432512 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:17:25.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845008741175296 [0;39m 生成今日电子书快照开始
2021-08-26 05:17:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845008741175296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:17:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845008741175296 [0;39m ==> Parameters: 
2021-08-26 05:17:25.015 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845008741175296 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:17:30.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845029746249728 [0;39m 生成今日电子书快照开始
2021-08-26 05:17:30.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845029746249728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:17:30.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845029746249728 [0;39m ==> Parameters: 
2021-08-26 05:17:30.023 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845029746249728 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:17:35.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845050667438080 [0;39m 生成今日电子书快照开始
2021-08-26 05:17:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845050667438080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:17:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845050667438080 [0;39m ==> Parameters: 
2021-08-26 05:17:35.009 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845050667438080 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:17:35.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85845050696798208 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:17:35.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845050696798208 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:17:35.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845050696798208 [0;39m ==> Parameters: 
2021-08-26 05:17:35.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845050696798208 [0;39m <==    Updates: 5
2021-08-26 05:17:35.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85845050696798208 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 05:17:40.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845071647346688 [0;39m 生成今日电子书快照开始
2021-08-26 05:17:40.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845071647346688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:17:40.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845071647346688 [0;39m ==> Parameters: 
2021-08-26 05:17:40.014 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845071647346688 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:17:45.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845092652421120 [0;39m 生成今日电子书快照开始
2021-08-26 05:17:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845092652421120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:17:45.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845092652421120 [0;39m ==> Parameters: 
2021-08-26 05:17:45.029 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845092652421120 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:17:50.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845113615552512 [0;39m 生成今日电子书快照开始
2021-08-26 05:17:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845113615552512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:17:50.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845113615552512 [0;39m ==> Parameters: 
2021-08-26 05:17:50.017 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845113615552512 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:17:55.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845134578683904 [0;39m 生成今日电子书快照开始
2021-08-26 05:17:55.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845134578683904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:17:55.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845134578683904 [0;39m ==> Parameters: 
2021-08-26 05:17:55.017 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845134578683904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:18:00.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845155520843776 [0;39m 生成今日电子书快照开始
2021-08-26 05:18:00.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845155520843776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:18:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845155520843776 [0;39m ==> Parameters: 
2021-08-26 05:18:00.009 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845155520843776 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:18:05.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845176542695424 [0;39m 生成今日电子书快照开始
2021-08-26 05:18:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845176542695424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:18:05.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845176542695424 [0;39m ==> Parameters: 
2021-08-26 05:18:05.022 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845176542695424 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:18:05.022 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85845176576249856 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:18:05.022 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845176576249856 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:18:05.022 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845176576249856 [0;39m ==> Parameters: 
2021-08-26 05:18:05.023 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845176576249856 [0;39m <==    Updates: 5
2021-08-26 05:18:05.024 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85845176576249856 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:18:10.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845197497438208 [0;39m 生成今日电子书快照开始
2021-08-26 05:18:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845197497438208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:18:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845197497438208 [0;39m ==> Parameters: 
2021-08-26 05:18:10.019 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845197497438208 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:18:15.000 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845218427015168 [0;39m 生成今日电子书快照开始
2021-08-26 05:18:15.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845218427015168 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:18:15.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845218427015168 [0;39m ==> Parameters: 
2021-08-26 05:18:15.043 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845218427015168 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:18:20.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845239402729472 [0;39m 生成今日电子书快照开始
2021-08-26 05:18:20.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845239402729472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:18:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845239402729472 [0;39m ==> Parameters: 
2021-08-26 05:18:20.009 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845239402729472 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:18:25.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845260428775424 [0;39m 生成今日电子书快照开始
2021-08-26 05:18:25.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845260428775424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:18:25.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845260428775424 [0;39m ==> Parameters: 
2021-08-26 05:18:25.061 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845260428775424 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:18:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845281366740992 [0;39m 生成今日电子书快照开始
2021-08-26 05:18:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845281366740992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:18:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845281366740992 [0;39m ==> Parameters: 
2021-08-26 05:18:30.013 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845281366740992 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:18:35.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85845302359232512 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:18:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845302359232512 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:18:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845302359232512 [0;39m ==> Parameters: 
2021-08-26 05:18:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845302359232512 [0;39m <==    Updates: 5
2021-08-26 05:18:35.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85845302359232512 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:18:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845302367621120 [0;39m 生成今日电子书快照开始
2021-08-26 05:18:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845302367621120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:18:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845302367621120 [0;39m ==> Parameters: 
2021-08-26 05:18:35.058 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845302367621120 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:18:40.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845323288809472 [0;39m 生成今日电子书快照开始
2021-08-26 05:18:40.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845323288809472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:18:40.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845323288809472 [0;39m ==> Parameters: 
2021-08-26 05:18:40.044 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845323288809472 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:18:45.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845344306466816 [0;39m 生成今日电子书快照开始
2021-08-26 05:18:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845344306466816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:18:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845344306466816 [0;39m ==> Parameters: 
2021-08-26 05:18:45.020 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845344306466816 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:18:50.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845365277986816 [0;39m 生成今日电子书快照开始
2021-08-26 05:18:50.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845365277986816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:18:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845365277986816 [0;39m ==> Parameters: 
2021-08-26 05:18:50.020 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845365277986816 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:18:55.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845386249506816 [0;39m 生成今日电子书快照开始
2021-08-26 05:18:55.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845386249506816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:18:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845386249506816 [0;39m ==> Parameters: 
2021-08-26 05:18:55.018 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845386249506816 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:19:00.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845407237804032 [0;39m 生成今日电子书快照开始
2021-08-26 05:19:00.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845407237804032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:19:00.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845407237804032 [0;39m ==> Parameters: 
2021-08-26 05:19:00.024 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845407237804032 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:19:05.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845428188352512 [0;39m 生成今日电子书快照开始
2021-08-26 05:19:05.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845428188352512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:19:05.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845428188352512 [0;39m ==> Parameters: 
2021-08-26 05:19:05.019 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845428188352512 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:19:05.019 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85845428221906944 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:19:05.020 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845428221906944 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:19:05.020 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845428221906944 [0;39m ==> Parameters: 
2021-08-26 05:19:05.021 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845428221906944 [0;39m <==    Updates: 5
2021-08-26 05:19:05.021 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85845428221906944 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:19:10.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845449130512384 [0;39m 生成今日电子书快照开始
2021-08-26 05:19:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845449130512384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:19:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845449130512384 [0;39m ==> Parameters: 
2021-08-26 05:19:10.013 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845449130512384 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:19:15.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845470135586816 [0;39m 生成今日电子书快照开始
2021-08-26 05:19:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845470135586816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:19:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845470135586816 [0;39m ==> Parameters: 
2021-08-26 05:19:15.021 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845470135586816 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:19:20.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845491119689728 [0;39m 生成今日电子书快照开始
2021-08-26 05:19:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845491119689728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:19:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845491119689728 [0;39m ==> Parameters: 
2021-08-26 05:19:20.059 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845491119689728 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:19:25.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845512066043904 [0;39m 生成今日电子书快照开始
2021-08-26 05:19:25.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845512066043904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:19:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845512066043904 [0;39m ==> Parameters: 
2021-08-26 05:19:25.017 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845512066043904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:19:30.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845533037563904 [0;39m 生成今日电子书快照开始
2021-08-26 05:19:30.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845533037563904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:19:30.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845533037563904 [0;39m ==> Parameters: 
2021-08-26 05:19:30.016 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845533037563904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:19:35.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85845554030055424 [0;39m 生成今日电子书快照开始
2021-08-26 05:19:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845554030055424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:19:35.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85845554030055424 [0;39m ==> Parameters: 
2021-08-26 05:19:35.021 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85845554030055424 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.GeneratedMethodAccessor66.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.GeneratedMethodAccessor61.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.GeneratedMethodAccessor60.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 21 common frames omitted
2021-08-26 05:19:35.021 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85845554059415552 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:19:35.021 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845554059415552 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:19:35.021 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845554059415552 [0;39m ==> Parameters: 
2021-08-26 05:19:35.022 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85845554059415552 [0;39m <==    Updates: 5
2021-08-26 05:19:35.022 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85845554059415552 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 05:21:40.196 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :55   [32m                  [0;39m Starting KnowlagebaseApplication using Java 1.8.0_261 on DESKTOP-CTIIJC1 with PID 3660 (E:\code\java\knowlagebase\target\classes started by MECHREVO in E:\code\java\knowlagebase)
2021-08-26 05:21:40.196 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2021-08-26 05:21:40.198 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-08-26 05:21:40.238 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2021-08-26 05:21:40.238 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2021-08-26 05:21:40.654 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-08-26 05:21:40.656 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-08-26 05:21:40.668 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 3 ms. Found 0 Redis repository interfaces.
2021-08-26 05:21:41.148 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8880 (http)
2021-08-26 05:21:41.153 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8880"]
2021-08-26 05:21:41.154 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-08-26 05:21:41.154 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2021-08-26 05:21:41.211 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-08-26 05:21:41.211 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 972 ms
2021-08-26 05:21:41.866 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2021-08-26 05:21:42.176 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2021-08-26 05:21:42.214 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2021-08-26 05:21:42.232 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8880"]
2021-08-26 05:21:42.245 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8880 (http) with context path ''
2021-08-26 05:21:42.255 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :61   [32m                  [0;39m Started KnowlagebaseApplication in 2.437 seconds (JVM running for 3.551)
2021-08-26 05:21:42.257 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :28   [32m                  [0;39m 启动成功！
2021-08-26 05:21:42.258 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :29   [32m                  [0;39m 地址：	http://127.0.0.1:8880
2021-08-26 05:21:45.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846099289575424 [0;39m 生成今日电子书快照开始
2021-08-26 05:21:45.027 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m85846099289575424 [0;39m HikariPool-1 - Starting...
2021-08-26 05:21:45.634 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m85846099289575424 [0;39m HikariPool-1 - Start completed.
2021-08-26 05:21:45.638 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846099289575424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:21:45.652 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846099289575424 [0;39m ==> Parameters: 
2021-08-26 05:21:45.690 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85846099289575424 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:21:50.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846120206569472 [0;39m 生成今日电子书快照开始
2021-08-26 05:21:50.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846120206569472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:21:50.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846120206569472 [0;39m ==> Parameters: 
2021-08-26 05:21:50.009 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85846120206569472 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:21:55.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846141203255296 [0;39m 生成今日电子书快照开始
2021-08-26 05:21:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846141203255296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:21:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846141203255296 [0;39m ==> Parameters: 
2021-08-26 05:21:55.016 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85846141203255296 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:22:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846162166386688 [0;39m 生成今日电子书快照开始
2021-08-26 05:22:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846162166386688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:22:00.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846162166386688 [0;39m ==> Parameters: 
2021-08-26 05:22:00.014 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85846162166386688 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:22:05.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85846183179849728 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:22:05.019 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85846183179849728 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:22:05.019 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85846183179849728 [0;39m ==> Parameters: 
2021-08-26 05:22:05.020 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85846183179849728 [0;39m <==    Updates: 5
2021-08-26 05:22:05.020 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85846183179849728 [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-08-26 05:22:05.020 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846183200821248 [0;39m 生成今日电子书快照开始
2021-08-26 05:22:05.021 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846183200821248 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:22:05.021 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846183200821248 [0;39m ==> Parameters: 
2021-08-26 05:22:05.028 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85846183200821248 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate());          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:22:33.348 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :55   [32m                  [0;39m Starting KnowlagebaseApplication using Java 1.8.0_261 on DESKTOP-CTIIJC1 with PID 3240 (E:\code\java\knowlagebase\target\classes started by MECHREVO in E:\code\java\knowlagebase)
2021-08-26 05:22:33.346 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2021-08-26 05:22:33.349 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-08-26 05:22:33.383 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2021-08-26 05:22:33.383 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2021-08-26 05:22:33.797 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-08-26 05:22:33.799 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-08-26 05:22:33.810 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 3 ms. Found 0 Redis repository interfaces.
2021-08-26 05:22:34.292 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8880 (http)
2021-08-26 05:22:34.296 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8880"]
2021-08-26 05:22:34.297 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-08-26 05:22:34.297 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2021-08-26 05:22:34.348 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-08-26 05:22:34.348 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 964 ms
2021-08-26 05:22:34.945 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2021-08-26 05:22:35.229 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2021-08-26 05:22:35.264 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2021-08-26 05:22:35.282 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8880"]
2021-08-26 05:22:35.293 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8880 (http) with context path ''
2021-08-26 05:22:35.303 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :61   [32m                  [0;39m Started KnowlagebaseApplication in 2.298 seconds (JVM running for 3.289)
2021-08-26 05:22:35.305 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :28   [32m                  [0;39m 启动成功！
2021-08-26 05:22:35.305 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :29   [32m                  [0;39m 地址：	http://127.0.0.1:8880
2021-08-26 05:22:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846329976295424 [0;39m 生成今日电子书快照开始
2021-08-26 05:22:40.024 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m85846329976295424 [0;39m HikariPool-1 - Starting...
2021-08-26 05:22:40.628 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m85846329976295424 [0;39m HikariPool-1 - Start completed.
2021-08-26 05:22:40.633 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846329976295424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:22:40.646 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846329976295424 [0;39m ==> Parameters: 
2021-08-26 05:22:40.662 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846329976295424 [0;39m <==    Updates: 0
2021-08-26 05:22:40.663 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846329976295424 [0;39m 生成今日电子书快照结束，耗时：649毫秒
2021-08-26 05:22:45.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846350910066688 [0;39m 生成今日电子书快照开始
2021-08-26 05:22:45.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846350910066688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:22:45.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846350910066688 [0;39m ==> Parameters: 
2021-08-26 05:22:45.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846350910066688 [0;39m <==    Updates: 0
2021-08-26 05:22:45.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846350910066688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:22:50.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846371877392384 [0;39m 生成今日电子书快照开始
2021-08-26 05:22:50.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846371877392384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:22:50.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846371877392384 [0;39m ==> Parameters: 
2021-08-26 05:22:50.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846371877392384 [0;39m <==    Updates: 0
2021-08-26 05:22:50.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846371877392384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 05:22:55.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846392890855424 [0;39m 生成今日电子书快照开始
2021-08-26 05:22:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846392890855424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:22:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846392890855424 [0;39m ==> Parameters: 
2021-08-26 05:22:55.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846392890855424 [0;39m <==    Updates: 0
2021-08-26 05:22:55.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846392890855424 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:23:00.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846413853986816 [0;39m 生成今日电子书快照开始
2021-08-26 05:23:00.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846413853986816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:23:00.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846413853986816 [0;39m ==> Parameters: 
2021-08-26 05:23:00.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846413853986816 [0;39m <==    Updates: 0
2021-08-26 05:23:00.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846413853986816 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:23:05.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85846434796146688 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:23:05.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85846434796146688 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:23:05.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85846434796146688 [0;39m ==> Parameters: 
2021-08-26 05:23:05.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85846434796146688 [0;39m <==    Updates: 5
2021-08-26 05:23:05.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85846434796146688 [0;39m 更新电子书下的文档数据结束，耗时：6毫秒
2021-08-26 05:23:05.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846434821312512 [0;39m 生成今日电子书快照开始
2021-08-26 05:23:05.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846434821312512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:23:05.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846434821312512 [0;39m ==> Parameters: 
2021-08-26 05:23:05.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846434821312512 [0;39m <==    Updates: 0
2021-08-26 05:23:05.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846434821312512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 05:23:10.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846455792832512 [0;39m 生成今日电子书快照开始
2021-08-26 05:23:10.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846455792832512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:23:10.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846455792832512 [0;39m ==> Parameters: 
2021-08-26 05:23:10.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846455792832512 [0;39m <==    Updates: 0
2021-08-26 05:23:10.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846455792832512 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:23:15.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846476743380992 [0;39m 生成今日电子书快照开始
2021-08-26 05:23:15.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846476743380992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:23:15.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846476743380992 [0;39m ==> Parameters: 
2021-08-26 05:23:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846476743380992 [0;39m <==    Updates: 0
2021-08-26 05:23:15.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846476743380992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 05:23:20.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846497710706688 [0;39m 生成今日电子书快照开始
2021-08-26 05:23:20.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846497710706688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:23:20.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846497710706688 [0;39m ==> Parameters: 
2021-08-26 05:23:20.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846497710706688 [0;39m <==    Updates: 0
2021-08-26 05:23:20.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846497710706688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:23:25.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846518699003904 [0;39m 生成今日电子书快照开始
2021-08-26 05:23:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846518699003904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:23:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846518699003904 [0;39m ==> Parameters: 
2021-08-26 05:23:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846518699003904 [0;39m <==    Updates: 0
2021-08-26 05:23:25.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846518699003904 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:23:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846539657940992 [0;39m 生成今日电子书快照开始
2021-08-26 05:23:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846539657940992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:23:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846539657940992 [0;39m ==> Parameters: 
2021-08-26 05:23:30.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846539657940992 [0;39m <==    Updates: 0
2021-08-26 05:23:30.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846539657940992 [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-08-26 05:23:35.003 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85846560616878080 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:23:35.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85846560616878080 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:23:35.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85846560616878080 [0;39m ==> Parameters: 
2021-08-26 05:23:35.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85846560616878080 [0;39m <==    Updates: 5
2021-08-26 05:23:35.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85846560616878080 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:23:35.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846560625266688 [0;39m 生成今日电子书快照开始
2021-08-26 05:23:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846560625266688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:23:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846560625266688 [0;39m ==> Parameters: 
2021-08-26 05:23:35.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846560625266688 [0;39m <==    Updates: 0
2021-08-26 05:23:35.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846560625266688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 05:23:40.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846581626146816 [0;39m 生成今日电子书快照开始
2021-08-26 05:23:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846581626146816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:23:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846581626146816 [0;39m ==> Parameters: 
2021-08-26 05:23:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846581626146816 [0;39m <==    Updates: 0
2021-08-26 05:23:40.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846581626146816 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:23:45.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846602580889600 [0;39m 生成今日电子书快照开始
2021-08-26 05:23:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846602580889600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:23:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846602580889600 [0;39m ==> Parameters: 
2021-08-26 05:23:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846602580889600 [0;39m <==    Updates: 0
2021-08-26 05:23:45.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846602580889600 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:23:50.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846623548215296 [0;39m 生成今日电子书快照开始
2021-08-26 05:23:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846623548215296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:23:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846623548215296 [0;39m ==> Parameters: 
2021-08-26 05:23:50.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846623548215296 [0;39m <==    Updates: 0
2021-08-26 05:23:50.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846623548215296 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:23:55.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846644553289728 [0;39m 生成今日电子书快照开始
2021-08-26 05:23:55.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846644553289728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:23:55.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846644553289728 [0;39m ==> Parameters: 
2021-08-26 05:23:55.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846644553289728 [0;39m <==    Updates: 0
2021-08-26 05:23:55.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846644553289728 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:24:00.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846665466089472 [0;39m 生成今日电子书快照开始
2021-08-26 05:24:00.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846665466089472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:24:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846665466089472 [0;39m ==> Parameters: 
2021-08-26 05:24:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846665466089472 [0;39m <==    Updates: 0
2021-08-26 05:24:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846665466089472 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:24:05.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846686454386688 [0;39m 生成今日电子书快照开始
2021-08-26 05:24:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846686454386688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:24:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846686454386688 [0;39m ==> Parameters: 
2021-08-26 05:24:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846686454386688 [0;39m <==    Updates: 0
2021-08-26 05:24:05.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846686454386688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:24:05.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85846686466969600 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:24:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85846686466969600 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:24:05.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85846686466969600 [0;39m ==> Parameters: 
2021-08-26 05:24:05.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85846686466969600 [0;39m <==    Updates: 5
2021-08-26 05:24:05.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85846686466969600 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 05:24:10.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846707455266816 [0;39m 生成今日电子书快照开始
2021-08-26 05:24:10.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846707455266816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:24:10.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846707455266816 [0;39m ==> Parameters: 
2021-08-26 05:24:10.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846707455266816 [0;39m <==    Updates: 0
2021-08-26 05:24:10.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846707455266816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 05:24:15.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85846728435175424 [0;39m 生成今日电子书快照开始
2021-08-26 05:24:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846728435175424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:24:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846728435175424 [0;39m ==> Parameters: 
2021-08-26 05:24:15.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85846728435175424 [0;39m <==    Updates: 0
2021-08-26 05:24:15.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85846728435175424 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:31:41.092 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :55   [32m                  [0;39m Starting KnowlagebaseApplication using Java 1.8.0_261 on DESKTOP-CTIIJC1 with PID 2604 (E:\code\java\knowlagebase\target\classes started by MECHREVO in E:\code\java\knowlagebase)
2021-08-26 05:31:41.091 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2021-08-26 05:31:41.094 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-08-26 05:31:41.132 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2021-08-26 05:31:41.133 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2021-08-26 05:31:41.543 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-08-26 05:31:41.545 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-08-26 05:31:41.556 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 3 ms. Found 0 Redis repository interfaces.
2021-08-26 05:31:42.064 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8880 (http)
2021-08-26 05:31:42.070 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8880"]
2021-08-26 05:31:42.071 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-08-26 05:31:42.071 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2021-08-26 05:31:42.132 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-08-26 05:31:42.132 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 999 ms
2021-08-26 05:31:42.806 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2021-08-26 05:31:43.123 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2021-08-26 05:31:43.167 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2021-08-26 05:31:43.193 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8880"]
2021-08-26 05:31:43.207 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8880 (http) with context path ''
2021-08-26 05:31:43.219 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :61   [32m                  [0;39m Started KnowlagebaseApplication in 2.468 seconds (JVM running for 3.535)
2021-08-26 05:31:43.222 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :28   [32m                  [0;39m 启动成功！
2021-08-26 05:31:43.222 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :29   [32m                  [0;39m 地址：	http://127.0.0.1:8880
2021-08-26 05:31:45.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85848615846809600 [0;39m 生成今日电子书快照开始
2021-08-26 05:31:45.019 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m85848615846809600 [0;39m HikariPool-1 - Starting...
2021-08-26 05:31:45.618 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m85848615846809600 [0;39m HikariPool-1 - Start completed.
2021-08-26 05:31:45.623 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848615846809600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:31:45.637 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848615846809600 [0;39m ==> Parameters: 
2021-08-26 05:31:45.682 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85848615846809600 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:31:50.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85848636809940992 [0;39m 生成今日电子书快照开始
2021-08-26 05:31:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848636809940992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:31:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848636809940992 [0;39m ==> Parameters: 
2021-08-26 05:31:50.016 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85848636809940992 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:31:55.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85848657789849600 [0;39m 生成今日电子书快照开始
2021-08-26 05:31:55.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848657789849600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:31:55.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848657789849600 [0;39m ==> Parameters: 
2021-08-26 05:31:55.015 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85848657789849600 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:32:00.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85848678757175296 [0;39m 生成今日电子书快照开始
2021-08-26 05:32:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848678757175296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:32:00.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848678757175296 [0;39m ==> Parameters: 
2021-08-26 05:32:00.016 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85848678757175296 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:32:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85848699728695296 [0;39m 生成今日电子书快照开始
2021-08-26 05:32:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848699728695296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:32:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848699728695296 [0;39m ==> Parameters: 
2021-08-26 05:32:05.016 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85848699728695296 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:32:05.017 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85848699770638336 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:32:05.020 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85848699770638336 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:32:05.020 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85848699770638336 [0;39m ==> Parameters: 
2021-08-26 05:32:05.022 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85848699770638336 [0;39m <==    Updates: 5
2021-08-26 05:32:05.022 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85848699770638336 [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-08-26 05:32:10.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85848720675049472 [0;39m 生成今日电子书快照开始
2021-08-26 05:32:10.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848720675049472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:32:10.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848720675049472 [0;39m ==> Parameters: 
2021-08-26 05:32:10.006 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85848720675049472 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:32:15.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85848741667540992 [0;39m 生成今日电子书快照开始
2021-08-26 05:32:15.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848741667540992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:32:15.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848741667540992 [0;39m ==> Parameters: 
2021-08-26 05:32:15.014 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85848741667540992 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:32:20.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85848762676809728 [0;39m 生成今日电子书快照开始
2021-08-26 05:32:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848762676809728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:32:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848762676809728 [0;39m ==> Parameters: 
2021-08-26 05:32:20.023 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85848762676809728 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:32:25.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85848783639941120 [0;39m 生成今日电子书快照开始
2021-08-26 05:32:25.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848783639941120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:32:25.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848783639941120 [0;39m ==> Parameters: 
2021-08-26 05:32:25.019 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85848783639941120 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:32:30.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85848804586295296 [0;39m 生成今日电子书快照开始
2021-08-26 05:32:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848804586295296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:32:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848804586295296 [0;39m ==> Parameters: 
2021-08-26 05:32:30.014 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85848804586295296 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:32:55.187 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2021-08-26 05:32:55.190 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :55   [32m                  [0;39m Starting KnowlagebaseApplication using Java 1.8.0_261 on DESKTOP-CTIIJC1 with PID 6352 (E:\code\java\knowlagebase\target\classes started by MECHREVO in E:\code\java\knowlagebase)
2021-08-26 05:32:55.190 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-08-26 05:32:55.232 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2021-08-26 05:32:55.233 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2021-08-26 05:32:55.668 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-08-26 05:32:55.670 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-08-26 05:32:55.683 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2021-08-26 05:32:56.188 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8880 (http)
2021-08-26 05:32:56.194 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8880"]
2021-08-26 05:32:56.195 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-08-26 05:32:56.195 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2021-08-26 05:32:56.251 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-08-26 05:32:56.251 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 1018 ms
2021-08-26 05:32:56.919 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2021-08-26 05:32:57.255 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2021-08-26 05:32:57.297 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2021-08-26 05:32:57.317 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8880"]
2021-08-26 05:32:57.330 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8880 (http) with context path ''
2021-08-26 05:32:57.340 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :61   [32m                  [0;39m Started KnowlagebaseApplication in 2.506 seconds (JVM running for 3.598)
2021-08-26 05:32:57.342 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :28   [32m                  [0;39m 启动成功！
2021-08-26 05:32:57.342 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :29   [32m                  [0;39m 地址：	http://127.0.0.1:8880
2021-08-26 05:33:00.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85848930402832384 [0;39m 生成今日电子书快照开始
2021-08-26 05:33:00.015 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m85848930402832384 [0;39m HikariPool-1 - Starting...
2021-08-26 05:33:00.622 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m85848930402832384 [0;39m HikariPool-1 - Start completed.
2021-08-26 05:33:00.629 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848930402832384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); # update ebook_snapshot t1, ebook t2 # set t1.view_count = t2.view_count, # t1.vote_count = t2.vote_count # where t1.`date` = curdate() # and t1.ebook_id = t2.id; # # update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count # from ebook_snapshot # where `date` = date_sub(curdate(), interval 1 day)) t2 # on t1.ebook_id = t2.ebook_id # set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), # t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) # where t1.`date` = curdate();
2021-08-26 05:33:00.641 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848930402832384 [0;39m ==> Parameters: 
2021-08-26 05:33:00.643 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848930402832384 [0;39m <==    Updates: 0
2021-08-26 05:33:00.645 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85848930402832384 [0;39m 生成今日电子书快照结束，耗时：641毫秒
2021-08-26 05:33:05.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85848951395323904 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:33:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85848951395323904 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:33:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85848951395323904 [0;39m ==> Parameters: 
2021-08-26 05:33:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85848951395323904 [0;39m <==    Updates: 5
2021-08-26 05:33:05.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85848951395323904 [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-08-26 05:33:05.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85848951416295424 [0;39m 生成今日电子书快照开始
2021-08-26 05:33:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848951416295424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); # update ebook_snapshot t1, ebook t2 # set t1.view_count = t2.view_count, # t1.vote_count = t2.vote_count # where t1.`date` = curdate() # and t1.ebook_id = t2.id; # # update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count # from ebook_snapshot # where `date` = date_sub(curdate(), interval 1 day)) t2 # on t1.ebook_id = t2.ebook_id # set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), # t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) # where t1.`date` = curdate();
2021-08-26 05:33:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848951416295424 [0;39m ==> Parameters: 
2021-08-26 05:33:05.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848951416295424 [0;39m <==    Updates: 0
2021-08-26 05:33:05.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85848951416295424 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 05:33:10.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85848972371038208 [0;39m 生成今日电子书快照开始
2021-08-26 05:33:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848972371038208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); # update ebook_snapshot t1, ebook t2 # set t1.view_count = t2.view_count, # t1.vote_count = t2.vote_count # where t1.`date` = curdate() # and t1.ebook_id = t2.id; # # update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count # from ebook_snapshot # where `date` = date_sub(curdate(), interval 1 day)) t2 # on t1.ebook_id = t2.ebook_id # set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), # t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) # where t1.`date` = curdate();
2021-08-26 05:33:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848972371038208 [0;39m ==> Parameters: 
2021-08-26 05:33:10.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85848972371038208 [0;39m <==    Updates: 0
2021-08-26 05:33:10.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85848972371038208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 05:33:34.944 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2021-08-26 05:33:34.947 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :55   [32m                  [0;39m Starting KnowlagebaseApplication using Java 1.8.0_261 on DESKTOP-CTIIJC1 with PID 20108 (E:\code\java\knowlagebase\target\classes started by MECHREVO in E:\code\java\knowlagebase)
2021-08-26 05:33:34.947 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-08-26 05:33:34.984 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2021-08-26 05:33:34.984 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2021-08-26 05:33:35.386 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-08-26 05:33:35.387 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-08-26 05:33:35.399 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2021-08-26 05:33:35.893 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8880 (http)
2021-08-26 05:33:35.899 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8880"]
2021-08-26 05:33:35.900 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-08-26 05:33:35.900 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2021-08-26 05:33:35.963 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-08-26 05:33:35.963 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 979 ms
2021-08-26 05:33:36.617 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2021-08-26 05:33:36.934 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2021-08-26 05:33:36.977 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2021-08-26 05:33:37.003 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8880"]
2021-08-26 05:33:37.017 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8880 (http) with context path ''
2021-08-26 05:33:37.028 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :61   [32m                  [0;39m Started KnowlagebaseApplication in 2.435 seconds (JVM running for 3.523)
2021-08-26 05:33:37.030 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :28   [32m                  [0;39m 启动成功！
2021-08-26 05:33:37.031 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :29   [32m                  [0;39m 地址：	http://127.0.0.1:8880
2021-08-26 05:33:40.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85849098162409472 [0;39m 生成今日电子书快照开始
2021-08-26 05:33:40.012 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m85849098162409472 [0;39m HikariPool-1 - Starting...
2021-08-26 05:33:40.621 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m85849098162409472 [0;39m HikariPool-1 - Start completed.
2021-08-26 05:33:40.625 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849098162409472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; # update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count # from ebook_snapshot # where `date` = date_sub(curdate(), interval 1 day)) t2 # on t1.ebook_id = t2.ebook_id # set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), # t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) # where t1.`date` = curdate();
2021-08-26 05:33:40.639 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849098162409472 [0;39m ==> Parameters: 
2021-08-26 05:33:40.677 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85849098162409472 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;  #         update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count #                                             from ebook_snapshot #                                             where `date` = date_sub(curdate(), interval 1 day)) t2 #             on t1.ebook_id = t2.ebook_id #         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), #             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) #         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:33:45.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85849119138123776 [0;39m 生成今日电子书快照开始
2021-08-26 05:33:45.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849119138123776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; # update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count # from ebook_snapshot # where `date` = date_sub(curdate(), interval 1 day)) t2 # on t1.ebook_id = t2.ebook_id # set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), # t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) # where t1.`date` = curdate();
2021-08-26 05:33:45.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849119138123776 [0;39m ==> Parameters: 
2021-08-26 05:33:45.011 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85849119138123776 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;  #         update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count #                                             from ebook_snapshot #                                             where `date` = date_sub(curdate(), interval 1 day)) t2 #             on t1.ebook_id = t2.ebook_id #         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), #             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) #         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:34:41.947 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2021-08-26 05:34:41.949 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :55   [32m                  [0;39m Starting KnowlagebaseApplication using Java 1.8.0_261 on DESKTOP-CTIIJC1 with PID 20348 (E:\code\java\knowlagebase\target\classes started by MECHREVO in E:\code\java\knowlagebase)
2021-08-26 05:34:41.950 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-08-26 05:34:41.986 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2021-08-26 05:34:41.987 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2021-08-26 05:34:42.429 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-08-26 05:34:42.430 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-08-26 05:34:42.442 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 3 ms. Found 0 Redis repository interfaces.
2021-08-26 05:34:42.941 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8880 (http)
2021-08-26 05:34:42.946 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8880"]
2021-08-26 05:34:42.947 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-08-26 05:34:42.947 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2021-08-26 05:34:43.009 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-08-26 05:34:43.009 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 1022 ms
2021-08-26 05:34:43.660 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2021-08-26 05:34:43.980 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2021-08-26 05:34:44.025 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2021-08-26 05:34:44.052 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8880"]
2021-08-26 05:34:44.065 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8880 (http) with context path ''
2021-08-26 05:34:44.080 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :61   [32m                  [0;39m Started KnowlagebaseApplication in 2.473 seconds (JVM running for 3.52)
2021-08-26 05:34:44.082 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :28   [32m                  [0;39m 启动成功！
2021-08-26 05:34:44.082 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :29   [32m                  [0;39m 地址：	http://127.0.0.1:8880
2021-08-26 05:34:45.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85849370838306816 [0;39m 生成今日电子书快照开始
2021-08-26 05:34:45.022 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m85849370838306816 [0;39m HikariPool-1 - Starting...
2021-08-26 05:34:45.633 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m85849370838306816 [0;39m HikariPool-1 - Start completed.
2021-08-26 05:34:45.637 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849370838306816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); # update ebook_snapshot t1, ebook t2 # set t1.view_count = t2.view_count, # t1.vote_count = t2.vote_count # where t1.`date` = curdate() # and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:34:45.649 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849370838306816 [0;39m ==> Parameters: 
2021-08-26 05:34:45.651 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849370838306816 [0;39m <==    Updates: 0
2021-08-26 05:34:45.652 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85849370838306816 [0;39m 生成今日电子书快照结束，耗时：640毫秒
2021-08-26 05:34:50.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85849391809826816 [0;39m 生成今日电子书快照开始
2021-08-26 05:34:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849391809826816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); # update ebook_snapshot t1, ebook t2 # set t1.view_count = t2.view_count, # t1.vote_count = t2.vote_count # where t1.`date` = curdate() # and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:34:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849391809826816 [0;39m ==> Parameters: 
2021-08-26 05:34:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849391809826816 [0;39m <==    Updates: 0
2021-08-26 05:34:50.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85849391809826816 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:35:29.977 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2021-08-26 05:35:29.979 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :55   [32m                  [0;39m Starting KnowlagebaseApplication using Java 1.8.0_261 on DESKTOP-CTIIJC1 with PID 2712 (E:\code\java\knowlagebase\target\classes started by MECHREVO in E:\code\java\knowlagebase)
2021-08-26 05:35:29.980 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-08-26 05:35:30.015 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2021-08-26 05:35:30.015 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2021-08-26 05:35:30.429 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-08-26 05:35:30.430 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-08-26 05:35:30.443 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2021-08-26 05:35:30.947 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8880 (http)
2021-08-26 05:35:30.953 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8880"]
2021-08-26 05:35:30.953 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-08-26 05:35:30.954 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2021-08-26 05:35:31.014 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-08-26 05:35:31.015 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 999 ms
2021-08-26 05:35:31.673 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2021-08-26 05:35:31.977 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2021-08-26 05:35:32.029 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2021-08-26 05:35:32.051 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8880"]
2021-08-26 05:35:32.065 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8880 (http) with context path ''
2021-08-26 05:35:32.077 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :61   [32m                  [0;39m Started KnowlagebaseApplication in 2.446 seconds (JVM running for 3.518)
2021-08-26 05:35:32.079 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :28   [32m                  [0;39m 启动成功！
2021-08-26 05:35:32.079 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :29   [32m                  [0;39m 地址：	http://127.0.0.1:8880
2021-08-26 05:35:35.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85849580528340992 [0;39m 生成今日电子书快照开始
2021-08-26 05:35:35.017 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m85849580528340992 [0;39m HikariPool-1 - Starting...
2021-08-26 05:35:35.636 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m85849580528340992 [0;39m HikariPool-1 - Start completed.
2021-08-26 05:35:35.641 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849580528340992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:35:35.654 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849580528340992 [0;39m ==> Parameters: 
2021-08-26 05:35:35.696 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85849580528340992 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:35:35.696 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85849583422410752 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:35:35.699 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85849583422410752 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:35:35.700 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85849583422410752 [0;39m ==> Parameters: 
2021-08-26 05:35:35.701 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85849583422410752 [0;39m <==    Updates: 5
2021-08-26 05:35:35.701 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85849583422410752 [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-08-26 05:35:40.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85849601512443904 [0;39m 生成今日电子书快照开始
2021-08-26 05:35:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849601512443904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:35:40.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849601512443904 [0;39m ==> Parameters: 
2021-08-26 05:35:40.017 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85849601512443904 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:35:45.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85849622504935424 [0;39m 生成今日电子书快照开始
2021-08-26 05:35:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849622504935424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:35:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849622504935424 [0;39m ==> Parameters: 
2021-08-26 05:35:45.023 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85849622504935424 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:35:50.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85849643463872512 [0;39m 生成今日电子书快照开始
2021-08-26 05:35:50.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849643463872512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:35:50.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849643463872512 [0;39m ==> Parameters: 
2021-08-26 05:35:50.019 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85849643463872512 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:35:55.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85849664418615296 [0;39m 生成今日电子书快照开始
2021-08-26 05:35:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849664418615296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) (select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate())); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:35:55.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85849664418615296 [0;39m ==> Parameters: 
2021-08-26 05:35:55.016 ERROR o.s.s.support.TaskUtils$LoggingErrorHandler       :95   [32m85849664418615296 [0;39m Unexpected error occurred in scheduled task
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
### The error may exist in file [E:\code\java\knowlagebase\target\classes\mapper\EbookSnapshotMapperCust.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase)         (select t1.id, curdate(), 0, 0, 0, 0         from ebook t1         where not exists(select 1                          from ebook_snapshot t2                          where t1.id = t2.ebook_id                            and t2.`date` = curdate()));          update ebook_snapshot t1, ebook t2         set t1.view_count = t2.view_count,             t1.vote_count = t2.vote_count         where t1.`date` = curdate()           and t1.ebook_id = t2.id;          update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count                                             from ebook_snapshot                                             where `date` = date_sub(curdate(), interval 1 day)) t2             on t1.ebook_id = t2.ebook_id         set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)),             t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0))         where t1.`date` = curdate();
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
; Column 'view_count' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440)
	at com.sun.proxy.$Proxy91.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:287)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy106.genSnapshot(Unknown Source)
	at com.haoyu.knowlagebase.service.EbookSnapshotService.genSnapshot(EbookSnapshotService.java:17)
	at com.haoyu.knowlagebase.job.EbookSnapshotJob.doSnapshot(EbookSnapshotJob.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'view_count' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:59)
	at com.sun.proxy.$Proxy128.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy126.update(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:426)
	... 22 common frames omitted
2021-08-26 05:43:16.403 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2021-08-26 05:43:16.406 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :55   [32m                  [0;39m Starting KnowlagebaseApplication using Java 1.8.0_261 on DESKTOP-CTIIJC1 with PID 6348 (E:\code\java\knowlagebase\target\classes started by MECHREVO in E:\code\java\knowlagebase)
2021-08-26 05:43:16.406 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-08-26 05:43:16.450 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2021-08-26 05:43:16.450 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2021-08-26 05:43:16.885 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-08-26 05:43:16.887 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-08-26 05:43:16.900 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2021-08-26 05:43:17.386 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8880 (http)
2021-08-26 05:43:17.391 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8880"]
2021-08-26 05:43:17.392 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-08-26 05:43:17.392 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2021-08-26 05:43:17.445 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-08-26 05:43:17.445 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 994 ms
2021-08-26 05:43:18.055 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2021-08-26 05:43:18.330 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2021-08-26 05:43:18.365 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2021-08-26 05:43:18.383 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8880"]
2021-08-26 05:43:18.394 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8880 (http) with context path ''
2021-08-26 05:43:18.404 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :61   [32m                  [0;39m Started KnowlagebaseApplication in 2.434 seconds (JVM running for 3.436)
2021-08-26 05:43:18.406 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :28   [32m                  [0;39m 启动成功！
2021-08-26 05:43:18.406 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :29   [32m                  [0;39m 地址：	http://127.0.0.1:8880
2021-08-26 05:43:20.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85851530888089600 [0;39m 生成今日电子书快照开始
2021-08-26 05:43:20.018 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m85851530888089600 [0;39m HikariPool-1 - Starting...
2021-08-26 05:43:20.688 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m85851530888089600 [0;39m HikariPool-1 - Start completed.
2021-08-26 05:43:20.693 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85851530888089600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:43:20.707 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85851530888089600 [0;39m ==> Parameters: 
2021-08-26 05:43:20.755 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85851530888089600 [0;39m <==    Updates: 0
2021-08-26 05:43:20.757 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85851530888089600 [0;39m 生成今日电子书快照结束，耗时：749毫秒
2021-08-26 05:43:25.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85851551842832384 [0;39m 生成今日电子书快照开始
2021-08-26 05:43:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85851551842832384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:43:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85851551842832384 [0;39m ==> Parameters: 
2021-08-26 05:43:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85851551842832384 [0;39m <==    Updates: 0
2021-08-26 05:43:25.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85851551842832384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 05:43:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85851572822740992 [0;39m 生成今日电子书快照开始
2021-08-26 05:43:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85851572822740992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:43:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85851572822740992 [0;39m ==> Parameters: 
2021-08-26 05:43:30.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85851572822740992 [0;39m <==    Updates: 0
2021-08-26 05:43:30.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85851572822740992 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 05:43:35.003 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85851593781678080 [0;39m 更新电子书下的文档数据开始
2021-08-26 05:43:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85851593781678080 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 05:43:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85851593781678080 [0;39m ==> Parameters: 
2021-08-26 05:43:35.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85851593781678080 [0;39m <==    Updates: 5
2021-08-26 05:43:35.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85851593781678080 [0;39m 更新电子书下的文档数据结束，耗时：6毫秒
2021-08-26 05:43:35.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85851593806843904 [0;39m 生成今日电子书快照开始
2021-08-26 05:43:35.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85851593806843904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 05:43:35.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85851593806843904 [0;39m ==> Parameters: 
2021-08-26 05:43:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85851593806843904 [0;39m <==    Updates: 0
2021-08-26 05:43:35.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85851593806843904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:52:52.442 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2021-08-26 06:52:52.444 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :55   [32m                  [0;39m Starting KnowlagebaseApplication using Java 1.8.0_261 on DESKTOP-CTIIJC1 with PID 15212 (E:\code\java\knowlagebase\target\classes started by MECHREVO in E:\code\java\knowlagebase)
2021-08-26 06:52:52.445 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-08-26 06:52:52.484 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2021-08-26 06:52:52.484 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2021-08-26 06:52:52.909 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-08-26 06:52:52.910 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-08-26 06:52:52.923 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2021-08-26 06:52:53.448 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8880 (http)
2021-08-26 06:52:53.454 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8880"]
2021-08-26 06:52:53.455 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-08-26 06:52:53.455 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2021-08-26 06:52:53.512 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-08-26 06:52:53.512 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 1027 ms
2021-08-26 06:52:54.183 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2021-08-26 06:52:54.534 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2021-08-26 06:52:54.575 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2021-08-26 06:52:54.595 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8880"]
2021-08-26 06:52:54.608 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8880 (http) with context path ''
2021-08-26 06:52:54.618 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :61   [32m                  [0;39m Started KnowlagebaseApplication in 2.518 seconds (JVM running for 3.596)
2021-08-26 06:52:54.620 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :28   [32m                  [0;39m 启动成功！
2021-08-26 06:52:54.620 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :29   [32m                  [0;39m 地址：	http://127.0.0.1:8880
2021-08-26 06:52:55.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869042107289600 [0;39m 生成今日电子书快照开始
2021-08-26 06:52:55.018 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m85869042107289600 [0;39m HikariPool-1 - Starting...
2021-08-26 06:52:55.789 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m85869042107289600 [0;39m HikariPool-1 - Start completed.
2021-08-26 06:52:55.793 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869042107289600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:52:55.808 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869042107289600 [0;39m ==> Parameters: 
2021-08-26 06:52:55.811 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869042107289600 [0;39m <==    Updates: 0
2021-08-26 06:52:55.812 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869042107289600 [0;39m 生成今日电子书快照结束，耗时：804毫秒
2021-08-26 06:53:00.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869063091392512 [0;39m 生成今日电子书快照开始
2021-08-26 06:53:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869063091392512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:53:00.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869063091392512 [0;39m ==> Parameters: 
2021-08-26 06:53:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869063091392512 [0;39m <==    Updates: 0
2021-08-26 06:53:00.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869063091392512 [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-08-26 06:53:14.429 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :55   [32m                  [0;39m Starting KnowlagebaseApplication using Java 1.8.0_261 on DESKTOP-CTIIJC1 with PID 14496 (E:\code\java\knowlagebase\target\classes started by MECHREVO in E:\code\java\knowlagebase)
2021-08-26 06:53:14.426 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2021-08-26 06:53:14.431 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-08-26 06:53:14.482 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2021-08-26 06:53:14.482 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2021-08-26 06:53:15.049 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-08-26 06:53:15.051 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-08-26 06:53:15.065 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2021-08-26 06:53:15.670 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8880 (http)
2021-08-26 06:53:15.676 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8880"]
2021-08-26 06:53:15.676 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-08-26 06:53:15.677 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2021-08-26 06:53:15.738 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-08-26 06:53:15.738 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 1255 ms
2021-08-26 06:53:16.442 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2021-08-26 06:53:16.798 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2021-08-26 06:53:16.839 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2021-08-26 06:53:16.863 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8880"]
2021-08-26 06:53:16.878 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8880 (http) with context path ''
2021-08-26 06:53:16.890 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :61   [32m                  [0;39m Started KnowlagebaseApplication in 2.931 seconds (JVM running for 4.359)
2021-08-26 06:53:16.893 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :28   [32m                  [0;39m 启动成功！
2021-08-26 06:53:16.893 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :29   [32m                  [0;39m 地址：	http://127.0.0.1:8880
2021-08-26 06:53:20.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869146952306688 [0;39m 生成今日电子书快照开始
2021-08-26 06:53:20.017 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m85869146952306688 [0;39m HikariPool-1 - Starting...
2021-08-26 06:53:20.704 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m85869146952306688 [0;39m HikariPool-1 - Start completed.
2021-08-26 06:53:20.710 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869146952306688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:53:20.731 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869146952306688 [0;39m ==> Parameters: 
2021-08-26 06:53:20.734 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869146952306688 [0;39m <==    Updates: 0
2021-08-26 06:53:20.735 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869146952306688 [0;39m 生成今日电子书快照结束，耗时：730毫秒
2021-08-26 06:53:25.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869167915438080 [0;39m 生成今日电子书快照开始
2021-08-26 06:53:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869167915438080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:53:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869167915438080 [0;39m ==> Parameters: 
2021-08-26 06:53:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869167915438080 [0;39m <==    Updates: 0
2021-08-26 06:53:25.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869167915438080 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:53:30.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869188933095424 [0;39m 生成今日电子书快照开始
2021-08-26 06:53:30.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869188933095424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:53:30.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869188933095424 [0;39m ==> Parameters: 
2021-08-26 06:53:30.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869188933095424 [0;39m <==    Updates: 0
2021-08-26 06:53:30.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869188933095424 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:53:35.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869209892032512 [0;39m 生成今日电子书快照开始
2021-08-26 06:53:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869209892032512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:53:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869209892032512 [0;39m ==> Parameters: 
2021-08-26 06:53:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869209892032512 [0;39m <==    Updates: 0
2021-08-26 06:53:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869209892032512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:53:35.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85869209904615424 [0;39m 更新电子书下的文档数据开始
2021-08-26 06:53:35.017 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869209904615424 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 06:53:35.017 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869209904615424 [0;39m ==> Parameters: 
2021-08-26 06:53:35.018 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869209904615424 [0;39m <==    Updates: 5
2021-08-26 06:53:35.018 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85869209904615424 [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-08-26 06:53:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869230876135424 [0;39m 生成今日电子书快照开始
2021-08-26 06:53:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869230876135424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:53:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869230876135424 [0;39m ==> Parameters: 
2021-08-26 06:53:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869230876135424 [0;39m <==    Updates: 0
2021-08-26 06:53:40.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869230876135424 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:53:45.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869251818295296 [0;39m 生成今日电子书快照开始
2021-08-26 06:53:45.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869251818295296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:53:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869251818295296 [0;39m ==> Parameters: 
2021-08-26 06:53:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869251818295296 [0;39m <==    Updates: 0
2021-08-26 06:53:45.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869251818295296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:53:50.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869272781426688 [0;39m 生成今日电子书快照开始
2021-08-26 06:53:50.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869272781426688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:53:50.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869272781426688 [0;39m ==> Parameters: 
2021-08-26 06:53:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869272781426688 [0;39m <==    Updates: 0
2021-08-26 06:53:50.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869272781426688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:53:55.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869293744558080 [0;39m 生成今日电子书快照开始
2021-08-26 06:53:55.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869293744558080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:53:55.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869293744558080 [0;39m ==> Parameters: 
2021-08-26 06:53:55.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869293744558080 [0;39m <==    Updates: 0
2021-08-26 06:53:55.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869293744558080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:54:00.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869314749632512 [0;39m 生成今日电子书快照开始
2021-08-26 06:54:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869314749632512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:54:00.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869314749632512 [0;39m ==> Parameters: 
2021-08-26 06:54:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869314749632512 [0;39m <==    Updates: 0
2021-08-26 06:54:00.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869314749632512 [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-08-26 06:54:05.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869335733735424 [0;39m 生成今日电子书快照开始
2021-08-26 06:54:05.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869335733735424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:54:05.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869335733735424 [0;39m ==> Parameters: 
2021-08-26 06:54:05.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869335733735424 [0;39m <==    Updates: 0
2021-08-26 06:54:05.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869335733735424 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:54:05.017 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85869335746318336 [0;39m 更新电子书下的文档数据开始
2021-08-26 06:54:05.017 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869335746318336 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 06:54:05.018 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869335746318336 [0;39m ==> Parameters: 
2021-08-26 06:54:05.018 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869335746318336 [0;39m <==    Updates: 5
2021-08-26 06:54:05.019 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85869335746318336 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 06:54:10.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869356709449728 [0;39m 生成今日电子书快照开始
2021-08-26 06:54:10.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869356709449728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:54:10.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869356709449728 [0;39m ==> Parameters: 
2021-08-26 06:54:10.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869356709449728 [0;39m <==    Updates: 0
2021-08-26 06:54:10.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869356709449728 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:54:15.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869377676775424 [0;39m 生成今日电子书快照开始
2021-08-26 06:54:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869377676775424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:54:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869377676775424 [0;39m ==> Parameters: 
2021-08-26 06:54:15.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869377676775424 [0;39m <==    Updates: 0
2021-08-26 06:54:15.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869377676775424 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:54:20.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869398635712512 [0;39m 生成今日电子书快照开始
2021-08-26 06:54:20.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869398635712512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:54:20.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869398635712512 [0;39m ==> Parameters: 
2021-08-26 06:54:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869398635712512 [0;39m <==    Updates: 0
2021-08-26 06:54:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869398635712512 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:54:25.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869419590455296 [0;39m 生成今日电子书快照开始
2021-08-26 06:54:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869419590455296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:54:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869419590455296 [0;39m ==> Parameters: 
2021-08-26 06:54:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869419590455296 [0;39m <==    Updates: 0
2021-08-26 06:54:25.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869419590455296 [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-08-26 06:54:30.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869440587141120 [0;39m 生成今日电子书快照开始
2021-08-26 06:54:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869440587141120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:54:30.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869440587141120 [0;39m ==> Parameters: 
2021-08-26 06:54:30.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869440587141120 [0;39m <==    Updates: 0
2021-08-26 06:54:30.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869440587141120 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:54:35.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869461550272512 [0;39m 生成今日电子书快照开始
2021-08-26 06:54:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869461550272512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:54:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869461550272512 [0;39m ==> Parameters: 
2021-08-26 06:54:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869461550272512 [0;39m <==    Updates: 0
2021-08-26 06:54:35.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869461550272512 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:54:35.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85869461562855424 [0;39m 更新电子书下的文档数据开始
2021-08-26 06:54:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869461562855424 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 06:54:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869461562855424 [0;39m ==> Parameters: 
2021-08-26 06:54:35.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869461562855424 [0;39m <==    Updates: 5
2021-08-26 06:54:35.016 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85869461562855424 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 06:54:40.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869482521792512 [0;39m 生成今日电子书快照开始
2021-08-26 06:54:40.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869482521792512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:54:40.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869482521792512 [0;39m ==> Parameters: 
2021-08-26 06:54:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869482521792512 [0;39m <==    Updates: 0
2021-08-26 06:54:40.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869482521792512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:54:45.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869503459758080 [0;39m 生成今日电子书快照开始
2021-08-26 06:54:45.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869503459758080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:54:45.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869503459758080 [0;39m ==> Parameters: 
2021-08-26 06:54:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869503459758080 [0;39m <==    Updates: 0
2021-08-26 06:54:45.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869503459758080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:54:50.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869524485804032 [0;39m 生成今日电子书快照开始
2021-08-26 06:54:50.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869524485804032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:54:50.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869524485804032 [0;39m ==> Parameters: 
2021-08-26 06:54:50.019 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869524485804032 [0;39m <==    Updates: 0
2021-08-26 06:54:50.019 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869524485804032 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:54:55.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869545415380992 [0;39m 生成今日电子书快照开始
2021-08-26 06:54:55.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869545415380992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:54:55.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869545415380992 [0;39m ==> Parameters: 
2021-08-26 06:54:55.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869545415380992 [0;39m <==    Updates: 0
2021-08-26 06:54:55.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869545415380992 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:55:00.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869566420455424 [0;39m 生成今日电子书快照开始
2021-08-26 06:55:00.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869566420455424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:55:00.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869566420455424 [0;39m ==> Parameters: 
2021-08-26 06:55:00.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869566420455424 [0;39m <==    Updates: 0
2021-08-26 06:55:00.019 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869566420455424 [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-08-26 06:55:05.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869587379392512 [0;39m 生成今日电子书快照开始
2021-08-26 06:55:05.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869587379392512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:55:05.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869587379392512 [0;39m ==> Parameters: 
2021-08-26 06:55:05.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869587379392512 [0;39m <==    Updates: 0
2021-08-26 06:55:05.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869587379392512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:55:05.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85869587391975424 [0;39m 更新电子书下的文档数据开始
2021-08-26 06:55:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869587391975424 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 06:55:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869587391975424 [0;39m ==> Parameters: 
2021-08-26 06:55:05.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869587391975424 [0;39m <==    Updates: 5
2021-08-26 06:55:05.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85869587391975424 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 06:55:10.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869608342523904 [0;39m 生成今日电子书快照开始
2021-08-26 06:55:10.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869608342523904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:55:10.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869608342523904 [0;39m ==> Parameters: 
2021-08-26 06:55:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869608342523904 [0;39m <==    Updates: 0
2021-08-26 06:55:10.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869608342523904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:55:15.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869629318238208 [0;39m 生成今日电子书快照开始
2021-08-26 06:55:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869629318238208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:55:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869629318238208 [0;39m ==> Parameters: 
2021-08-26 06:55:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869629318238208 [0;39m <==    Updates: 0
2021-08-26 06:55:15.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869629318238208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:55:20.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869650289758208 [0;39m 生成今日电子书快照开始
2021-08-26 06:55:20.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869650289758208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:55:20.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869650289758208 [0;39m ==> Parameters: 
2021-08-26 06:55:20.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869650289758208 [0;39m <==    Updates: 0
2021-08-26 06:55:20.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869650289758208 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:55:25.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869671236112384 [0;39m 生成今日电子书快照开始
2021-08-26 06:55:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869671236112384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:55:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869671236112384 [0;39m ==> Parameters: 
2021-08-26 06:55:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869671236112384 [0;39m <==    Updates: 0
2021-08-26 06:55:25.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869671236112384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:55:30.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869692228603904 [0;39m 生成今日电子书快照开始
2021-08-26 06:55:30.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869692228603904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:55:30.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869692228603904 [0;39m ==> Parameters: 
2021-08-26 06:55:30.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869692228603904 [0;39m <==    Updates: 0
2021-08-26 06:55:30.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869692228603904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:55:35.002 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85869713170763776 [0;39m 更新电子书下的文档数据开始
2021-08-26 06:55:35.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869713170763776 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 06:55:35.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869713170763776 [0;39m ==> Parameters: 
2021-08-26 06:55:35.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869713170763776 [0;39m <==    Updates: 5
2021-08-26 06:55:35.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85869713170763776 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 06:55:35.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869713179152384 [0;39m 生成今日电子书快照开始
2021-08-26 06:55:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869713179152384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:55:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869713179152384 [0;39m ==> Parameters: 
2021-08-26 06:55:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869713179152384 [0;39m <==    Updates: 0
2021-08-26 06:55:35.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869713179152384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:55:40.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869734163255296 [0;39m 生成今日电子书快照开始
2021-08-26 06:55:40.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869734163255296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:55:40.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869734163255296 [0;39m ==> Parameters: 
2021-08-26 06:55:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869734163255296 [0;39m <==    Updates: 0
2021-08-26 06:55:40.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869734163255296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:55:42.697 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring DispatcherServlet 'dispatcherServlet'
2021-08-26 06:55:42.697 INFO  org.springframework.web.servlet.DispatcherServlet :525  [32m                  [0;39m Initializing Servlet 'dispatcherServlet'
2021-08-26 06:55:42.698 INFO  org.springframework.web.servlet.DispatcherServlet :547  [32m                  [0;39m Completed initialization in 0 ms
2021-08-26 06:55:42.733 INFO  com.haoyu.knowlagebase.websocket.WebSocketServer  :33   [32m                  [0;39m 有新连接：token：fjF1VcM6R6，session id：0，当前连接数：1
2021-08-26 06:55:42.813 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85869745928278016 [0;39m ------------- 开始 -------------
2021-08-26 06:55:42.813 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85869745928278016 [0;39m 请求地址: http://127.0.0.1:8880/category/all GET
2021-08-26 06:55:42.814 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85869745928278016 [0;39m 类名方法: com.haoyu.knowlagebase.controller.CategoryController.all
2021-08-26 06:55:42.814 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85869745928278016 [0;39m 远程地址: 127.0.0.1
2021-08-26 06:55:42.851 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85869745928278016 [0;39m 请求参数: []
2021-08-26 06:55:42.870 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85869745928278016 [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-08-26 06:55:42.870 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85869745928278016 [0;39m ==> Parameters: 
2021-08-26 06:55:42.897 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==    Columns: id, parent, name, sort
2021-08-26 06:55:42.898 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 82110017238601728, 100, test2, 1
2021-08-26 06:55:42.899 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 100, 0, 前端开发, 100
2021-08-26 06:55:42.899 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 101, 100, Vue, 101
2021-08-26 06:55:42.899 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 102, 100, HTML & CSS, 102
2021-08-26 06:55:42.900 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 200, 0, Java, 200
2021-08-26 06:55:42.900 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 201, 200, 基础应用, 201
2021-08-26 06:55:42.900 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 202, 200, 框架应用, 202
2021-08-26 06:55:42.900 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 300, 0, Python, 300
2021-08-26 06:55:42.901 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 301, 300, 基础应用, 301
2021-08-26 06:55:42.901 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 302, 300, 进阶方向应用, 302
2021-08-26 06:55:42.901 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 400, 0, 数据库, 400
2021-08-26 06:55:42.902 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 401, 400, MySQL, 401
2021-08-26 06:55:42.902 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 500, 0, 其它, 500
2021-08-26 06:55:42.902 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 501, 500, 服务器, 501
2021-08-26 06:55:42.903 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 502, 500, 开发工具, 502
2021-08-26 06:55:42.903 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85869745928278016 [0;39m <==        Row: 503, 500, 热门服务端语言, 503
2021-08-26 06:55:42.904 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85869745928278016 [0;39m <==      Total: 16
2021-08-26 06:55:42.926 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85869745928278016 [0;39m 返回结果: {"content":[{"id":82110017238601728,"name":"test2","parent":100,"sort":1},{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"基础应用","parent":300,"sort":301},{"id":302,"name":"进阶方向应用","parent":300,"sort":302},{"id":400,"name":"数据库","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":500,"name":"其它","parent":0,"sort":500},{"id":501,"name":"服务器","parent":500,"sort":501},{"id":502,"name":"开发工具","parent":500,"sort":502},{"id":503,"name":"热门服务端语言","parent":500,"sort":503}],"success":true}
2021-08-26 06:55:42.927 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85869745928278016 [0;39m ------------- 结束 耗时：115 ms -------------
2021-08-26 06:55:45.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869755143163904 [0;39m 生成今日电子书快照开始
2021-08-26 06:55:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869755143163904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:55:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869755143163904 [0;39m ==> Parameters: 
2021-08-26 06:55:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869755143163904 [0;39m <==    Updates: 0
2021-08-26 06:55:45.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869755143163904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:55:45.768 INFO  com.haoyu.knowlagebase.websocket.WebSocketServer  :42   [32m                  [0;39m 连接关闭，token：fjF1VcM6R6，session id：0！当前连接数：0
2021-08-26 06:55:50.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869776118878208 [0;39m 生成今日电子书快照开始
2021-08-26 06:55:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869776118878208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:55:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869776118878208 [0;39m ==> Parameters: 
2021-08-26 06:55:50.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869776118878208 [0;39m <==    Updates: 0
2021-08-26 06:55:50.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869776118878208 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:55:55.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869797086203904 [0;39m 生成今日电子书快照开始
2021-08-26 06:55:55.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869797086203904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:55:55.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869797086203904 [0;39m ==> Parameters: 
2021-08-26 06:55:55.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869797086203904 [0;39m <==    Updates: 0
2021-08-26 06:55:55.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869797086203904 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:56:00.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869818032558080 [0;39m 生成今日电子书快照开始
2021-08-26 06:56:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869818032558080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:56:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869818032558080 [0;39m ==> Parameters: 
2021-08-26 06:56:00.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869818032558080 [0;39m <==    Updates: 0
2021-08-26 06:56:00.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869818032558080 [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-08-26 06:56:05.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869838995689472 [0;39m 生成今日电子书快照开始
2021-08-26 06:56:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869838995689472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:56:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869838995689472 [0;39m ==> Parameters: 
2021-08-26 06:56:05.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869838995689472 [0;39m <==    Updates: 0
2021-08-26 06:56:05.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869838995689472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:56:05.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85869839008272384 [0;39m 更新电子书下的文档数据开始
2021-08-26 06:56:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869839008272384 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 06:56:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869839008272384 [0;39m ==> Parameters: 
2021-08-26 06:56:05.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869839008272384 [0;39m <==    Updates: 5
2021-08-26 06:56:05.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85869839008272384 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 06:56:10.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869859983986688 [0;39m 生成今日电子书快照开始
2021-08-26 06:56:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869859983986688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:56:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869859983986688 [0;39m ==> Parameters: 
2021-08-26 06:56:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869859983986688 [0;39m <==    Updates: 0
2021-08-26 06:56:10.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869859983986688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:56:15.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869880997449728 [0;39m 生成今日电子书快照开始
2021-08-26 06:56:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869880997449728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:56:15.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869880997449728 [0;39m ==> Parameters: 
2021-08-26 06:56:15.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869880997449728 [0;39m <==    Updates: 0
2021-08-26 06:56:15.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869880997449728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:56:20.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869901939609600 [0;39m 生成今日电子书快照开始
2021-08-26 06:56:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869901939609600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:56:20.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869901939609600 [0;39m ==> Parameters: 
2021-08-26 06:56:20.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869901939609600 [0;39m <==    Updates: 0
2021-08-26 06:56:20.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869901939609600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:56:25.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869922898546688 [0;39m 生成今日电子书快照开始
2021-08-26 06:56:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869922898546688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:56:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869922898546688 [0;39m ==> Parameters: 
2021-08-26 06:56:25.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869922898546688 [0;39m <==    Updates: 0
2021-08-26 06:56:25.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869922898546688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:56:30.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869943903621120 [0;39m 生成今日电子书快照开始
2021-08-26 06:56:30.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869943903621120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:56:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869943903621120 [0;39m ==> Parameters: 
2021-08-26 06:56:30.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869943903621120 [0;39m <==    Updates: 0
2021-08-26 06:56:30.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869943903621120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:56:35.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869964862558208 [0;39m 生成今日电子书快照开始
2021-08-26 06:56:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869964862558208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:56:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869964862558208 [0;39m ==> Parameters: 
2021-08-26 06:56:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869964862558208 [0;39m <==    Updates: 0
2021-08-26 06:56:35.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869964862558208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:56:35.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85869964870946816 [0;39m 更新电子书下的文档数据开始
2021-08-26 06:56:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869964870946816 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 06:56:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869964870946816 [0;39m ==> Parameters: 
2021-08-26 06:56:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85869964870946816 [0;39m <==    Updates: 5
2021-08-26 06:56:35.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85869964870946816 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 06:56:40.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85869985800523776 [0;39m 生成今日电子书快照开始
2021-08-26 06:56:40.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869985800523776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:56:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869985800523776 [0;39m ==> Parameters: 
2021-08-26 06:56:40.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85869985800523776 [0;39m <==    Updates: 0
2021-08-26 06:56:40.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85869985800523776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:56:45.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870006767849472 [0;39m 生成今日电子书快照开始
2021-08-26 06:56:45.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870006767849472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:56:45.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870006767849472 [0;39m ==> Parameters: 
2021-08-26 06:56:45.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870006767849472 [0;39m <==    Updates: 0
2021-08-26 06:56:45.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870006767849472 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:56:50.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870027760340992 [0;39m 生成今日电子书快照开始
2021-08-26 06:56:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870027760340992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:56:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870027760340992 [0;39m ==> Parameters: 
2021-08-26 06:56:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870027760340992 [0;39m <==    Updates: 0
2021-08-26 06:56:50.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870027760340992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:56:55.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870048752832512 [0;39m 生成今日电子书快照开始
2021-08-26 06:56:55.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870048752832512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:56:55.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870048752832512 [0;39m ==> Parameters: 
2021-08-26 06:56:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870048752832512 [0;39m <==    Updates: 0
2021-08-26 06:56:55.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870048752832512 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:57:00.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870069720158208 [0;39m 生成今日电子书快照开始
2021-08-26 06:57:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870069720158208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:57:00.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870069720158208 [0;39m ==> Parameters: 
2021-08-26 06:57:00.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870069720158208 [0;39m <==    Updates: 0
2021-08-26 06:57:00.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870069720158208 [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-08-26 06:57:05.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870090670706688 [0;39m 生成今日电子书快照开始
2021-08-26 06:57:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870090670706688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:57:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870090670706688 [0;39m ==> Parameters: 
2021-08-26 06:57:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870090670706688 [0;39m <==    Updates: 0
2021-08-26 06:57:05.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870090670706688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:57:05.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85870090683289600 [0;39m 更新电子书下的文档数据开始
2021-08-26 06:57:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870090683289600 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 06:57:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870090683289600 [0;39m ==> Parameters: 
2021-08-26 06:57:05.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870090683289600 [0;39m <==    Updates: 5
2021-08-26 06:57:05.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85870090683289600 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 06:57:10.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870111638032384 [0;39m 生成今日电子书快照开始
2021-08-26 06:57:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870111638032384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:57:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870111638032384 [0;39m ==> Parameters: 
2021-08-26 06:57:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870111638032384 [0;39m <==    Updates: 0
2021-08-26 06:57:10.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870111638032384 [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-08-26 06:57:15.000 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870132592775168 [0;39m 生成今日电子书快照开始
2021-08-26 06:57:15.000 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870132592775168 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:57:15.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870132592775168 [0;39m ==> Parameters: 
2021-08-26 06:57:15.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870132592775168 [0;39m <==    Updates: 0
2021-08-26 06:57:15.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870132592775168 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:57:20.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870153593655296 [0;39m 生成今日电子书快照开始
2021-08-26 06:57:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870153593655296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:57:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870153593655296 [0;39m ==> Parameters: 
2021-08-26 06:57:20.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870153593655296 [0;39m <==    Updates: 0
2021-08-26 06:57:20.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870153593655296 [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-08-26 06:57:25.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870174544203776 [0;39m 生成今日电子书快照开始
2021-08-26 06:57:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870174544203776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:57:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870174544203776 [0;39m ==> Parameters: 
2021-08-26 06:57:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870174544203776 [0;39m <==    Updates: 0
2021-08-26 06:57:25.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870174544203776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:57:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870195528306688 [0;39m 生成今日电子书快照开始
2021-08-26 06:57:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870195528306688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:57:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870195528306688 [0;39m ==> Parameters: 
2021-08-26 06:57:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870195528306688 [0;39m <==    Updates: 0
2021-08-26 06:57:30.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870195528306688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:57:35.001 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85870216483049472 [0;39m 更新电子书下的文档数据开始
2021-08-26 06:57:35.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870216483049472 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 06:57:35.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870216483049472 [0;39m ==> Parameters: 
2021-08-26 06:57:35.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870216483049472 [0;39m <==    Updates: 5
2021-08-26 06:57:35.003 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85870216483049472 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 06:57:35.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870216491438080 [0;39m 生成今日电子书快照开始
2021-08-26 06:57:35.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870216491438080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:57:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870216491438080 [0;39m ==> Parameters: 
2021-08-26 06:57:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870216491438080 [0;39m <==    Updates: 0
2021-08-26 06:57:35.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870216491438080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:57:40.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870237483929600 [0;39m 生成今日电子书快照开始
2021-08-26 06:57:40.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870237483929600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:57:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870237483929600 [0;39m ==> Parameters: 
2021-08-26 06:57:40.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870237483929600 [0;39m <==    Updates: 0
2021-08-26 06:57:40.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870237483929600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:57:45.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870258480615424 [0;39m 生成今日电子书快照开始
2021-08-26 06:57:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870258480615424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:57:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870258480615424 [0;39m ==> Parameters: 
2021-08-26 06:57:45.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870258480615424 [0;39m <==    Updates: 0
2021-08-26 06:57:45.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870258480615424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:57:50.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870279435358208 [0;39m 生成今日电子书快照开始
2021-08-26 06:57:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870279435358208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:57:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870279435358208 [0;39m ==> Parameters: 
2021-08-26 06:57:50.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870279435358208 [0;39m <==    Updates: 0
2021-08-26 06:57:50.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870279435358208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:57:55.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870300411072512 [0;39m 生成今日电子书快照开始
2021-08-26 06:57:55.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870300411072512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:57:55.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870300411072512 [0;39m ==> Parameters: 
2021-08-26 06:57:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870300411072512 [0;39m <==    Updates: 0
2021-08-26 06:57:55.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870300411072512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:58:00.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870321353232384 [0;39m 生成今日电子书快照开始
2021-08-26 06:58:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870321353232384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:58:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870321353232384 [0;39m ==> Parameters: 
2021-08-26 06:58:00.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870321353232384 [0;39m <==    Updates: 0
2021-08-26 06:58:00.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870321353232384 [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-08-26 06:58:05.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870342312169472 [0;39m 生成今日电子书快照开始
2021-08-26 06:58:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870342312169472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:58:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870342312169472 [0;39m ==> Parameters: 
2021-08-26 06:58:05.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870342312169472 [0;39m <==    Updates: 0
2021-08-26 06:58:05.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870342312169472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:58:05.003 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85870342320558080 [0;39m 更新电子书下的文档数据开始
2021-08-26 06:58:05.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870342320558080 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 06:58:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870342320558080 [0;39m ==> Parameters: 
2021-08-26 06:58:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870342320558080 [0;39m <==    Updates: 5
2021-08-26 06:58:05.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85870342320558080 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 06:58:10.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870363334021120 [0;39m 生成今日电子书快照开始
2021-08-26 06:58:10.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870363334021120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:58:10.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870363334021120 [0;39m ==> Parameters: 
2021-08-26 06:58:10.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870363334021120 [0;39m <==    Updates: 0
2021-08-26 06:58:10.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870363334021120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:58:15.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870384288763904 [0;39m 生成今日电子书快照开始
2021-08-26 06:58:15.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870384288763904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:58:15.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870384288763904 [0;39m ==> Parameters: 
2021-08-26 06:58:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870384288763904 [0;39m <==    Updates: 0
2021-08-26 06:58:15.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870384288763904 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 06:58:20.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870405230923776 [0;39m 生成今日电子书快照开始
2021-08-26 06:58:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870405230923776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:58:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870405230923776 [0;39m ==> Parameters: 
2021-08-26 06:58:20.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870405230923776 [0;39m <==    Updates: 0
2021-08-26 06:58:20.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870405230923776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:58:25.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870426240192512 [0;39m 生成今日电子书快照开始
2021-08-26 06:58:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870426240192512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:58:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870426240192512 [0;39m ==> Parameters: 
2021-08-26 06:58:25.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870426240192512 [0;39m <==    Updates: 0
2021-08-26 06:58:25.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870426240192512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:58:30.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870447211712512 [0;39m 生成今日电子书快照开始
2021-08-26 06:58:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870447211712512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:58:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870447211712512 [0;39m ==> Parameters: 
2021-08-26 06:58:30.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870447211712512 [0;39m <==    Updates: 0
2021-08-26 06:58:30.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870447211712512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:58:35.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85870468162260992 [0;39m 更新电子书下的文档数据开始
2021-08-26 06:58:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870468162260992 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 06:58:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870468162260992 [0;39m ==> Parameters: 
2021-08-26 06:58:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870468162260992 [0;39m <==    Updates: 5
2021-08-26 06:58:35.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85870468162260992 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 06:58:35.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870468170649600 [0;39m 生成今日电子书快照开始
2021-08-26 06:58:35.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870468170649600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:58:35.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870468170649600 [0;39m ==> Parameters: 
2021-08-26 06:58:35.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870468170649600 [0;39m <==    Updates: 0
2021-08-26 06:58:35.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870468170649600 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 06:58:40.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870489150558208 [0;39m 生成今日电子书快照开始
2021-08-26 06:58:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870489150558208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:58:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870489150558208 [0;39m ==> Parameters: 
2021-08-26 06:58:40.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870489150558208 [0;39m <==    Updates: 0
2021-08-26 06:58:40.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870489150558208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:58:45.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870510113689600 [0;39m 生成今日电子书快照开始
2021-08-26 06:58:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870510113689600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:58:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870510113689600 [0;39m ==> Parameters: 
2021-08-26 06:58:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870510113689600 [0;39m <==    Updates: 0
2021-08-26 06:58:45.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870510113689600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:58:50.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870531081015296 [0;39m 生成今日电子书快照开始
2021-08-26 06:58:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870531081015296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:58:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870531081015296 [0;39m ==> Parameters: 
2021-08-26 06:58:50.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870531081015296 [0;39m <==    Updates: 0
2021-08-26 06:58:50.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870531081015296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:58:55.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870552048340992 [0;39m 生成今日电子书快照开始
2021-08-26 06:58:55.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870552048340992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:58:55.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870552048340992 [0;39m ==> Parameters: 
2021-08-26 06:58:55.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870552048340992 [0;39m <==    Updates: 0
2021-08-26 06:58:55.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870552048340992 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 06:59:00.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870573011472384 [0;39m 生成今日电子书快照开始
2021-08-26 06:59:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870573011472384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:59:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870573011472384 [0;39m ==> Parameters: 
2021-08-26 06:59:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870573011472384 [0;39m <==    Updates: 0
2021-08-26 06:59:00.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870573011472384 [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-08-26 06:59:05.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85870594003963904 [0;39m 更新电子书下的文档数据开始
2021-08-26 06:59:05.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870594003963904 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 06:59:05.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870594003963904 [0;39m ==> Parameters: 
2021-08-26 06:59:05.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870594003963904 [0;39m <==    Updates: 5
2021-08-26 06:59:05.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85870594003963904 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 06:59:05.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870594012352512 [0;39m 生成今日电子书快照开始
2021-08-26 06:59:05.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870594012352512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:59:05.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870594012352512 [0;39m ==> Parameters: 
2021-08-26 06:59:05.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870594012352512 [0;39m <==    Updates: 0
2021-08-26 06:59:05.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870594012352512 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 06:59:10.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870614979678208 [0;39m 生成今日电子书快照开始
2021-08-26 06:59:10.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870614979678208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:59:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870614979678208 [0;39m ==> Parameters: 
2021-08-26 06:59:10.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870614979678208 [0;39m <==    Updates: 0
2021-08-26 06:59:10.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870614979678208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:59:15.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870635934420992 [0;39m 生成今日电子书快照开始
2021-08-26 06:59:15.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870635934420992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:59:15.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870635934420992 [0;39m ==> Parameters: 
2021-08-26 06:59:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870635934420992 [0;39m <==    Updates: 0
2021-08-26 06:59:15.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870635934420992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:59:20.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870656910135296 [0;39m 生成今日电子书快照开始
2021-08-26 06:59:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870656910135296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:59:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870656910135296 [0;39m ==> Parameters: 
2021-08-26 06:59:20.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870656910135296 [0;39m <==    Updates: 0
2021-08-26 06:59:20.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870656910135296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:59:25.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870677885849600 [0;39m 生成今日电子书快照开始
2021-08-26 06:59:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870677885849600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:59:25.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870677885849600 [0;39m ==> Parameters: 
2021-08-26 06:59:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870677885849600 [0;39m <==    Updates: 0
2021-08-26 06:59:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870677885849600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:59:30.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870698874146816 [0;39m 生成今日电子书快照开始
2021-08-26 06:59:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870698874146816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:59:30.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870698874146816 [0;39m ==> Parameters: 
2021-08-26 06:59:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870698874146816 [0;39m <==    Updates: 0
2021-08-26 06:59:30.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870698874146816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:59:35.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85870719858249728 [0;39m 更新电子书下的文档数据开始
2021-08-26 06:59:35.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870719858249728 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 06:59:35.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870719858249728 [0;39m ==> Parameters: 
2021-08-26 06:59:35.017 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870719858249728 [0;39m <==    Updates: 5
2021-08-26 06:59:35.017 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85870719858249728 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 06:59:35.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870719866638336 [0;39m 生成今日电子书快照开始
2021-08-26 06:59:35.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870719866638336 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:59:35.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870719866638336 [0;39m ==> Parameters: 
2021-08-26 06:59:35.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870719866638336 [0;39m <==    Updates: 0
2021-08-26 06:59:35.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870719866638336 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 06:59:40.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870740804603904 [0;39m 生成今日电子书快照开始
2021-08-26 06:59:40.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870740804603904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:59:40.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870740804603904 [0;39m ==> Parameters: 
2021-08-26 06:59:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870740804603904 [0;39m <==    Updates: 0
2021-08-26 06:59:40.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870740804603904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:59:45.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870761780318208 [0;39m 生成今日电子书快照开始
2021-08-26 06:59:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870761780318208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:59:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870761780318208 [0;39m ==> Parameters: 
2021-08-26 06:59:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870761780318208 [0;39m <==    Updates: 0
2021-08-26 06:59:45.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870761780318208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:59:50.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870782726672384 [0;39m 生成今日电子书快照开始
2021-08-26 06:59:50.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870782726672384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:59:50.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870782726672384 [0;39m ==> Parameters: 
2021-08-26 06:59:50.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870782726672384 [0;39m <==    Updates: 0
2021-08-26 06:59:50.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870782726672384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 06:59:55.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870803706580992 [0;39m 生成今日电子书快照开始
2021-08-26 06:59:55.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870803706580992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 06:59:55.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870803706580992 [0;39m ==> Parameters: 
2021-08-26 06:59:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870803706580992 [0;39m <==    Updates: 0
2021-08-26 06:59:55.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870803706580992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:00:00.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870824665518080 [0;39m 生成今日电子书快照开始
2021-08-26 07:00:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870824665518080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:00:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870824665518080 [0;39m ==> Parameters: 
2021-08-26 07:00:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870824665518080 [0;39m <==    Updates: 0
2021-08-26 07:00:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870824665518080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:00:05.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85870845687369728 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:00:05.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870845687369728 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:00:05.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870845687369728 [0;39m ==> Parameters: 
2021-08-26 07:00:05.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870845687369728 [0;39m <==    Updates: 5
2021-08-26 07:00:05.016 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85870845687369728 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:00:05.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870845691564032 [0;39m 生成今日电子书快照开始
2021-08-26 07:00:05.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870845691564032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:00:05.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870845691564032 [0;39m ==> Parameters: 
2021-08-26 07:00:05.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870845691564032 [0;39m <==    Updates: 0
2021-08-26 07:00:05.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870845691564032 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:00:10.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870866633723904 [0;39m 生成今日电子书快照开始
2021-08-26 07:00:10.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870866633723904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:00:10.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870866633723904 [0;39m ==> Parameters: 
2021-08-26 07:00:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870866633723904 [0;39m <==    Updates: 0
2021-08-26 07:00:10.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870866633723904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:00:15.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870887630409728 [0;39m 生成今日电子书快照开始
2021-08-26 07:00:15.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870887630409728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:00:15.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870887630409728 [0;39m ==> Parameters: 
2021-08-26 07:00:15.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870887630409728 [0;39m <==    Updates: 0
2021-08-26 07:00:15.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870887630409728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:00:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870908597735424 [0;39m 生成今日电子书快照开始
2021-08-26 07:00:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870908597735424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:00:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870908597735424 [0;39m ==> Parameters: 
2021-08-26 07:00:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870908597735424 [0;39m <==    Updates: 0
2021-08-26 07:00:20.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870908597735424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:00:25.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870929531506688 [0;39m 生成今日电子书快照开始
2021-08-26 07:00:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870929531506688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:00:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870929531506688 [0;39m ==> Parameters: 
2021-08-26 07:00:25.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870929531506688 [0;39m <==    Updates: 0
2021-08-26 07:00:25.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870929531506688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:00:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870950507220992 [0;39m 生成今日电子书快照开始
2021-08-26 07:00:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870950507220992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:00:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870950507220992 [0;39m ==> Parameters: 
2021-08-26 07:00:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870950507220992 [0;39m <==    Updates: 0
2021-08-26 07:00:30.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870950507220992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:00:35.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870971503906816 [0;39m 生成今日电子书快照开始
2021-08-26 07:00:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870971503906816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:00:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870971503906816 [0;39m ==> Parameters: 
2021-08-26 07:00:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870971503906816 [0;39m <==    Updates: 0
2021-08-26 07:00:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870971503906816 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:00:35.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85870971508101120 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:00:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870971508101120 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:00:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870971508101120 [0;39m ==> Parameters: 
2021-08-26 07:00:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85870971508101120 [0;39m <==    Updates: 5
2021-08-26 07:00:35.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85870971508101120 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:00:40.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85870992454455296 [0;39m 生成今日电子书快照开始
2021-08-26 07:00:40.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870992454455296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:00:40.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870992454455296 [0;39m ==> Parameters: 
2021-08-26 07:00:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85870992454455296 [0;39m <==    Updates: 0
2021-08-26 07:00:40.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85870992454455296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:00:45.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871013446946816 [0;39m 生成今日电子书快照开始
2021-08-26 07:00:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871013446946816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:00:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871013446946816 [0;39m ==> Parameters: 
2021-08-26 07:00:45.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871013446946816 [0;39m <==    Updates: 0
2021-08-26 07:00:45.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871013446946816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:00:50.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871034401689600 [0;39m 生成今日电子书快照开始
2021-08-26 07:00:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871034401689600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:00:50.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871034401689600 [0;39m ==> Parameters: 
2021-08-26 07:00:50.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871034401689600 [0;39m <==    Updates: 0
2021-08-26 07:00:50.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871034401689600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:00:55.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871055377403904 [0;39m 生成今日电子书快照开始
2021-08-26 07:00:55.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871055377403904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:00:55.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871055377403904 [0;39m ==> Parameters: 
2021-08-26 07:00:55.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871055377403904 [0;39m <==    Updates: 0
2021-08-26 07:00:55.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871055377403904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:01:00.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871076319563776 [0;39m 生成今日电子书快照开始
2021-08-26 07:01:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871076319563776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:01:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871076319563776 [0;39m ==> Parameters: 
2021-08-26 07:01:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871076319563776 [0;39m <==    Updates: 0
2021-08-26 07:01:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871076319563776 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:01:05.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871097291083776 [0;39m 生成今日电子书快照开始
2021-08-26 07:01:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871097291083776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:01:05.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871097291083776 [0;39m ==> Parameters: 
2021-08-26 07:01:05.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871097291083776 [0;39m <==    Updates: 0
2021-08-26 07:01:05.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871097291083776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:01:05.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85871097299472384 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:01:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871097299472384 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:01:05.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871097299472384 [0;39m ==> Parameters: 
2021-08-26 07:01:05.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871097299472384 [0;39m <==    Updates: 5
2021-08-26 07:01:05.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85871097299472384 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:01:10.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871118300352512 [0;39m 生成今日电子书快照开始
2021-08-26 07:01:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871118300352512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:01:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871118300352512 [0;39m ==> Parameters: 
2021-08-26 07:01:10.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871118300352512 [0;39m <==    Updates: 0
2021-08-26 07:01:10.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871118300352512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:01:15.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871139263483904 [0;39m 生成今日电子书快照开始
2021-08-26 07:01:15.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871139263483904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:01:15.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871139263483904 [0;39m ==> Parameters: 
2021-08-26 07:01:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871139263483904 [0;39m <==    Updates: 0
2021-08-26 07:01:15.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871139263483904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:01:20.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871160201449472 [0;39m 生成今日电子书快照开始
2021-08-26 07:01:20.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871160201449472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:01:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871160201449472 [0;39m ==> Parameters: 
2021-08-26 07:01:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871160201449472 [0;39m <==    Updates: 0
2021-08-26 07:01:20.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871160201449472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:01:25.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871181206523904 [0;39m 生成今日电子书快照开始
2021-08-26 07:01:25.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871181206523904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:01:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871181206523904 [0;39m ==> Parameters: 
2021-08-26 07:01:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871181206523904 [0;39m <==    Updates: 0
2021-08-26 07:01:25.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871181206523904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:01:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871202161266688 [0;39m 生成今日电子书快照开始
2021-08-26 07:01:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871202161266688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:01:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871202161266688 [0;39m ==> Parameters: 
2021-08-26 07:01:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871202161266688 [0;39m <==    Updates: 0
2021-08-26 07:01:30.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871202161266688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:01:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871223166341120 [0;39m 生成今日电子书快照开始
2021-08-26 07:01:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871223166341120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:01:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871223166341120 [0;39m ==> Parameters: 
2021-08-26 07:01:35.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871223166341120 [0;39m <==    Updates: 0
2021-08-26 07:01:35.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871223166341120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:01:35.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85871223174729728 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:01:35.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871223174729728 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:01:35.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871223174729728 [0;39m ==> Parameters: 
2021-08-26 07:01:35.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871223174729728 [0;39m <==    Updates: 5
2021-08-26 07:01:35.016 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85871223174729728 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:01:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871244142055424 [0;39m 生成今日电子书快照开始
2021-08-26 07:01:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871244142055424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:01:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871244142055424 [0;39m ==> Parameters: 
2021-08-26 07:01:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871244142055424 [0;39m <==    Updates: 0
2021-08-26 07:01:40.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871244142055424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:01:45.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871265063243776 [0;39m 生成今日电子书快照开始
2021-08-26 07:01:45.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871265063243776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:01:45.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871265063243776 [0;39m ==> Parameters: 
2021-08-26 07:01:45.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871265063243776 [0;39m <==    Updates: 0
2021-08-26 07:01:45.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871265063243776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:01:50.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871286080901120 [0;39m 生成今日电子书快照开始
2021-08-26 07:01:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871286080901120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:01:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871286080901120 [0;39m ==> Parameters: 
2021-08-26 07:01:50.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871286080901120 [0;39m <==    Updates: 0
2021-08-26 07:01:50.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871286080901120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:01:55.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871307027255296 [0;39m 生成今日电子书快照开始
2021-08-26 07:01:55.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871307027255296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:01:55.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871307027255296 [0;39m ==> Parameters: 
2021-08-26 07:01:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871307027255296 [0;39m <==    Updates: 0
2021-08-26 07:01:55.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871307027255296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:02:00.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871328015552512 [0;39m 生成今日电子书快照开始
2021-08-26 07:02:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871328015552512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:02:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871328015552512 [0;39m ==> Parameters: 
2021-08-26 07:02:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871328015552512 [0;39m <==    Updates: 0
2021-08-26 07:02:00.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871328015552512 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:02:05.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871348945129472 [0;39m 生成今日电子书快照开始
2021-08-26 07:02:05.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871348945129472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:02:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871348945129472 [0;39m ==> Parameters: 
2021-08-26 07:02:05.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871348945129472 [0;39m <==    Updates: 0
2021-08-26 07:02:05.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871348945129472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:02:05.003 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85871348953518080 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:02:05.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871348953518080 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:02:05.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871348953518080 [0;39m ==> Parameters: 
2021-08-26 07:02:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871348953518080 [0;39m <==    Updates: 5
2021-08-26 07:02:05.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85871348953518080 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:02:10.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871369946009600 [0;39m 生成今日电子书快照开始
2021-08-26 07:02:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871369946009600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:02:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871369946009600 [0;39m ==> Parameters: 
2021-08-26 07:02:10.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871369946009600 [0;39m <==    Updates: 0
2021-08-26 07:02:10.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871369946009600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:02:15.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871390938501120 [0;39m 生成今日电子书快照开始
2021-08-26 07:02:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871390938501120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:02:15.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871390938501120 [0;39m ==> Parameters: 
2021-08-26 07:02:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871390938501120 [0;39m <==    Updates: 0
2021-08-26 07:02:15.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871390938501120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:02:20.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871411897438208 [0;39m 生成今日电子书快照开始
2021-08-26 07:02:20.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871411897438208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:02:20.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871411897438208 [0;39m ==> Parameters: 
2021-08-26 07:02:20.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871411897438208 [0;39m <==    Updates: 0
2021-08-26 07:02:20.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871411897438208 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:02:25.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871432885735424 [0;39m 生成今日电子书快照开始
2021-08-26 07:02:25.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871432885735424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:02:25.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871432885735424 [0;39m ==> Parameters: 
2021-08-26 07:02:25.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871432885735424 [0;39m <==    Updates: 0
2021-08-26 07:02:25.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871432885735424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:02:30.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871453853061120 [0;39m 生成今日电子书快照开始
2021-08-26 07:02:30.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871453853061120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:02:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871453853061120 [0;39m ==> Parameters: 
2021-08-26 07:02:30.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871453853061120 [0;39m <==    Updates: 0
2021-08-26 07:02:30.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871453853061120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:02:35.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871474795220992 [0;39m 生成今日电子书快照开始
2021-08-26 07:02:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871474795220992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:02:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871474795220992 [0;39m ==> Parameters: 
2021-08-26 07:02:35.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871474795220992 [0;39m <==    Updates: 0
2021-08-26 07:02:35.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871474795220992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:02:35.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85871474803609600 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:02:35.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871474803609600 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:02:35.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871474803609600 [0;39m ==> Parameters: 
2021-08-26 07:02:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871474803609600 [0;39m <==    Updates: 5
2021-08-26 07:02:35.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85871474803609600 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:02:40.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871495754158080 [0;39m 生成今日电子书快照开始
2021-08-26 07:02:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871495754158080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:02:40.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871495754158080 [0;39m ==> Parameters: 
2021-08-26 07:02:40.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871495754158080 [0;39m <==    Updates: 0
2021-08-26 07:02:40.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871495754158080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:02:45.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871516771815424 [0;39m 生成今日电子书快照开始
2021-08-26 07:02:45.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871516771815424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:02:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871516771815424 [0;39m ==> Parameters: 
2021-08-26 07:02:45.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871516771815424 [0;39m <==    Updates: 0
2021-08-26 07:02:45.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871516771815424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:02:50.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871537751724032 [0;39m 生成今日电子书快照开始
2021-08-26 07:02:50.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871537751724032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:02:50.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871537751724032 [0;39m ==> Parameters: 
2021-08-26 07:02:50.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871537751724032 [0;39m <==    Updates: 0
2021-08-26 07:02:50.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871537751724032 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:02:55.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871558698078208 [0;39m 生成今日电子书快照开始
2021-08-26 07:02:55.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871558698078208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:02:55.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871558698078208 [0;39m ==> Parameters: 
2021-08-26 07:02:55.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871558698078208 [0;39m <==    Updates: 0
2021-08-26 07:02:55.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871558698078208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:03:00.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871579640238080 [0;39m 生成今日电子书快照开始
2021-08-26 07:03:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871579640238080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:03:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871579640238080 [0;39m ==> Parameters: 
2021-08-26 07:03:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871579640238080 [0;39m <==    Updates: 0
2021-08-26 07:03:00.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871579640238080 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:03:05.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871600632729600 [0;39m 生成今日电子书快照开始
2021-08-26 07:03:05.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871600632729600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:03:05.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871600632729600 [0;39m ==> Parameters: 
2021-08-26 07:03:05.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871600632729600 [0;39m <==    Updates: 0
2021-08-26 07:03:05.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871600632729600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:03:05.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85871600641118208 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:03:05.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871600641118208 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:03:05.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871600641118208 [0;39m ==> Parameters: 
2021-08-26 07:03:05.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871600641118208 [0;39m <==    Updates: 5
2021-08-26 07:03:05.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85871600641118208 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:03:10.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871621608443904 [0;39m 生成今日电子书快照开始
2021-08-26 07:03:10.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871621608443904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:03:10.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871621608443904 [0;39m ==> Parameters: 
2021-08-26 07:03:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871621608443904 [0;39m <==    Updates: 0
2021-08-26 07:03:10.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871621608443904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:03:15.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871642596741120 [0;39m 生成今日电子书快照开始
2021-08-26 07:03:15.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871642596741120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:03:15.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871642596741120 [0;39m ==> Parameters: 
2021-08-26 07:03:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871642596741120 [0;39m <==    Updates: 0
2021-08-26 07:03:15.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871642596741120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:03:20.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871663534706688 [0;39m 生成今日电子书快照开始
2021-08-26 07:03:20.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871663534706688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:03:20.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871663534706688 [0;39m ==> Parameters: 
2021-08-26 07:03:20.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871663534706688 [0;39m <==    Updates: 0
2021-08-26 07:03:20.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871663534706688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:03:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871684527198208 [0;39m 生成今日电子书快照开始
2021-08-26 07:03:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871684527198208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:03:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871684527198208 [0;39m ==> Parameters: 
2021-08-26 07:03:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871684527198208 [0;39m <==    Updates: 0
2021-08-26 07:03:25.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871684527198208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:03:30.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871705498718208 [0;39m 生成今日电子书快照开始
2021-08-26 07:03:30.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871705498718208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:03:30.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871705498718208 [0;39m ==> Parameters: 
2021-08-26 07:03:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871705498718208 [0;39m <==    Updates: 0
2021-08-26 07:03:30.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871705498718208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:03:35.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871726491209728 [0;39m 生成今日电子书快照开始
2021-08-26 07:03:35.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871726491209728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:03:35.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871726491209728 [0;39m ==> Parameters: 
2021-08-26 07:03:35.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871726491209728 [0;39m <==    Updates: 0
2021-08-26 07:03:35.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871726491209728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:03:35.017 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85871726499598336 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:03:35.017 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871726499598336 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:03:35.017 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871726499598336 [0;39m ==> Parameters: 
2021-08-26 07:03:35.018 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871726499598336 [0;39m <==    Updates: 5
2021-08-26 07:03:35.018 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85871726499598336 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:03:40.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871747466924032 [0;39m 生成今日电子书快照开始
2021-08-26 07:03:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871747466924032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:03:40.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871747466924032 [0;39m ==> Parameters: 
2021-08-26 07:03:40.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871747466924032 [0;39m <==    Updates: 0
2021-08-26 07:03:40.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871747466924032 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:03:45.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871768388112384 [0;39m 生成今日电子书快照开始
2021-08-26 07:03:45.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871768388112384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:03:45.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871768388112384 [0;39m ==> Parameters: 
2021-08-26 07:03:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871768388112384 [0;39m <==    Updates: 0
2021-08-26 07:03:45.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871768388112384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:03:50.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871789355438080 [0;39m 生成今日电子书快照开始
2021-08-26 07:03:50.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871789355438080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:03:50.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871789355438080 [0;39m ==> Parameters: 
2021-08-26 07:03:50.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871789355438080 [0;39m <==    Updates: 0
2021-08-26 07:03:50.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871789355438080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:03:55.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871810347929600 [0;39m 生成今日电子书快照开始
2021-08-26 07:03:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871810347929600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:03:55.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871810347929600 [0;39m ==> Parameters: 
2021-08-26 07:03:55.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871810347929600 [0;39m <==    Updates: 0
2021-08-26 07:03:55.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871810347929600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:04:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871831306866688 [0;39m 生成今日电子书快照开始
2021-08-26 07:04:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871831306866688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:04:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871831306866688 [0;39m ==> Parameters: 
2021-08-26 07:04:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871831306866688 [0;39m <==    Updates: 0
2021-08-26 07:04:00.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871831306866688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:04:05.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85871852316135424 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:04:05.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871852316135424 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:04:05.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871852316135424 [0;39m ==> Parameters: 
2021-08-26 07:04:05.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871852316135424 [0;39m <==    Updates: 5
2021-08-26 07:04:05.016 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85871852316135424 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:04:05.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871852324524032 [0;39m 生成今日电子书快照开始
2021-08-26 07:04:05.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871852324524032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:04:05.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871852324524032 [0;39m ==> Parameters: 
2021-08-26 07:04:05.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871852324524032 [0;39m <==    Updates: 0
2021-08-26 07:04:05.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871852324524032 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:04:10.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871873241518080 [0;39m 生成今日电子书快照开始
2021-08-26 07:04:10.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871873241518080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:04:10.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871873241518080 [0;39m ==> Parameters: 
2021-08-26 07:04:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871873241518080 [0;39m <==    Updates: 0
2021-08-26 07:04:10.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871873241518080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:04:15.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871894238203904 [0;39m 生成今日电子书快照开始
2021-08-26 07:04:15.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871894238203904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:04:15.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871894238203904 [0;39m ==> Parameters: 
2021-08-26 07:04:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871894238203904 [0;39m <==    Updates: 0
2021-08-26 07:04:15.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871894238203904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:04:20.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871915226501120 [0;39m 生成今日电子书快照开始
2021-08-26 07:04:20.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871915226501120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:04:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871915226501120 [0;39m ==> Parameters: 
2021-08-26 07:04:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871915226501120 [0;39m <==    Updates: 0
2021-08-26 07:04:20.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871915226501120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:04:25.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871936160272384 [0;39m 生成今日电子书快照开始
2021-08-26 07:04:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871936160272384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:04:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871936160272384 [0;39m ==> Parameters: 
2021-08-26 07:04:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871936160272384 [0;39m <==    Updates: 0
2021-08-26 07:04:25.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871936160272384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:04:30.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871957177929728 [0;39m 生成今日电子书快照开始
2021-08-26 07:04:30.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871957177929728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:04:30.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871957177929728 [0;39m ==> Parameters: 
2021-08-26 07:04:30.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871957177929728 [0;39m <==    Updates: 0
2021-08-26 07:04:30.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871957177929728 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:04:35.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85871978124283904 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:04:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871978124283904 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:04:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871978124283904 [0;39m ==> Parameters: 
2021-08-26 07:04:35.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85871978124283904 [0;39m <==    Updates: 5
2021-08-26 07:04:35.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85871978124283904 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:04:35.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871978128478208 [0;39m 生成今日电子书快照开始
2021-08-26 07:04:35.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871978128478208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:04:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871978128478208 [0;39m ==> Parameters: 
2021-08-26 07:04:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871978128478208 [0;39m <==    Updates: 0
2021-08-26 07:04:35.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871978128478208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:04:40.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85871999108386816 [0;39m 生成今日电子书快照开始
2021-08-26 07:04:40.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871999108386816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:04:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871999108386816 [0;39m ==> Parameters: 
2021-08-26 07:04:40.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85871999108386816 [0;39m <==    Updates: 0
2021-08-26 07:04:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85871999108386816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:04:45.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872020058935296 [0;39m 生成今日电子书快照开始
2021-08-26 07:04:45.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872020058935296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:04:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872020058935296 [0;39m ==> Parameters: 
2021-08-26 07:04:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872020058935296 [0;39m <==    Updates: 0
2021-08-26 07:04:45.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872020058935296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:04:50.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872041055621120 [0;39m 生成今日电子书快照开始
2021-08-26 07:04:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872041055621120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:04:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872041055621120 [0;39m ==> Parameters: 
2021-08-26 07:04:50.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872041055621120 [0;39m <==    Updates: 0
2021-08-26 07:04:50.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872041055621120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:04:55.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872062027141120 [0;39m 生成今日电子书快照开始
2021-08-26 07:04:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872062027141120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:04:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872062027141120 [0;39m ==> Parameters: 
2021-08-26 07:04:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872062027141120 [0;39m <==    Updates: 0
2021-08-26 07:04:55.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872062027141120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:05:00.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872082960912384 [0;39m 生成今日电子书快照开始
2021-08-26 07:05:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872082960912384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:05:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872082960912384 [0;39m ==> Parameters: 
2021-08-26 07:05:00.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872082960912384 [0;39m <==    Updates: 0
2021-08-26 07:05:00.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872082960912384 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:05:05.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872103936626688 [0;39m 生成今日电子书快照开始
2021-08-26 07:05:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872103936626688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:05:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872103936626688 [0;39m ==> Parameters: 
2021-08-26 07:05:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872103936626688 [0;39m <==    Updates: 0
2021-08-26 07:05:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872103936626688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:05:05.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85872103945015296 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:05:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872103945015296 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:05:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872103945015296 [0;39m ==> Parameters: 
2021-08-26 07:05:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872103945015296 [0;39m <==    Updates: 5
2021-08-26 07:05:05.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85872103945015296 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:05:10.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872124941701120 [0;39m 生成今日电子书快照开始
2021-08-26 07:05:10.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872124941701120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:05:10.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872124941701120 [0;39m ==> Parameters: 
2021-08-26 07:05:10.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872124941701120 [0;39m <==    Updates: 0
2021-08-26 07:05:10.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872124941701120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:05:15.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872145917415424 [0;39m 生成今日电子书快照开始
2021-08-26 07:05:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872145917415424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:05:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872145917415424 [0;39m ==> Parameters: 
2021-08-26 07:05:15.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872145917415424 [0;39m <==    Updates: 0
2021-08-26 07:05:15.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872145917415424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:05:20.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872166842798080 [0;39m 生成今日电子书快照开始
2021-08-26 07:05:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872166842798080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:05:20.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872166842798080 [0;39m ==> Parameters: 
2021-08-26 07:05:20.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872166842798080 [0;39m <==    Updates: 0
2021-08-26 07:05:20.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872166842798080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:05:25.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872187856261120 [0;39m 生成今日电子书快照开始
2021-08-26 07:05:25.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872187856261120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:05:25.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872187856261120 [0;39m ==> Parameters: 
2021-08-26 07:05:25.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872187856261120 [0;39m <==    Updates: 0
2021-08-26 07:05:25.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872187856261120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:05:30.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872208790032384 [0;39m 生成今日电子书快照开始
2021-08-26 07:05:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872208790032384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:05:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872208790032384 [0;39m ==> Parameters: 
2021-08-26 07:05:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872208790032384 [0;39m <==    Updates: 0
2021-08-26 07:05:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872208790032384 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:05:35.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85872229769940992 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:05:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872229769940992 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:05:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872229769940992 [0;39m ==> Parameters: 
2021-08-26 07:05:35.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872229769940992 [0;39m <==    Updates: 5
2021-08-26 07:05:35.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85872229769940992 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:05:35.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872229778329600 [0;39m 生成今日电子书快照开始
2021-08-26 07:05:35.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872229778329600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:05:35.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872229778329600 [0;39m ==> Parameters: 
2021-08-26 07:05:35.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872229778329600 [0;39m <==    Updates: 0
2021-08-26 07:05:35.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872229778329600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:05:40.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872250770821120 [0;39m 生成今日电子书快照开始
2021-08-26 07:05:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872250770821120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:05:40.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872250770821120 [0;39m ==> Parameters: 
2021-08-26 07:05:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872250770821120 [0;39m <==    Updates: 0
2021-08-26 07:05:40.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872250770821120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:05:45.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872271721369600 [0;39m 生成今日电子书快照开始
2021-08-26 07:05:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872271721369600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:05:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872271721369600 [0;39m ==> Parameters: 
2021-08-26 07:05:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872271721369600 [0;39m <==    Updates: 0
2021-08-26 07:05:45.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872271721369600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:05:50.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872292701278208 [0;39m 生成今日电子书快照开始
2021-08-26 07:05:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872292701278208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:05:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872292701278208 [0;39m ==> Parameters: 
2021-08-26 07:05:50.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872292701278208 [0;39m <==    Updates: 0
2021-08-26 07:05:50.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872292701278208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:05:55.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872313643438080 [0;39m 生成今日电子书快照开始
2021-08-26 07:05:55.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872313643438080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:05:55.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872313643438080 [0;39m ==> Parameters: 
2021-08-26 07:05:55.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872313643438080 [0;39m <==    Updates: 0
2021-08-26 07:05:55.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872313643438080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:06:00.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872334665289728 [0;39m 生成今日电子书快照开始
2021-08-26 07:06:00.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872334665289728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:06:00.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872334665289728 [0;39m ==> Parameters: 
2021-08-26 07:06:00.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872334665289728 [0;39m <==    Updates: 0
2021-08-26 07:06:00.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872334665289728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:06:05.003 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85872355586478080 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:06:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872355586478080 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:06:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872355586478080 [0;39m ==> Parameters: 
2021-08-26 07:06:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872355586478080 [0;39m <==    Updates: 5
2021-08-26 07:06:05.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85872355586478080 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:06:05.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872355594866688 [0;39m 生成今日电子书快照开始
2021-08-26 07:06:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872355594866688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:06:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872355594866688 [0;39m ==> Parameters: 
2021-08-26 07:06:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872355594866688 [0;39m <==    Updates: 0
2021-08-26 07:06:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872355594866688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:06:10.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872376570580992 [0;39m 生成今日电子书快照开始
2021-08-26 07:06:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872376570580992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:06:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872376570580992 [0;39m ==> Parameters: 
2021-08-26 07:06:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872376570580992 [0;39m <==    Updates: 0
2021-08-26 07:06:10.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872376570580992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:06:15.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872397579849728 [0;39m 生成今日电子书快照开始
2021-08-26 07:06:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872397579849728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:06:15.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872397579849728 [0;39m ==> Parameters: 
2021-08-26 07:06:15.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872397579849728 [0;39m <==    Updates: 0
2021-08-26 07:06:15.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872397579849728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:06:20.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872418513620992 [0;39m 生成今日电子书快照开始
2021-08-26 07:06:20.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872418513620992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:06:20.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872418513620992 [0;39m ==> Parameters: 
2021-08-26 07:06:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872418513620992 [0;39m <==    Updates: 0
2021-08-26 07:06:20.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872418513620992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:06:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872439501918208 [0;39m 生成今日电子书快照开始
2021-08-26 07:06:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872439501918208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:06:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872439501918208 [0;39m ==> Parameters: 
2021-08-26 07:06:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872439501918208 [0;39m <==    Updates: 0
2021-08-26 07:06:25.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872439501918208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:06:30.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872460460855296 [0;39m 生成今日电子书快照开始
2021-08-26 07:06:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872460460855296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:06:30.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872460460855296 [0;39m ==> Parameters: 
2021-08-26 07:06:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872460460855296 [0;39m <==    Updates: 0
2021-08-26 07:06:30.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872460460855296 [0;39m 生成今日电子书快照结束，耗时：7毫秒
2021-08-26 07:06:35.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872481444958208 [0;39m 生成今日电子书快照开始
2021-08-26 07:06:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872481444958208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:06:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872481444958208 [0;39m ==> Parameters: 
2021-08-26 07:06:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872481444958208 [0;39m <==    Updates: 0
2021-08-26 07:06:35.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872481444958208 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:06:35.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85872481453346816 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:06:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872481453346816 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:06:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872481453346816 [0;39m ==> Parameters: 
2021-08-26 07:06:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872481453346816 [0;39m <==    Updates: 5
2021-08-26 07:06:35.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85872481453346816 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:06:40.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872502437449728 [0;39m 生成今日电子书快照开始
2021-08-26 07:06:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872502437449728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:06:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872502437449728 [0;39m ==> Parameters: 
2021-08-26 07:06:40.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872502437449728 [0;39m <==    Updates: 0
2021-08-26 07:06:40.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872502437449728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:06:45.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872523358638080 [0;39m 生成今日电子书快照开始
2021-08-26 07:06:45.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872523358638080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:06:45.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872523358638080 [0;39m ==> Parameters: 
2021-08-26 07:06:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872523358638080 [0;39m <==    Updates: 0
2021-08-26 07:06:45.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872523358638080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:06:50.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872544330158080 [0;39m 生成今日电子书快照开始
2021-08-26 07:06:50.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872544330158080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:06:50.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872544330158080 [0;39m ==> Parameters: 
2021-08-26 07:06:50.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872544330158080 [0;39m <==    Updates: 0
2021-08-26 07:06:50.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872544330158080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:06:55.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872565356204032 [0;39m 生成今日电子书快照开始
2021-08-26 07:06:55.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872565356204032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:06:55.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872565356204032 [0;39m ==> Parameters: 
2021-08-26 07:06:55.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872565356204032 [0;39m <==    Updates: 0
2021-08-26 07:06:55.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872565356204032 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:07:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872586281586688 [0;39m 生成今日电子书快照开始
2021-08-26 07:07:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872586281586688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:07:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872586281586688 [0;39m ==> Parameters: 
2021-08-26 07:07:00.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872586281586688 [0;39m <==    Updates: 0
2021-08-26 07:07:00.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872586281586688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:07:02.097 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :218  [32m                  [0;39m Shutting down ExecutorService 'taskScheduler'
2021-08-26 07:07:02.097 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :218  [32m                  [0;39m Shutting down ExecutorService 'applicationTaskExecutor'
2021-08-26 07:07:02.098 INFO  com.zaxxer.hikari.HikariDataSource                :350  [32m                  [0;39m HikariPool-1 - Shutdown initiated...
2021-08-26 07:07:02.104 INFO  com.zaxxer.hikari.HikariDataSource                :352  [32m                  [0;39m HikariPool-1 - Shutdown completed.
2021-08-26 07:07:02.267 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :55   [32m                  [0;39m Starting KnowlagebaseApplication using Java 1.8.0_261 on DESKTOP-CTIIJC1 with PID 14496 (E:\code\java\knowlagebase\target\classes started by MECHREVO in E:\code\java\knowlagebase)
2021-08-26 07:07:02.267 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-08-26 07:07:02.399 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-08-26 07:07:02.399 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-08-26 07:07:02.401 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 1 ms. Found 0 Redis repository interfaces.
2021-08-26 07:07:02.516 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8880 (http)
2021-08-26 07:07:02.516 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8880"]
2021-08-26 07:07:02.516 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-08-26 07:07:02.517 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2021-08-26 07:07:02.538 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-08-26 07:07:02.538 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 269 ms
2021-08-26 07:07:02.779 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2021-08-26 07:07:02.945 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2021-08-26 07:07:02.964 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2021-08-26 07:07:02.972 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8880"]
2021-08-26 07:07:02.974 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8880 (http) with context path ''
2021-08-26 07:07:02.978 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :61   [32m                  [0;39m Started KnowlagebaseApplication in 0.738 seconds (JVM running for 830.447)
2021-08-26 07:07:02.980 INFO  o.s.b.d.a.ConditionEvaluationDeltaLoggingListener :63   [32m                  [0;39m Condition evaluation unchanged
2021-08-26 07:07:02.980 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :28   [32m                  [0;39m 启动成功！
2021-08-26 07:07:02.980 INFO  c.h.knowlagebase.config.KnowlagebaseApplication   :29   [32m                  [0;39m 地址：	http://127.0.0.1:8880
2021-08-26 07:07:05.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85872607286661120 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:07:05.018 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m85872607286661120 [0;39m HikariPool-2 - Starting...
2021-08-26 07:07:05.032 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m85872607286661120 [0;39m HikariPool-2 - Start completed.
2021-08-26 07:07:05.033 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872607286661120 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:07:05.033 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872607286661120 [0;39m ==> Parameters: 
2021-08-26 07:07:05.034 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872607286661120 [0;39m <==    Updates: 5
2021-08-26 07:07:05.035 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85872607286661120 [0;39m 更新电子书下的文档数据结束，耗时：21毫秒
2021-08-26 07:07:05.035 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872607378935808 [0;39m 生成今日电子书快照开始
2021-08-26 07:07:05.035 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872607378935808 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:07:05.036 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872607378935808 [0;39m ==> Parameters: 
2021-08-26 07:07:05.037 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872607378935808 [0;39m <==    Updates: 0
2021-08-26 07:07:05.037 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872607378935808 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:07:10.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872628262375424 [0;39m 生成今日电子书快照开始
2021-08-26 07:07:10.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872628262375424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:07:10.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872628262375424 [0;39m ==> Parameters: 
2021-08-26 07:07:10.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872628262375424 [0;39m <==    Updates: 0
2021-08-26 07:07:10.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872628262375424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:07:15.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872649229701120 [0;39m 生成今日电子书快照开始
2021-08-26 07:07:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872649229701120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:07:15.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872649229701120 [0;39m ==> Parameters: 
2021-08-26 07:07:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872649229701120 [0;39m <==    Updates: 0
2021-08-26 07:07:15.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872649229701120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:07:20.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872670201221120 [0;39m 生成今日电子书快照开始
2021-08-26 07:07:20.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872670201221120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:07:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872670201221120 [0;39m ==> Parameters: 
2021-08-26 07:07:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872670201221120 [0;39m <==    Updates: 0
2021-08-26 07:07:20.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872670201221120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:07:25.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872691139186688 [0;39m 生成今日电子书快照开始
2021-08-26 07:07:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872691139186688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:07:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872691139186688 [0;39m ==> Parameters: 
2021-08-26 07:07:25.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872691139186688 [0;39m <==    Updates: 0
2021-08-26 07:07:25.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872691139186688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:07:30.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872712106512384 [0;39m 生成今日电子书快照开始
2021-08-26 07:07:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872712106512384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:07:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872712106512384 [0;39m ==> Parameters: 
2021-08-26 07:07:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872712106512384 [0;39m <==    Updates: 0
2021-08-26 07:07:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872712106512384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:07:35.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872733078032384 [0;39m 生成今日电子书快照开始
2021-08-26 07:07:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872733078032384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:07:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872733078032384 [0;39m ==> Parameters: 
2021-08-26 07:07:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872733078032384 [0;39m <==    Updates: 0
2021-08-26 07:07:35.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872733078032384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:07:35.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85872733086420992 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:07:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872733086420992 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:07:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872733086420992 [0;39m ==> Parameters: 
2021-08-26 07:07:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872733086420992 [0;39m <==    Updates: 5
2021-08-26 07:07:35.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85872733086420992 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:07:40.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872754074718208 [0;39m 生成今日电子书快照开始
2021-08-26 07:07:40.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872754074718208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:07:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872754074718208 [0;39m ==> Parameters: 
2021-08-26 07:07:40.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872754074718208 [0;39m <==    Updates: 0
2021-08-26 07:07:40.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872754074718208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:07:45.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872775012683776 [0;39m 生成今日电子书快照开始
2021-08-26 07:07:45.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872775012683776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:07:45.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872775012683776 [0;39m ==> Parameters: 
2021-08-26 07:07:45.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872775012683776 [0;39m <==    Updates: 0
2021-08-26 07:07:45.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872775012683776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:07:50.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872796005175296 [0;39m 生成今日电子书快照开始
2021-08-26 07:07:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872796005175296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:07:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872796005175296 [0;39m ==> Parameters: 
2021-08-26 07:07:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872796005175296 [0;39m <==    Updates: 0
2021-08-26 07:07:50.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872796005175296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:07:55.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872816976695296 [0;39m 生成今日电子书快照开始
2021-08-26 07:07:55.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872816976695296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:07:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872816976695296 [0;39m ==> Parameters: 
2021-08-26 07:07:55.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872816976695296 [0;39m <==    Updates: 0
2021-08-26 07:07:55.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872816976695296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:08:00.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872837969186816 [0;39m 生成今日电子书快照开始
2021-08-26 07:08:00.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872837969186816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:08:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872837969186816 [0;39m ==> Parameters: 
2021-08-26 07:08:00.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872837969186816 [0;39m <==    Updates: 0
2021-08-26 07:08:00.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872837969186816 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:08:05.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872858932318208 [0;39m 生成今日电子书快照开始
2021-08-26 07:08:05.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872858932318208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:08:05.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872858932318208 [0;39m ==> Parameters: 
2021-08-26 07:08:05.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872858932318208 [0;39m <==    Updates: 0
2021-08-26 07:08:05.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872858932318208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:08:05.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85872858940706816 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:08:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872858940706816 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:08:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872858940706816 [0;39m ==> Parameters: 
2021-08-26 07:08:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872858940706816 [0;39m <==    Updates: 5
2021-08-26 07:08:05.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85872858940706816 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:08:10.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872879866089472 [0;39m 生成今日电子书快照开始
2021-08-26 07:08:10.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872879866089472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:08:10.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872879866089472 [0;39m ==> Parameters: 
2021-08-26 07:08:10.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872879866089472 [0;39m <==    Updates: 0
2021-08-26 07:08:10.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872879866089472 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:08:15.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872900883746816 [0;39m 生成今日电子书快照开始
2021-08-26 07:08:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872900883746816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:08:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872900883746816 [0;39m ==> Parameters: 
2021-08-26 07:08:15.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872900883746816 [0;39m <==    Updates: 0
2021-08-26 07:08:15.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872900883746816 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:08:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872921863655424 [0;39m 生成今日电子书快照开始
2021-08-26 07:08:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872921863655424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:08:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872921863655424 [0;39m ==> Parameters: 
2021-08-26 07:08:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872921863655424 [0;39m <==    Updates: 0
2021-08-26 07:08:20.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872921863655424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:08:25.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872942780649472 [0;39m 生成今日电子书快照开始
2021-08-26 07:08:25.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872942780649472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:08:25.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872942780649472 [0;39m ==> Parameters: 
2021-08-26 07:08:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872942780649472 [0;39m <==    Updates: 0
2021-08-26 07:08:25.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872942780649472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:08:30.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872963781529600 [0;39m 生成今日电子书快照开始
2021-08-26 07:08:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872963781529600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:08:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872963781529600 [0;39m ==> Parameters: 
2021-08-26 07:08:30.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872963781529600 [0;39m <==    Updates: 0
2021-08-26 07:08:30.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872963781529600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:08:35.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85872984765632512 [0;39m 生成今日电子书快照开始
2021-08-26 07:08:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872984765632512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:08:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872984765632512 [0;39m ==> Parameters: 
2021-08-26 07:08:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85872984765632512 [0;39m <==    Updates: 0
2021-08-26 07:08:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85872984765632512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:08:35.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85872984774021120 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:08:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872984774021120 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:08:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872984774021120 [0;39m ==> Parameters: 
2021-08-26 07:08:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85872984774021120 [0;39m <==    Updates: 5
2021-08-26 07:08:35.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85872984774021120 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:08:40.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873005732958208 [0;39m 生成今日电子书快照开始
2021-08-26 07:08:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873005732958208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:08:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873005732958208 [0;39m ==> Parameters: 
2021-08-26 07:08:40.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873005732958208 [0;39m <==    Updates: 0
2021-08-26 07:08:40.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873005732958208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:08:45.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873026708672512 [0;39m 生成今日电子书快照开始
2021-08-26 07:08:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873026708672512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:08:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873026708672512 [0;39m ==> Parameters: 
2021-08-26 07:08:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873026708672512 [0;39m <==    Updates: 0
2021-08-26 07:08:45.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873026708672512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:08:50.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873047638249472 [0;39m 生成今日电子书快照开始
2021-08-26 07:08:50.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873047638249472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:08:50.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873047638249472 [0;39m ==> Parameters: 
2021-08-26 07:08:50.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873047638249472 [0;39m <==    Updates: 0
2021-08-26 07:08:50.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873047638249472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:08:55.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873068655906816 [0;39m 生成今日电子书快照开始
2021-08-26 07:08:55.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873068655906816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:08:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873068655906816 [0;39m ==> Parameters: 
2021-08-26 07:08:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873068655906816 [0;39m <==    Updates: 0
2021-08-26 07:08:55.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873068655906816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:09:00.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873089602260992 [0;39m 生成今日电子书快照开始
2021-08-26 07:09:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873089602260992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:09:00.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873089602260992 [0;39m ==> Parameters: 
2021-08-26 07:09:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873089602260992 [0;39m <==    Updates: 0
2021-08-26 07:09:00.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873089602260992 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:09:05.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873110611529728 [0;39m 生成今日电子书快照开始
2021-08-26 07:09:05.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873110611529728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:09:05.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873110611529728 [0;39m ==> Parameters: 
2021-08-26 07:09:05.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873110611529728 [0;39m <==    Updates: 0
2021-08-26 07:09:05.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873110611529728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:09:05.017 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85873110619918336 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:09:05.018 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873110619918336 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:09:05.018 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873110619918336 [0;39m ==> Parameters: 
2021-08-26 07:09:05.018 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873110619918336 [0;39m <==    Updates: 5
2021-08-26 07:09:05.018 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85873110619918336 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:09:10.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873131549495296 [0;39m 生成今日电子书快照开始
2021-08-26 07:09:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873131549495296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:09:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873131549495296 [0;39m ==> Parameters: 
2021-08-26 07:09:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873131549495296 [0;39m <==    Updates: 0
2021-08-26 07:09:10.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873131549495296 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:09:15.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873152525209600 [0;39m 生成今日电子书快照开始
2021-08-26 07:09:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873152525209600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:09:15.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873152525209600 [0;39m ==> Parameters: 
2021-08-26 07:09:15.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873152525209600 [0;39m <==    Updates: 0
2021-08-26 07:09:15.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873152525209600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:09:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873173521895424 [0;39m 生成今日电子书快照开始
2021-08-26 07:09:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873173521895424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:09:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873173521895424 [0;39m ==> Parameters: 
2021-08-26 07:09:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873173521895424 [0;39m <==    Updates: 0
2021-08-26 07:09:20.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873173521895424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:09:25.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873194497609728 [0;39m 生成今日电子书快照开始
2021-08-26 07:09:25.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873194497609728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:09:25.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873194497609728 [0;39m ==> Parameters: 
2021-08-26 07:09:25.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873194497609728 [0;39m <==    Updates: 0
2021-08-26 07:09:25.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873194497609728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:09:30.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873215422992384 [0;39m 生成今日电子书快照开始
2021-08-26 07:09:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873215422992384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:09:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873215422992384 [0;39m ==> Parameters: 
2021-08-26 07:09:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873215422992384 [0;39m <==    Updates: 0
2021-08-26 07:09:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873215422992384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:09:35.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85873236411289600 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:09:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873236411289600 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:09:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873236411289600 [0;39m ==> Parameters: 
2021-08-26 07:09:35.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873236411289600 [0;39m <==    Updates: 5
2021-08-26 07:09:35.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85873236411289600 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:09:35.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873236419678208 [0;39m 生成今日电子书快照开始
2021-08-26 07:09:35.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873236419678208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:09:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873236419678208 [0;39m ==> Parameters: 
2021-08-26 07:09:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873236419678208 [0;39m <==    Updates: 0
2021-08-26 07:09:35.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873236419678208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:09:40.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873257403781120 [0;39m 生成今日电子书快照开始
2021-08-26 07:09:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873257403781120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:09:40.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873257403781120 [0;39m ==> Parameters: 
2021-08-26 07:09:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873257403781120 [0;39m <==    Updates: 0
2021-08-26 07:09:40.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873257403781120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:09:45.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873278375301120 [0;39m 生成今日电子书快照开始
2021-08-26 07:09:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873278375301120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:09:45.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873278375301120 [0;39m ==> Parameters: 
2021-08-26 07:09:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873278375301120 [0;39m <==    Updates: 0
2021-08-26 07:09:45.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873278375301120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:09:50.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873299296489472 [0;39m 生成今日电子书快照开始
2021-08-26 07:09:50.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873299296489472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:09:50.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873299296489472 [0;39m ==> Parameters: 
2021-08-26 07:09:50.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873299296489472 [0;39m <==    Updates: 0
2021-08-26 07:09:50.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873299296489472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:09:55.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873320322535424 [0;39m 生成今日电子书快照开始
2021-08-26 07:09:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873320322535424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:09:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873320322535424 [0;39m ==> Parameters: 
2021-08-26 07:09:55.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873320322535424 [0;39m <==    Updates: 0
2021-08-26 07:09:55.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873320322535424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:10:00.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873341247918080 [0;39m 生成今日电子书快照开始
2021-08-26 07:10:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873341247918080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:10:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873341247918080 [0;39m ==> Parameters: 
2021-08-26 07:10:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873341247918080 [0;39m <==    Updates: 0
2021-08-26 07:10:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873341247918080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:10:05.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873362227826688 [0;39m 生成今日电子书快照开始
2021-08-26 07:10:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873362227826688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:10:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873362227826688 [0;39m ==> Parameters: 
2021-08-26 07:10:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873362227826688 [0;39m <==    Updates: 0
2021-08-26 07:10:05.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873362227826688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:10:05.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85873362240409600 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:10:05.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873362240409600 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:10:05.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873362240409600 [0;39m ==> Parameters: 
2021-08-26 07:10:05.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873362240409600 [0;39m <==    Updates: 5
2021-08-26 07:10:05.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85873362240409600 [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-08-26 07:10:10.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873383228706816 [0;39m 生成今日电子书快照开始
2021-08-26 07:10:10.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873383228706816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:10:10.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873383228706816 [0;39m ==> Parameters: 
2021-08-26 07:10:10.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873383228706816 [0;39m <==    Updates: 0
2021-08-26 07:10:10.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873383228706816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:10:15.000 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873404149895168 [0;39m 生成今日电子书快照开始
2021-08-26 07:10:15.000 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873404149895168 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:10:15.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873404149895168 [0;39m ==> Parameters: 
2021-08-26 07:10:15.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873404149895168 [0;39m <==    Updates: 0
2021-08-26 07:10:15.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873404149895168 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:10:20.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873425129803776 [0;39m 生成今日电子书快照开始
2021-08-26 07:10:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873425129803776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:10:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873425129803776 [0;39m ==> Parameters: 
2021-08-26 07:10:20.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873425129803776 [0;39m <==    Updates: 0
2021-08-26 07:10:20.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873425129803776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:10:25.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873446109712384 [0;39m 生成今日电子书快照开始
2021-08-26 07:10:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873446109712384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:10:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873446109712384 [0;39m ==> Parameters: 
2021-08-26 07:10:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873446109712384 [0;39m <==    Updates: 0
2021-08-26 07:10:25.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873446109712384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:10:30.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873467110592512 [0;39m 生成今日电子书快照开始
2021-08-26 07:10:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873467110592512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:10:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873467110592512 [0;39m ==> Parameters: 
2021-08-26 07:10:30.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873467110592512 [0;39m <==    Updates: 0
2021-08-26 07:10:30.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873467110592512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:10:35.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85873488056946688 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:10:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873488056946688 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:10:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873488056946688 [0;39m ==> Parameters: 
2021-08-26 07:10:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873488056946688 [0;39m <==    Updates: 5
2021-08-26 07:10:35.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85873488056946688 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:10:35.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873488065335296 [0;39m 生成今日电子书快照开始
2021-08-26 07:10:35.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873488065335296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:10:35.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873488065335296 [0;39m ==> Parameters: 
2021-08-26 07:10:35.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873488065335296 [0;39m <==    Updates: 0
2021-08-26 07:10:35.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873488065335296 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:10:40.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873509074604032 [0;39m 生成今日电子书快照开始
2021-08-26 07:10:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873509074604032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:10:40.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873509074604032 [0;39m ==> Parameters: 
2021-08-26 07:10:40.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873509074604032 [0;39m <==    Updates: 0
2021-08-26 07:10:40.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873509074604032 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:10:45.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873530025152512 [0;39m 生成今日电子书快照开始
2021-08-26 07:10:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873530025152512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:10:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873530025152512 [0;39m ==> Parameters: 
2021-08-26 07:10:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873530025152512 [0;39m <==    Updates: 0
2021-08-26 07:10:45.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873530025152512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:10:50.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873551000866816 [0;39m 生成今日电子书快照开始
2021-08-26 07:10:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873551000866816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:10:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873551000866816 [0;39m ==> Parameters: 
2021-08-26 07:10:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873551000866816 [0;39m <==    Updates: 0
2021-08-26 07:10:50.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873551000866816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:10:55.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873571926249472 [0;39m 生成今日电子书快照开始
2021-08-26 07:10:55.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873571926249472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:10:55.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873571926249472 [0;39m ==> Parameters: 
2021-08-26 07:10:55.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873571926249472 [0;39m <==    Updates: 0
2021-08-26 07:10:55.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873571926249472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:11:00.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873592948101120 [0;39m 生成今日电子书快照开始
2021-08-26 07:11:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873592948101120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:11:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873592948101120 [0;39m ==> Parameters: 
2021-08-26 07:11:00.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873592948101120 [0;39m <==    Updates: 0
2021-08-26 07:11:00.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873592948101120 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:11:05.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85873613894455296 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:11:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873613894455296 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:11:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873613894455296 [0;39m ==> Parameters: 
2021-08-26 07:11:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873613894455296 [0;39m <==    Updates: 5
2021-08-26 07:11:05.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85873613894455296 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:11:05.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873613902843904 [0;39m 生成今日电子书快照开始
2021-08-26 07:11:05.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873613902843904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:11:05.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873613902843904 [0;39m ==> Parameters: 
2021-08-26 07:11:05.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873613902843904 [0;39m <==    Updates: 0
2021-08-26 07:11:05.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873613902843904 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:11:10.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873634857586688 [0;39m 生成今日电子书快照开始
2021-08-26 07:11:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873634857586688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:11:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873634857586688 [0;39m ==> Parameters: 
2021-08-26 07:11:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873634857586688 [0;39m <==    Updates: 0
2021-08-26 07:11:10.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873634857586688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:11:15.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873655871049728 [0;39m 生成今日电子书快照开始
2021-08-26 07:11:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873655871049728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:11:15.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873655871049728 [0;39m ==> Parameters: 
2021-08-26 07:11:15.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873655871049728 [0;39m <==    Updates: 0
2021-08-26 07:11:15.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873655871049728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:11:20.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873676788043776 [0;39m 生成今日电子书快照开始
2021-08-26 07:11:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873676788043776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:11:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873676788043776 [0;39m ==> Parameters: 
2021-08-26 07:11:20.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873676788043776 [0;39m <==    Updates: 0
2021-08-26 07:11:20.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873676788043776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:11:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873697793118208 [0;39m 生成今日电子书快照开始
2021-08-26 07:11:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873697793118208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:11:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873697793118208 [0;39m ==> Parameters: 
2021-08-26 07:11:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873697793118208 [0;39m <==    Updates: 0
2021-08-26 07:11:25.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873697793118208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:11:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873718747860992 [0;39m 生成今日电子书快照开始
2021-08-26 07:11:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873718747860992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:11:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873718747860992 [0;39m ==> Parameters: 
2021-08-26 07:11:30.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873718747860992 [0;39m <==    Updates: 0
2021-08-26 07:11:30.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873718747860992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:11:35.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873739723575296 [0;39m 生成今日电子书快照开始
2021-08-26 07:11:35.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873739723575296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:11:35.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873739723575296 [0;39m ==> Parameters: 
2021-08-26 07:11:35.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873739723575296 [0;39m <==    Updates: 0
2021-08-26 07:11:35.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873739723575296 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:11:35.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85873739736158208 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:11:35.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873739736158208 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:11:35.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873739736158208 [0;39m ==> Parameters: 
2021-08-26 07:11:35.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873739736158208 [0;39m <==    Updates: 5
2021-08-26 07:11:35.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85873739736158208 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:11:40.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873760716066816 [0;39m 生成今日电子书快照开始
2021-08-26 07:11:40.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873760716066816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:11:40.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873760716066816 [0;39m ==> Parameters: 
2021-08-26 07:11:40.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873760716066816 [0;39m <==    Updates: 0
2021-08-26 07:11:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873760716066816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:11:45.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873781670809600 [0;39m 生成今日电子书快照开始
2021-08-26 07:11:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873781670809600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:11:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873781670809600 [0;39m ==> Parameters: 
2021-08-26 07:11:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873781670809600 [0;39m <==    Updates: 0
2021-08-26 07:11:45.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873781670809600 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:11:50.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873802642329600 [0;39m 生成今日电子书快照开始
2021-08-26 07:11:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873802642329600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:11:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873802642329600 [0;39m ==> Parameters: 
2021-08-26 07:11:50.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873802642329600 [0;39m <==    Updates: 0
2021-08-26 07:11:50.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873802642329600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:11:55.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873823626432512 [0;39m 生成今日电子书快照开始
2021-08-26 07:11:55.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873823626432512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:11:55.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873823626432512 [0;39m ==> Parameters: 
2021-08-26 07:11:55.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873823626432512 [0;39m <==    Updates: 0
2021-08-26 07:11:55.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873823626432512 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:12:00.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873844560203776 [0;39m 生成今日电子书快照开始
2021-08-26 07:12:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873844560203776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:12:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873844560203776 [0;39m ==> Parameters: 
2021-08-26 07:12:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873844560203776 [0;39m <==    Updates: 0
2021-08-26 07:12:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873844560203776 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:12:05.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873865565278208 [0;39m 生成今日电子书快照开始
2021-08-26 07:12:05.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873865565278208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:12:05.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873865565278208 [0;39m ==> Parameters: 
2021-08-26 07:12:05.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873865565278208 [0;39m <==    Updates: 0
2021-08-26 07:12:05.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873865565278208 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:12:05.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85873865577861120 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:12:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873865577861120 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:12:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873865577861120 [0;39m ==> Parameters: 
2021-08-26 07:12:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873865577861120 [0;39m <==    Updates: 5
2021-08-26 07:12:05.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85873865577861120 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:12:10.000 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873886494855168 [0;39m 生成今日电子书快照开始
2021-08-26 07:12:10.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873886494855168 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:12:10.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873886494855168 [0;39m ==> Parameters: 
2021-08-26 07:12:10.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873886494855168 [0;39m <==    Updates: 0
2021-08-26 07:12:10.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873886494855168 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:12:15.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873907512512512 [0;39m 生成今日电子书快照开始
2021-08-26 07:12:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873907512512512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:12:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873907512512512 [0;39m ==> Parameters: 
2021-08-26 07:12:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873907512512512 [0;39m <==    Updates: 0
2021-08-26 07:12:15.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873907512512512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:12:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873928496615424 [0;39m 生成今日电子书快照开始
2021-08-26 07:12:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873928496615424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:12:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873928496615424 [0;39m ==> Parameters: 
2021-08-26 07:12:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873928496615424 [0;39m <==    Updates: 0
2021-08-26 07:12:20.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873928496615424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:12:25.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873949468135424 [0;39m 生成今日电子书快照开始
2021-08-26 07:12:25.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873949468135424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:12:25.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873949468135424 [0;39m ==> Parameters: 
2021-08-26 07:12:25.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873949468135424 [0;39m <==    Updates: 0
2021-08-26 07:12:25.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873949468135424 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:12:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873970401906688 [0;39m 生成今日电子书快照开始
2021-08-26 07:12:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873970401906688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:12:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873970401906688 [0;39m ==> Parameters: 
2021-08-26 07:12:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873970401906688 [0;39m <==    Updates: 0
2021-08-26 07:12:30.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873970401906688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:12:35.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85873991398592512 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:12:35.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873991398592512 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:12:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873991398592512 [0;39m ==> Parameters: 
2021-08-26 07:12:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85873991398592512 [0;39m <==    Updates: 5
2021-08-26 07:12:35.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85873991398592512 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:12:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85873991406981120 [0;39m 生成今日电子书快照开始
2021-08-26 07:12:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873991406981120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:12:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873991406981120 [0;39m ==> Parameters: 
2021-08-26 07:12:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85873991406981120 [0;39m <==    Updates: 0
2021-08-26 07:12:35.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85873991406981120 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:12:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874012382695424 [0;39m 生成今日电子书快照开始
2021-08-26 07:12:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874012382695424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:12:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874012382695424 [0;39m ==> Parameters: 
2021-08-26 07:12:40.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874012382695424 [0;39m <==    Updates: 0
2021-08-26 07:12:40.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874012382695424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:12:45.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874033350021120 [0;39m 生成今日电子书快照开始
2021-08-26 07:12:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874033350021120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:12:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874033350021120 [0;39m ==> Parameters: 
2021-08-26 07:12:45.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874033350021120 [0;39m <==    Updates: 0
2021-08-26 07:12:45.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874033350021120 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:12:50.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874054296375296 [0;39m 生成今日电子书快照开始
2021-08-26 07:12:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874054296375296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:12:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874054296375296 [0;39m ==> Parameters: 
2021-08-26 07:12:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874054296375296 [0;39m <==    Updates: 0
2021-08-26 07:12:50.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874054296375296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:12:55.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874075272089600 [0;39m 生成今日电子书快照开始
2021-08-26 07:12:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874075272089600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:12:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874075272089600 [0;39m ==> Parameters: 
2021-08-26 07:12:55.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874075272089600 [0;39m <==    Updates: 0
2021-08-26 07:12:55.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874075272089600 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:13:00.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874096239415296 [0;39m 生成今日电子书快照开始
2021-08-26 07:13:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874096239415296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:13:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874096239415296 [0;39m ==> Parameters: 
2021-08-26 07:13:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874096239415296 [0;39m <==    Updates: 0
2021-08-26 07:13:00.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874096239415296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:13:05.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85874117244489728 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:13:05.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874117244489728 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:13:05.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874117244489728 [0;39m ==> Parameters: 
2021-08-26 07:13:05.019 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874117244489728 [0;39m <==    Updates: 5
2021-08-26 07:13:05.019 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85874117244489728 [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-08-26 07:13:05.020 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874117265461248 [0;39m 生成今日电子书快照开始
2021-08-26 07:13:05.020 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874117265461248 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:13:05.021 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874117265461248 [0;39m ==> Parameters: 
2021-08-26 07:13:05.025 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874117265461248 [0;39m <==    Updates: 0
2021-08-26 07:13:05.025 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874117265461248 [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-08-26 07:13:10.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874138169872384 [0;39m 生成今日电子书快照开始
2021-08-26 07:13:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874138169872384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:13:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874138169872384 [0;39m ==> Parameters: 
2021-08-26 07:13:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874138169872384 [0;39m <==    Updates: 0
2021-08-26 07:13:10.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874138169872384 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:13:15.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874159183335424 [0;39m 生成今日电子书快照开始
2021-08-26 07:13:15.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874159183335424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:13:15.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874159183335424 [0;39m ==> Parameters: 
2021-08-26 07:13:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874159183335424 [0;39m <==    Updates: 0
2021-08-26 07:13:15.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874159183335424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:13:20.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874180112912384 [0;39m 生成今日电子书快照开始
2021-08-26 07:13:20.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874180112912384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:13:20.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874180112912384 [0;39m ==> Parameters: 
2021-08-26 07:13:20.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874180112912384 [0;39m <==    Updates: 0
2021-08-26 07:13:20.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874180112912384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:13:25.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874201080238080 [0;39m 生成今日电子书快照开始
2021-08-26 07:13:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874201080238080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:13:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874201080238080 [0;39m ==> Parameters: 
2021-08-26 07:13:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874201080238080 [0;39m <==    Updates: 0
2021-08-26 07:13:25.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874201080238080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:13:30.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874222072729600 [0;39m 生成今日电子书快照开始
2021-08-26 07:13:30.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874222072729600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:13:30.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874222072729600 [0;39m ==> Parameters: 
2021-08-26 07:13:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874222072729600 [0;39m <==    Updates: 0
2021-08-26 07:13:30.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874222072729600 [0;39m 生成今日电子书快照结束，耗时：7毫秒
2021-08-26 07:13:35.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85874243027472384 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:13:35.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874243027472384 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:13:35.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874243027472384 [0;39m ==> Parameters: 
2021-08-26 07:13:35.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874243027472384 [0;39m <==    Updates: 5
2021-08-26 07:13:35.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85874243027472384 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:13:35.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874243031666688 [0;39m 生成今日电子书快照开始
2021-08-26 07:13:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874243031666688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:13:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874243031666688 [0;39m ==> Parameters: 
2021-08-26 07:13:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874243031666688 [0;39m <==    Updates: 0
2021-08-26 07:13:35.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874243031666688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:13:40.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874263994798080 [0;39m 生成今日电子书快照开始
2021-08-26 07:13:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874263994798080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:13:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874263994798080 [0;39m ==> Parameters: 
2021-08-26 07:13:40.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874263994798080 [0;39m <==    Updates: 0
2021-08-26 07:13:40.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874263994798080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:13:45.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874284991483904 [0;39m 生成今日电子书快照开始
2021-08-26 07:13:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874284991483904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:13:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874284991483904 [0;39m ==> Parameters: 
2021-08-26 07:13:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874284991483904 [0;39m <==    Updates: 0
2021-08-26 07:13:45.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874284991483904 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:13:50.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874305983975424 [0;39m 生成今日电子书快照开始
2021-08-26 07:13:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874305983975424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:13:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874305983975424 [0;39m ==> Parameters: 
2021-08-26 07:13:50.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874305983975424 [0;39m <==    Updates: 0
2021-08-26 07:13:50.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874305983975424 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:13:55.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874326909358080 [0;39m 生成今日电子书快照开始
2021-08-26 07:13:55.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874326909358080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:13:55.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874326909358080 [0;39m ==> Parameters: 
2021-08-26 07:13:55.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874326909358080 [0;39m <==    Updates: 0
2021-08-26 07:13:55.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874326909358080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:14:00.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874347897655296 [0;39m 生成今日电子书快照开始
2021-08-26 07:14:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874347897655296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:14:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874347897655296 [0;39m ==> Parameters: 
2021-08-26 07:14:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874347897655296 [0;39m <==    Updates: 0
2021-08-26 07:14:00.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874347897655296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:14:05.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874368860786688 [0;39m 生成今日电子书快照开始
2021-08-26 07:14:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874368860786688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:14:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874368860786688 [0;39m ==> Parameters: 
2021-08-26 07:14:05.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874368860786688 [0;39m <==    Updates: 0
2021-08-26 07:14:05.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874368860786688 [0;39m 生成今日电子书快照结束，耗时：7毫秒
2021-08-26 07:14:05.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85874368894341120 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:14:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874368894341120 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:14:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874368894341120 [0;39m ==> Parameters: 
2021-08-26 07:14:05.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874368894341120 [0;39m <==    Updates: 5
2021-08-26 07:14:05.017 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85874368894341120 [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-08-26 07:14:10.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874389819723776 [0;39m 生成今日电子书快照开始
2021-08-26 07:14:10.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874389819723776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:14:10.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874389819723776 [0;39m ==> Parameters: 
2021-08-26 07:14:10.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874389819723776 [0;39m <==    Updates: 0
2021-08-26 07:14:10.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874389819723776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:14:15.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874410845769728 [0;39m 生成今日电子书快照开始
2021-08-26 07:14:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874410845769728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:14:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874410845769728 [0;39m ==> Parameters: 
2021-08-26 07:14:15.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874410845769728 [0;39m <==    Updates: 0
2021-08-26 07:14:15.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874410845769728 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:14:20.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874431804706816 [0;39m 生成今日电子书快照开始
2021-08-26 07:14:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874431804706816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:14:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874431804706816 [0;39m ==> Parameters: 
2021-08-26 07:14:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874431804706816 [0;39m <==    Updates: 0
2021-08-26 07:14:20.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874431804706816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:14:25.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874452746866688 [0;39m 生成今日电子书快照开始
2021-08-26 07:14:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874452746866688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:14:25.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874452746866688 [0;39m ==> Parameters: 
2021-08-26 07:14:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874452746866688 [0;39m <==    Updates: 0
2021-08-26 07:14:25.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874452746866688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:14:30.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874473739358208 [0;39m 生成今日电子书快照开始
2021-08-26 07:14:30.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874473739358208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:14:30.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874473739358208 [0;39m ==> Parameters: 
2021-08-26 07:14:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874473739358208 [0;39m <==    Updates: 0
2021-08-26 07:14:30.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874473739358208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:14:35.001 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85874494673129472 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:14:35.001 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874494673129472 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:14:35.001 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874494673129472 [0;39m ==> Parameters: 
2021-08-26 07:14:35.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874494673129472 [0;39m <==    Updates: 5
2021-08-26 07:14:35.002 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85874494673129472 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:14:35.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874494677323776 [0;39m 生成今日电子书快照开始
2021-08-26 07:14:35.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874494677323776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:14:35.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874494677323776 [0;39m ==> Parameters: 
2021-08-26 07:14:35.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874494677323776 [0;39m <==    Updates: 0
2021-08-26 07:14:35.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874494677323776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:14:40.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874515686592512 [0;39m 生成今日电子书快照开始
2021-08-26 07:14:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874515686592512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:14:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874515686592512 [0;39m ==> Parameters: 
2021-08-26 07:14:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874515686592512 [0;39m <==    Updates: 0
2021-08-26 07:14:40.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874515686592512 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:14:45.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874536628752384 [0;39m 生成今日电子书快照开始
2021-08-26 07:14:45.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874536628752384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:14:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874536628752384 [0;39m ==> Parameters: 
2021-08-26 07:14:45.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874536628752384 [0;39m <==    Updates: 0
2021-08-26 07:14:45.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874536628752384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:14:50.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874557608660992 [0;39m 生成今日电子书快照开始
2021-08-26 07:14:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874557608660992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:14:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874557608660992 [0;39m ==> Parameters: 
2021-08-26 07:14:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874557608660992 [0;39m <==    Updates: 0
2021-08-26 07:14:50.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874557608660992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:14:55.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874578592763904 [0;39m 生成今日电子书快照开始
2021-08-26 07:14:55.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874578592763904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:14:55.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874578592763904 [0;39m ==> Parameters: 
2021-08-26 07:14:55.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874578592763904 [0;39m <==    Updates: 0
2021-08-26 07:14:55.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874578592763904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:15:00.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874599564283904 [0;39m 生成今日电子书快照开始
2021-08-26 07:15:00.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874599564283904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:15:00.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874599564283904 [0;39m ==> Parameters: 
2021-08-26 07:15:00.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874599564283904 [0;39m <==    Updates: 0
2021-08-26 07:15:00.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874599564283904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:15:05.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85874620527415296 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:15:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874620527415296 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:15:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874620527415296 [0;39m ==> Parameters: 
2021-08-26 07:15:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874620527415296 [0;39m <==    Updates: 5
2021-08-26 07:15:05.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85874620527415296 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:15:05.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874620531609600 [0;39m 生成今日电子书快照开始
2021-08-26 07:15:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874620531609600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:15:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874620531609600 [0;39m ==> Parameters: 
2021-08-26 07:15:05.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874620531609600 [0;39m <==    Updates: 0
2021-08-26 07:15:05.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874620531609600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:15:10.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874641515712512 [0;39m 生成今日电子书快照开始
2021-08-26 07:15:10.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874641515712512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:15:10.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874641515712512 [0;39m ==> Parameters: 
2021-08-26 07:15:10.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874641515712512 [0;39m <==    Updates: 0
2021-08-26 07:15:10.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874641515712512 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:15:15.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874662453678080 [0;39m 生成今日电子书快照开始
2021-08-26 07:15:15.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874662453678080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:15:15.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874662453678080 [0;39m ==> Parameters: 
2021-08-26 07:15:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874662453678080 [0;39m <==    Updates: 0
2021-08-26 07:15:15.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874662453678080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:15:20.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874683479724032 [0;39m 生成今日电子书快照开始
2021-08-26 07:15:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874683479724032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:15:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874683479724032 [0;39m ==> Parameters: 
2021-08-26 07:15:20.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874683479724032 [0;39m <==    Updates: 0
2021-08-26 07:15:20.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874683479724032 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:15:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874704426078208 [0;39m 生成今日电子书快照开始
2021-08-26 07:15:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874704426078208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:15:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874704426078208 [0;39m ==> Parameters: 
2021-08-26 07:15:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874704426078208 [0;39m <==    Updates: 0
2021-08-26 07:15:25.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874704426078208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:15:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874725376626688 [0;39m 生成今日电子书快照开始
2021-08-26 07:15:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874725376626688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:15:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874725376626688 [0;39m ==> Parameters: 
2021-08-26 07:15:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874725376626688 [0;39m <==    Updates: 0
2021-08-26 07:15:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874725376626688 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:15:35.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85874746356535296 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:15:35.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874746356535296 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:15:35.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874746356535296 [0;39m ==> Parameters: 
2021-08-26 07:15:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874746356535296 [0;39m <==    Updates: 5
2021-08-26 07:15:35.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85874746356535296 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:15:35.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874746364923904 [0;39m 生成今日电子书快照开始
2021-08-26 07:15:35.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874746364923904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:15:35.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874746364923904 [0;39m ==> Parameters: 
2021-08-26 07:15:35.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874746364923904 [0;39m <==    Updates: 0
2021-08-26 07:15:35.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874746364923904 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:15:40.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874767349026816 [0;39m 生成今日电子书快照开始
2021-08-26 07:15:40.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874767349026816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:15:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874767349026816 [0;39m ==> Parameters: 
2021-08-26 07:15:40.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874767349026816 [0;39m <==    Updates: 0
2021-08-26 07:15:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874767349026816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:15:45.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874788333129728 [0;39m 生成今日电子书快照开始
2021-08-26 07:15:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874788333129728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:15:45.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874788333129728 [0;39m ==> Parameters: 
2021-08-26 07:15:45.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874788333129728 [0;39m <==    Updates: 0
2021-08-26 07:15:45.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874788333129728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:15:50.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874809292066816 [0;39m 生成今日电子书快照开始
2021-08-26 07:15:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874809292066816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:15:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874809292066816 [0;39m ==> Parameters: 
2021-08-26 07:15:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874809292066816 [0;39m <==    Updates: 0
2021-08-26 07:15:50.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874809292066816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:15:55.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874830271975424 [0;39m 生成今日电子书快照开始
2021-08-26 07:15:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874830271975424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:15:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874830271975424 [0;39m ==> Parameters: 
2021-08-26 07:15:55.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874830271975424 [0;39m <==    Updates: 0
2021-08-26 07:15:55.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874830271975424 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:16:00.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874851197358080 [0;39m 生成今日电子书快照开始
2021-08-26 07:16:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874851197358080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:16:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874851197358080 [0;39m ==> Parameters: 
2021-08-26 07:16:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874851197358080 [0;39m <==    Updates: 0
2021-08-26 07:16:00.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874851197358080 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:16:05.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85874872210821120 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:16:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874872210821120 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:16:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874872210821120 [0;39m ==> Parameters: 
2021-08-26 07:16:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874872210821120 [0;39m <==    Updates: 5
2021-08-26 07:16:05.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85874872210821120 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:16:05.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874872215015424 [0;39m 生成今日电子书快照开始
2021-08-26 07:16:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874872215015424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:16:05.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874872215015424 [0;39m ==> Parameters: 
2021-08-26 07:16:05.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874872215015424 [0;39m <==    Updates: 0
2021-08-26 07:16:05.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874872215015424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:16:10.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874893152980992 [0;39m 生成今日电子书快照开始
2021-08-26 07:16:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874893152980992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:16:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874893152980992 [0;39m ==> Parameters: 
2021-08-26 07:16:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874893152980992 [0;39m <==    Updates: 0
2021-08-26 07:16:10.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874893152980992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:16:15.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874914145472512 [0;39m 生成今日电子书快照开始
2021-08-26 07:16:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874914145472512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:16:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874914145472512 [0;39m ==> Parameters: 
2021-08-26 07:16:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874914145472512 [0;39m <==    Updates: 0
2021-08-26 07:16:15.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874914145472512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:16:20.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874935104409600 [0;39m 生成今日电子书快照开始
2021-08-26 07:16:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874935104409600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:16:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874935104409600 [0;39m ==> Parameters: 
2021-08-26 07:16:20.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874935104409600 [0;39m <==    Updates: 0
2021-08-26 07:16:20.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874935104409600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:16:25.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874956050763776 [0;39m 生成今日电子书快照开始
2021-08-26 07:16:25.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874956050763776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:16:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874956050763776 [0;39m ==> Parameters: 
2021-08-26 07:16:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874956050763776 [0;39m <==    Updates: 0
2021-08-26 07:16:25.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874956050763776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:16:30.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874977076809728 [0;39m 生成今日电子书快照开始
2021-08-26 07:16:30.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874977076809728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:16:30.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874977076809728 [0;39m ==> Parameters: 
2021-08-26 07:16:30.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874977076809728 [0;39m <==    Updates: 0
2021-08-26 07:16:30.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874977076809728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:16:35.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85874997997998080 [0;39m 生成今日电子书快照开始
2021-08-26 07:16:35.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874997997998080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:16:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874997997998080 [0;39m ==> Parameters: 
2021-08-26 07:16:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85874997997998080 [0;39m <==    Updates: 0
2021-08-26 07:16:35.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85874997997998080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:16:35.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85874998006386688 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:16:35.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874998006386688 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:16:35.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874998006386688 [0;39m ==> Parameters: 
2021-08-26 07:16:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85874998006386688 [0;39m <==    Updates: 5
2021-08-26 07:16:35.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85874998006386688 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:16:40.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875018965323776 [0;39m 生成今日电子书快照开始
2021-08-26 07:16:40.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875018965323776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:16:40.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875018965323776 [0;39m ==> Parameters: 
2021-08-26 07:16:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875018965323776 [0;39m <==    Updates: 0
2021-08-26 07:16:40.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875018965323776 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:16:45.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875039995564032 [0;39m 生成今日电子书快照开始
2021-08-26 07:16:45.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875039995564032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:16:45.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875039995564032 [0;39m ==> Parameters: 
2021-08-26 07:16:45.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875039995564032 [0;39m <==    Updates: 0
2021-08-26 07:16:45.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875039995564032 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:16:50.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875060925140992 [0;39m 生成今日电子书快照开始
2021-08-26 07:16:50.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875060925140992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:16:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875060925140992 [0;39m ==> Parameters: 
2021-08-26 07:16:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875060925140992 [0;39m <==    Updates: 0
2021-08-26 07:16:50.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875060925140992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:16:55.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875081930215424 [0;39m 生成今日电子书快照开始
2021-08-26 07:16:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875081930215424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:16:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875081930215424 [0;39m ==> Parameters: 
2021-08-26 07:16:55.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875081930215424 [0;39m <==    Updates: 0
2021-08-26 07:16:55.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875081930215424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:17:00.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875102880763904 [0;39m 生成今日电子书快照开始
2021-08-26 07:17:00.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875102880763904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:17:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875102880763904 [0;39m ==> Parameters: 
2021-08-26 07:17:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875102880763904 [0;39m <==    Updates: 0
2021-08-26 07:17:00.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875102880763904 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:17:05.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85875123839700992 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:17:05.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875123839700992 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:17:05.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875123839700992 [0;39m ==> Parameters: 
2021-08-26 07:17:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875123839700992 [0;39m <==    Updates: 5
2021-08-26 07:17:05.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85875123839700992 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:17:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875123843895296 [0;39m 生成今日电子书快照开始
2021-08-26 07:17:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875123843895296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:17:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875123843895296 [0;39m ==> Parameters: 
2021-08-26 07:17:05.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875123843895296 [0;39m <==    Updates: 0
2021-08-26 07:17:05.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875123843895296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:17:10.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875144807026688 [0;39m 生成今日电子书快照开始
2021-08-26 07:17:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875144807026688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:17:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875144807026688 [0;39m ==> Parameters: 
2021-08-26 07:17:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875144807026688 [0;39m <==    Updates: 0
2021-08-26 07:17:10.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875144807026688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:17:15.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875165786935296 [0;39m 生成今日电子书快照开始
2021-08-26 07:17:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875165786935296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:17:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875165786935296 [0;39m ==> Parameters: 
2021-08-26 07:17:15.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875165786935296 [0;39m <==    Updates: 0
2021-08-26 07:17:15.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875165786935296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:17:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875186787815424 [0;39m 生成今日电子书快照开始
2021-08-26 07:17:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875186787815424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:17:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875186787815424 [0;39m ==> Parameters: 
2021-08-26 07:17:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875186787815424 [0;39m <==    Updates: 0
2021-08-26 07:17:20.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875186787815424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:17:25.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875207759335424 [0;39m 生成今日电子书快照开始
2021-08-26 07:17:25.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875207759335424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:17:25.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875207759335424 [0;39m ==> Parameters: 
2021-08-26 07:17:25.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875207759335424 [0;39m <==    Updates: 0
2021-08-26 07:17:25.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875207759335424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:17:30.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875228701495296 [0;39m 生成今日电子书快照开始
2021-08-26 07:17:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875228701495296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:17:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875228701495296 [0;39m ==> Parameters: 
2021-08-26 07:17:30.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875228701495296 [0;39m <==    Updates: 0
2021-08-26 07:17:30.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875228701495296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:17:35.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875249668820992 [0;39m 生成今日电子书快照开始
2021-08-26 07:17:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875249668820992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:17:35.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875249668820992 [0;39m ==> Parameters: 
2021-08-26 07:17:35.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875249668820992 [0;39m <==    Updates: 0
2021-08-26 07:17:35.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875249668820992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:17:35.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85875249677209600 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:17:35.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875249677209600 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:17:35.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875249677209600 [0;39m ==> Parameters: 
2021-08-26 07:17:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875249677209600 [0;39m <==    Updates: 5
2021-08-26 07:17:35.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85875249677209600 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:17:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875270673895424 [0;39m 生成今日电子书快照开始
2021-08-26 07:17:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875270673895424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:17:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875270673895424 [0;39m ==> Parameters: 
2021-08-26 07:17:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875270673895424 [0;39m <==    Updates: 0
2021-08-26 07:17:40.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875270673895424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:17:45.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875291649609728 [0;39m 生成今日电子书快照开始
2021-08-26 07:17:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875291649609728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:17:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875291649609728 [0;39m ==> Parameters: 
2021-08-26 07:17:45.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875291649609728 [0;39m <==    Updates: 0
2021-08-26 07:17:45.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875291649609728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:17:50.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875312570798080 [0;39m 生成今日电子书快照开始
2021-08-26 07:17:50.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875312570798080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:17:50.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875312570798080 [0;39m ==> Parameters: 
2021-08-26 07:17:50.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875312570798080 [0;39m <==    Updates: 0
2021-08-26 07:17:50.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875312570798080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:17:55.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875333588455424 [0;39m 生成今日电子书快照开始
2021-08-26 07:17:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875333588455424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:17:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875333588455424 [0;39m ==> Parameters: 
2021-08-26 07:17:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875333588455424 [0;39m <==    Updates: 0
2021-08-26 07:17:55.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875333588455424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:18:00.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875354534809600 [0;39m 生成今日电子书快照开始
2021-08-26 07:18:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875354534809600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:18:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875354534809600 [0;39m ==> Parameters: 
2021-08-26 07:18:00.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875354534809600 [0;39m <==    Updates: 0
2021-08-26 07:18:00.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875354534809600 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:18:05.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85875375489552384 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:18:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875375489552384 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:18:05.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875375489552384 [0;39m ==> Parameters: 
2021-08-26 07:18:05.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875375489552384 [0;39m <==    Updates: 5
2021-08-26 07:18:05.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85875375489552384 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:18:05.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875375493746688 [0;39m 生成今日电子书快照开始
2021-08-26 07:18:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875375493746688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:18:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875375493746688 [0;39m ==> Parameters: 
2021-08-26 07:18:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875375493746688 [0;39m <==    Updates: 0
2021-08-26 07:18:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875375493746688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:18:10.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875396477849600 [0;39m 生成今日电子书快照开始
2021-08-26 07:18:10.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875396477849600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:18:10.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875396477849600 [0;39m ==> Parameters: 
2021-08-26 07:18:10.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875396477849600 [0;39m <==    Updates: 0
2021-08-26 07:18:10.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875396477849600 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:18:15.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875417420009472 [0;39m 生成今日电子书快照开始
2021-08-26 07:18:15.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875417420009472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:18:15.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875417420009472 [0;39m ==> Parameters: 
2021-08-26 07:18:15.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875417420009472 [0;39m <==    Updates: 0
2021-08-26 07:18:15.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875417420009472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:18:20.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875438416695296 [0;39m 生成今日电子书快照开始
2021-08-26 07:18:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875438416695296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:18:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875438416695296 [0;39m ==> Parameters: 
2021-08-26 07:18:20.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875438416695296 [0;39m <==    Updates: 0
2021-08-26 07:18:20.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875438416695296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:18:25.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875459425964032 [0;39m 生成今日电子书快照开始
2021-08-26 07:18:25.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875459425964032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:18:25.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875459425964032 [0;39m ==> Parameters: 
2021-08-26 07:18:25.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875459425964032 [0;39m <==    Updates: 0
2021-08-26 07:18:25.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875459425964032 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:18:30.000 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875480330375168 [0;39m 生成今日电子书快照开始
2021-08-26 07:18:30.000 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875480330375168 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:18:30.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875480330375168 [0;39m ==> Parameters: 
2021-08-26 07:18:30.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875480330375168 [0;39m <==    Updates: 0
2021-08-26 07:18:30.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875480330375168 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:18:35.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85875501343838208 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:18:35.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875501343838208 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:18:35.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875501343838208 [0;39m ==> Parameters: 
2021-08-26 07:18:35.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875501343838208 [0;39m <==    Updates: 5
2021-08-26 07:18:35.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85875501343838208 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:18:35.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875501352226816 [0;39m 生成今日电子书快照开始
2021-08-26 07:18:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875501352226816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:18:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875501352226816 [0;39m ==> Parameters: 
2021-08-26 07:18:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875501352226816 [0;39m <==    Updates: 0
2021-08-26 07:18:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875501352226816 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:18:40.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875522290192384 [0;39m 生成今日电子书快照开始
2021-08-26 07:18:40.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875522290192384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:18:40.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875522290192384 [0;39m ==> Parameters: 
2021-08-26 07:18:40.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875522290192384 [0;39m <==    Updates: 0
2021-08-26 07:18:40.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875522290192384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:18:45.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875543282683904 [0;39m 生成今日电子书快照开始
2021-08-26 07:18:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875543282683904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:18:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875543282683904 [0;39m ==> Parameters: 
2021-08-26 07:18:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875543282683904 [0;39m <==    Updates: 0
2021-08-26 07:18:45.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875543282683904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:18:50.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875564270981120 [0;39m 生成今日电子书快照开始
2021-08-26 07:18:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875564270981120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:18:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875564270981120 [0;39m ==> Parameters: 
2021-08-26 07:18:50.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875564270981120 [0;39m <==    Updates: 0
2021-08-26 07:18:50.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875564270981120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:18:55.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875585238306816 [0;39m 生成今日电子书快照开始
2021-08-26 07:18:55.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875585238306816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:18:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875585238306816 [0;39m ==> Parameters: 
2021-08-26 07:18:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875585238306816 [0;39m <==    Updates: 0
2021-08-26 07:18:55.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875585238306816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:19:00.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875606193049600 [0;39m 生成今日电子书快照开始
2021-08-26 07:19:00.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875606193049600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:19:00.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875606193049600 [0;39m ==> Parameters: 
2021-08-26 07:19:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875606193049600 [0;39m <==    Updates: 0
2021-08-26 07:19:00.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875606193049600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:19:05.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85875627151986688 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:19:05.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875627151986688 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:19:05.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875627151986688 [0;39m ==> Parameters: 
2021-08-26 07:19:05.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875627151986688 [0;39m <==    Updates: 5
2021-08-26 07:19:05.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85875627151986688 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:19:05.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875627156180992 [0;39m 生成今日电子书快照开始
2021-08-26 07:19:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875627156180992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:19:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875627156180992 [0;39m ==> Parameters: 
2021-08-26 07:19:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875627156180992 [0;39m <==    Updates: 0
2021-08-26 07:19:05.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875627156180992 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:19:10.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875648157061120 [0;39m 生成今日电子书快照开始
2021-08-26 07:19:10.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875648157061120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:19:10.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875648157061120 [0;39m ==> Parameters: 
2021-08-26 07:19:10.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875648157061120 [0;39m <==    Updates: 0
2021-08-26 07:19:10.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875648157061120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:19:15.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875669128581120 [0;39m 生成今日电子书快照开始
2021-08-26 07:19:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875669128581120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:19:15.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875669128581120 [0;39m ==> Parameters: 
2021-08-26 07:19:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875669128581120 [0;39m <==    Updates: 0
2021-08-26 07:19:15.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875669128581120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:19:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875690104295424 [0;39m 生成今日电子书快照开始
2021-08-26 07:19:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875690104295424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:19:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875690104295424 [0;39m ==> Parameters: 
2021-08-26 07:19:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875690104295424 [0;39m <==    Updates: 0
2021-08-26 07:19:20.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875690104295424 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:19:25.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875711050649600 [0;39m 生成今日电子书快照开始
2021-08-26 07:19:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875711050649600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:19:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875711050649600 [0;39m ==> Parameters: 
2021-08-26 07:19:25.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875711050649600 [0;39m <==    Updates: 0
2021-08-26 07:19:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875711050649600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:19:30.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875731997003776 [0;39m 生成今日电子书快照开始
2021-08-26 07:19:30.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875731997003776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:19:30.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875731997003776 [0;39m ==> Parameters: 
2021-08-26 07:19:30.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875731997003776 [0;39m <==    Updates: 0
2021-08-26 07:19:30.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875731997003776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:19:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875753014661120 [0;39m 生成今日电子书快照开始
2021-08-26 07:19:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875753014661120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:19:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875753014661120 [0;39m ==> Parameters: 
2021-08-26 07:19:35.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875753014661120 [0;39m <==    Updates: 0
2021-08-26 07:19:35.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875753014661120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:19:35.016 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85875753027244032 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:19:35.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875753027244032 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:19:35.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875753027244032 [0;39m ==> Parameters: 
2021-08-26 07:19:35.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875753027244032 [0;39m <==    Updates: 5
2021-08-26 07:19:35.017 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85875753027244032 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:19:40.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875773977792512 [0;39m 生成今日电子书快照开始
2021-08-26 07:19:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875773977792512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:19:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875773977792512 [0;39m ==> Parameters: 
2021-08-26 07:19:40.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875773977792512 [0;39m <==    Updates: 0
2021-08-26 07:19:40.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875773977792512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:19:45.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875794957701120 [0;39m 生成今日电子书快照开始
2021-08-26 07:19:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875794957701120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:19:45.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875794957701120 [0;39m ==> Parameters: 
2021-08-26 07:19:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875794957701120 [0;39m <==    Updates: 0
2021-08-26 07:19:45.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875794957701120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:19:50.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875815878889472 [0;39m 生成今日电子书快照开始
2021-08-26 07:19:50.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875815878889472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:19:50.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875815878889472 [0;39m ==> Parameters: 
2021-08-26 07:19:50.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875815878889472 [0;39m <==    Updates: 0
2021-08-26 07:19:50.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875815878889472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:19:55.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875836871380992 [0;39m 生成今日电子书快照开始
2021-08-26 07:19:55.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875836871380992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:19:55.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875836871380992 [0;39m ==> Parameters: 
2021-08-26 07:19:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875836871380992 [0;39m <==    Updates: 0
2021-08-26 07:19:55.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875836871380992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:20:00.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875857826123776 [0;39m 生成今日电子书快照开始
2021-08-26 07:20:00.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875857826123776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:20:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875857826123776 [0;39m ==> Parameters: 
2021-08-26 07:20:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875857826123776 [0;39m <==    Updates: 0
2021-08-26 07:20:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875857826123776 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:20:05.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875878806032384 [0;39m 生成今日电子书快照开始
2021-08-26 07:20:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875878806032384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:20:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875878806032384 [0;39m ==> Parameters: 
2021-08-26 07:20:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875878806032384 [0;39m <==    Updates: 0
2021-08-26 07:20:05.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875878806032384 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:20:05.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85875878814420992 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:20:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875878814420992 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:20:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875878814420992 [0;39m ==> Parameters: 
2021-08-26 07:20:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85875878814420992 [0;39m <==    Updates: 5
2021-08-26 07:20:05.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85875878814420992 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:20:10.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875899823689728 [0;39m 生成今日电子书快照开始
2021-08-26 07:20:10.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875899823689728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:20:10.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875899823689728 [0;39m ==> Parameters: 
2021-08-26 07:20:10.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875899823689728 [0;39m <==    Updates: 0
2021-08-26 07:20:10.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875899823689728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:20:15.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875920774238208 [0;39m 生成今日电子书快照开始
2021-08-26 07:20:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875920774238208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:20:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875920774238208 [0;39m ==> Parameters: 
2021-08-26 07:20:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875920774238208 [0;39m <==    Updates: 0
2021-08-26 07:20:15.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875920774238208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:20:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875941762535424 [0;39m 生成今日电子书快照开始
2021-08-26 07:20:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875941762535424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:20:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875941762535424 [0;39m ==> Parameters: 
2021-08-26 07:20:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875941762535424 [0;39m <==    Updates: 0
2021-08-26 07:20:20.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875941762535424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:20:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875962717278208 [0;39m 生成今日电子书快照开始
2021-08-26 07:20:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875962717278208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:20:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875962717278208 [0;39m ==> Parameters: 
2021-08-26 07:20:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875962717278208 [0;39m <==    Updates: 0
2021-08-26 07:20:25.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875962717278208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:20:30.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85875983692992512 [0;39m 生成今日电子书快照开始
2021-08-26 07:20:30.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875983692992512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:20:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875983692992512 [0;39m ==> Parameters: 
2021-08-26 07:20:30.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85875983692992512 [0;39m <==    Updates: 0
2021-08-26 07:20:30.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85875983692992512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:20:35.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876004664512512 [0;39m 生成今日电子书快照开始
2021-08-26 07:20:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876004664512512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:20:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876004664512512 [0;39m ==> Parameters: 
2021-08-26 07:20:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876004664512512 [0;39m <==    Updates: 0
2021-08-26 07:20:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876004664512512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:20:35.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85876004672901120 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:20:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876004672901120 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:20:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876004672901120 [0;39m ==> Parameters: 
2021-08-26 07:20:35.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876004672901120 [0;39m <==    Updates: 5
2021-08-26 07:20:35.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85876004672901120 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:20:40.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876025640226816 [0;39m 生成今日电子书快照开始
2021-08-26 07:20:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876025640226816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:20:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876025640226816 [0;39m ==> Parameters: 
2021-08-26 07:20:40.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876025640226816 [0;39m <==    Updates: 0
2021-08-26 07:20:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876025640226816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:20:45.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876046573998080 [0;39m 生成今日电子书快照开始
2021-08-26 07:20:45.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876046573998080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:20:45.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876046573998080 [0;39m ==> Parameters: 
2021-08-26 07:20:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876046573998080 [0;39m <==    Updates: 0
2021-08-26 07:20:45.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876046573998080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:20:50.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876067537129472 [0;39m 生成今日电子书快照开始
2021-08-26 07:20:50.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876067537129472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:20:50.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876067537129472 [0;39m ==> Parameters: 
2021-08-26 07:20:50.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876067537129472 [0;39m <==    Updates: 0
2021-08-26 07:20:50.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876067537129472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:20:55.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876088538009600 [0;39m 生成今日电子书快照开始
2021-08-26 07:20:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876088538009600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:20:55.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876088538009600 [0;39m ==> Parameters: 
2021-08-26 07:20:55.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876088538009600 [0;39m <==    Updates: 0
2021-08-26 07:20:55.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876088538009600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:21:00.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876109522112512 [0;39m 生成今日电子书快照开始
2021-08-26 07:21:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876109522112512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:21:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876109522112512 [0;39m ==> Parameters: 
2021-08-26 07:21:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876109522112512 [0;39m <==    Updates: 0
2021-08-26 07:21:00.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876109522112512 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:21:05.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85876130497826816 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:21:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876130497826816 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:21:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876130497826816 [0;39m ==> Parameters: 
2021-08-26 07:21:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876130497826816 [0;39m <==    Updates: 5
2021-08-26 07:21:05.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85876130497826816 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:21:05.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876130506215424 [0;39m 生成今日电子书快照开始
2021-08-26 07:21:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876130506215424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:21:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876130506215424 [0;39m ==> Parameters: 
2021-08-26 07:21:05.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876130506215424 [0;39m <==    Updates: 0
2021-08-26 07:21:05.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876130506215424 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:21:10.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876151444180992 [0;39m 生成今日电子书快照开始
2021-08-26 07:21:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876151444180992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:21:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876151444180992 [0;39m ==> Parameters: 
2021-08-26 07:21:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876151444180992 [0;39m <==    Updates: 0
2021-08-26 07:21:10.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876151444180992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:21:15.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876172453449728 [0;39m 生成今日电子书快照开始
2021-08-26 07:21:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876172453449728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:21:15.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876172453449728 [0;39m ==> Parameters: 
2021-08-26 07:21:15.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876172453449728 [0;39m <==    Updates: 0
2021-08-26 07:21:15.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876172453449728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:21:20.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876193416581120 [0;39m 生成今日电子书快照开始
2021-08-26 07:21:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876193416581120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:21:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876193416581120 [0;39m ==> Parameters: 
2021-08-26 07:21:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876193416581120 [0;39m <==    Updates: 0
2021-08-26 07:21:20.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876193416581120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:21:25.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876214341963776 [0;39m 生成今日电子书快照开始
2021-08-26 07:21:25.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876214341963776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:21:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876214341963776 [0;39m ==> Parameters: 
2021-08-26 07:21:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876214341963776 [0;39m <==    Updates: 0
2021-08-26 07:21:25.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876214341963776 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:21:30.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876235347038208 [0;39m 生成今日电子书快照开始
2021-08-26 07:21:30.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876235347038208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:21:30.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876235347038208 [0;39m ==> Parameters: 
2021-08-26 07:21:30.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876235347038208 [0;39m <==    Updates: 0
2021-08-26 07:21:30.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876235347038208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:21:35.002 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85876256285003776 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:21:35.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876256285003776 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:21:35.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876256285003776 [0;39m ==> Parameters: 
2021-08-26 07:21:35.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876256285003776 [0;39m <==    Updates: 5
2021-08-26 07:21:35.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85876256285003776 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:21:35.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876256293392384 [0;39m 生成今日电子书快照开始
2021-08-26 07:21:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876256293392384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:21:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876256293392384 [0;39m ==> Parameters: 
2021-08-26 07:21:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876256293392384 [0;39m <==    Updates: 0
2021-08-26 07:21:35.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876256293392384 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:21:40.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876277294272512 [0;39m 生成今日电子书快照开始
2021-08-26 07:21:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876277294272512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:21:40.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876277294272512 [0;39m ==> Parameters: 
2021-08-26 07:21:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876277294272512 [0;39m <==    Updates: 0
2021-08-26 07:21:40.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876277294272512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:21:45.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876298240626688 [0;39m 生成今日电子书快照开始
2021-08-26 07:21:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876298240626688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:21:45.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876298240626688 [0;39m ==> Parameters: 
2021-08-26 07:21:45.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876298240626688 [0;39m <==    Updates: 0
2021-08-26 07:21:45.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876298240626688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:21:50.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876319228923904 [0;39m 生成今日电子书快照开始
2021-08-26 07:21:50.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876319228923904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:21:50.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876319228923904 [0;39m ==> Parameters: 
2021-08-26 07:21:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876319228923904 [0;39m <==    Updates: 0
2021-08-26 07:21:50.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876319228923904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:21:55.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876340187860992 [0;39m 生成今日电子书快照开始
2021-08-26 07:21:55.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876340187860992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:21:55.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876340187860992 [0;39m ==> Parameters: 
2021-08-26 07:21:55.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876340187860992 [0;39m <==    Updates: 0
2021-08-26 07:21:55.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876340187860992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:22:00.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876361159380992 [0;39m 生成今日电子书快照开始
2021-08-26 07:22:00.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876361159380992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:22:00.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876361159380992 [0;39m ==> Parameters: 
2021-08-26 07:22:00.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876361159380992 [0;39m <==    Updates: 0
2021-08-26 07:22:00.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876361159380992 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:22:05.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876382160261120 [0;39m 生成今日电子书快照开始
2021-08-26 07:22:05.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876382160261120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:22:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876382160261120 [0;39m ==> Parameters: 
2021-08-26 07:22:05.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876382160261120 [0;39m <==    Updates: 0
2021-08-26 07:22:05.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876382160261120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:22:05.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85876382168649728 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:22:05.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876382168649728 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:22:05.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876382168649728 [0;39m ==> Parameters: 
2021-08-26 07:22:05.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876382168649728 [0;39m <==    Updates: 5
2021-08-26 07:22:05.016 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85876382168649728 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:22:10.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876403102420992 [0;39m 生成今日电子书快照开始
2021-08-26 07:22:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876403102420992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:22:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876403102420992 [0;39m ==> Parameters: 
2021-08-26 07:22:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876403102420992 [0;39m <==    Updates: 0
2021-08-26 07:22:10.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876403102420992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:22:15.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876424073940992 [0;39m 生成今日电子书快照开始
2021-08-26 07:22:15.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876424073940992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:22:15.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876424073940992 [0;39m ==> Parameters: 
2021-08-26 07:22:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876424073940992 [0;39m <==    Updates: 0
2021-08-26 07:22:15.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876424073940992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:22:20.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876445024489472 [0;39m 生成今日电子书快照开始
2021-08-26 07:22:20.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876445024489472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:22:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876445024489472 [0;39m ==> Parameters: 
2021-08-26 07:22:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876445024489472 [0;39m <==    Updates: 0
2021-08-26 07:22:20.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876445024489472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:22:25.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876466046341120 [0;39m 生成今日电子书快照开始
2021-08-26 07:22:25.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876466046341120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:22:25.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876466046341120 [0;39m ==> Parameters: 
2021-08-26 07:22:25.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876466046341120 [0;39m <==    Updates: 0
2021-08-26 07:22:25.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876466046341120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:22:30.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876486967529472 [0;39m 生成今日电子书快照开始
2021-08-26 07:22:30.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876486967529472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:22:30.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876486967529472 [0;39m ==> Parameters: 
2021-08-26 07:22:30.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876486967529472 [0;39m <==    Updates: 0
2021-08-26 07:22:30.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876486967529472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:22:35.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85876507980992512 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:22:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876507980992512 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:22:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876507980992512 [0;39m ==> Parameters: 
2021-08-26 07:22:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876507980992512 [0;39m <==    Updates: 5
2021-08-26 07:22:35.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85876507980992512 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:22:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876507989381120 [0;39m 生成今日电子书快照开始
2021-08-26 07:22:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876507989381120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:22:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876507989381120 [0;39m ==> Parameters: 
2021-08-26 07:22:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876507989381120 [0;39m <==    Updates: 0
2021-08-26 07:22:35.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876507989381120 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:22:40.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876528914763776 [0;39m 生成今日电子书快照开始
2021-08-26 07:22:40.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876528914763776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:22:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876528914763776 [0;39m ==> Parameters: 
2021-08-26 07:22:40.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876528914763776 [0;39m <==    Updates: 0
2021-08-26 07:22:40.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876528914763776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:22:45.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876549898866688 [0;39m 生成今日电子书快照开始
2021-08-26 07:22:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876549898866688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:22:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876549898866688 [0;39m ==> Parameters: 
2021-08-26 07:22:45.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876549898866688 [0;39m <==    Updates: 0
2021-08-26 07:22:45.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876549898866688 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:22:50.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876570903941120 [0;39m 生成今日电子书快照开始
2021-08-26 07:22:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876570903941120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:22:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876570903941120 [0;39m ==> Parameters: 
2021-08-26 07:22:50.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876570903941120 [0;39m <==    Updates: 0
2021-08-26 07:22:50.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876570903941120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:22:55.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876591888044032 [0;39m 生成今日电子书快照开始
2021-08-26 07:22:55.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876591888044032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:22:55.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876591888044032 [0;39m ==> Parameters: 
2021-08-26 07:22:55.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876591888044032 [0;39m <==    Updates: 0
2021-08-26 07:22:55.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876591888044032 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:23:00.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876612800843776 [0;39m 生成今日电子书快照开始
2021-08-26 07:23:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876612800843776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:23:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876612800843776 [0;39m ==> Parameters: 
2021-08-26 07:23:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876612800843776 [0;39m <==    Updates: 0
2021-08-26 07:23:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876612800843776 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:23:05.000 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85876633763975168 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:23:05.000 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876633763975168 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:23:05.001 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876633763975168 [0;39m ==> Parameters: 
2021-08-26 07:23:05.001 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876633763975168 [0;39m <==    Updates: 5
2021-08-26 07:23:05.002 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85876633763975168 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:23:05.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876633772363776 [0;39m 生成今日电子书快照开始
2021-08-26 07:23:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876633772363776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:23:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876633772363776 [0;39m ==> Parameters: 
2021-08-26 07:23:05.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876633772363776 [0;39m <==    Updates: 0
2021-08-26 07:23:05.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876633772363776 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:23:10.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876654739689472 [0;39m 生成今日电子书快照开始
2021-08-26 07:23:10.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876654739689472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:23:10.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876654739689472 [0;39m ==> Parameters: 
2021-08-26 07:23:10.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876654739689472 [0;39m <==    Updates: 0
2021-08-26 07:23:10.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876654739689472 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:23:15.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876675723792384 [0;39m 生成今日电子书快照开始
2021-08-26 07:23:15.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876675723792384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:23:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876675723792384 [0;39m ==> Parameters: 
2021-08-26 07:23:15.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876675723792384 [0;39m <==    Updates: 0
2021-08-26 07:23:15.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876675723792384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:23:20.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876696707895296 [0;39m 生成今日电子书快照开始
2021-08-26 07:23:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876696707895296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:23:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876696707895296 [0;39m ==> Parameters: 
2021-08-26 07:23:20.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876696707895296 [0;39m <==    Updates: 0
2021-08-26 07:23:20.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876696707895296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:23:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876717691998208 [0;39m 生成今日电子书快照开始
2021-08-26 07:23:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876717691998208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:23:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876717691998208 [0;39m ==> Parameters: 
2021-08-26 07:23:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876717691998208 [0;39m <==    Updates: 0
2021-08-26 07:23:25.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876717691998208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:23:30.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876738634158080 [0;39m 生成今日电子书快照开始
2021-08-26 07:23:30.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876738634158080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:23:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876738634158080 [0;39m ==> Parameters: 
2021-08-26 07:23:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876738634158080 [0;39m <==    Updates: 0
2021-08-26 07:23:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876738634158080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:23:35.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85876759635038208 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:23:35.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876759635038208 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:23:35.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876759635038208 [0;39m ==> Parameters: 
2021-08-26 07:23:35.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876759635038208 [0;39m <==    Updates: 5
2021-08-26 07:23:35.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85876759635038208 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:23:35.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876759639232512 [0;39m 生成今日电子书快照开始
2021-08-26 07:23:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876759639232512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:23:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876759639232512 [0;39m ==> Parameters: 
2021-08-26 07:23:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876759639232512 [0;39m <==    Updates: 0
2021-08-26 07:23:35.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876759639232512 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:23:40.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876780585586688 [0;39m 生成今日电子书快照开始
2021-08-26 07:23:40.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876780585586688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:23:40.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876780585586688 [0;39m ==> Parameters: 
2021-08-26 07:23:40.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876780585586688 [0;39m <==    Updates: 0
2021-08-26 07:23:40.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876780585586688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:23:45.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876801557106688 [0;39m 生成今日电子书快照开始
2021-08-26 07:23:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876801557106688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:23:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876801557106688 [0;39m ==> Parameters: 
2021-08-26 07:23:45.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876801557106688 [0;39m <==    Updates: 0
2021-08-26 07:23:45.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876801557106688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:23:50.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876822537015296 [0;39m 生成今日电子书快照开始
2021-08-26 07:23:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876822537015296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:23:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876822537015296 [0;39m ==> Parameters: 
2021-08-26 07:23:50.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876822537015296 [0;39m <==    Updates: 0
2021-08-26 07:23:50.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876822537015296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:23:55.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876843533701120 [0;39m 生成今日电子书快照开始
2021-08-26 07:23:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876843533701120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:23:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876843533701120 [0;39m ==> Parameters: 
2021-08-26 07:23:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876843533701120 [0;39m <==    Updates: 0
2021-08-26 07:23:55.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876843533701120 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:24:00.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876864496832512 [0;39m 生成今日电子书快照开始
2021-08-26 07:24:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876864496832512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:24:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876864496832512 [0;39m ==> Parameters: 
2021-08-26 07:24:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876864496832512 [0;39m <==    Updates: 0
2021-08-26 07:24:00.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876864496832512 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:24:05.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876885438992384 [0;39m 生成今日电子书快照开始
2021-08-26 07:24:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876885438992384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:24:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876885438992384 [0;39m ==> Parameters: 
2021-08-26 07:24:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876885438992384 [0;39m <==    Updates: 0
2021-08-26 07:24:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876885438992384 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:24:05.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85876885451575296 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:24:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876885451575296 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:24:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876885451575296 [0;39m ==> Parameters: 
2021-08-26 07:24:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85876885451575296 [0;39m <==    Updates: 5
2021-08-26 07:24:05.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85876885451575296 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:24:10.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876906410512384 [0;39m 生成今日电子书快照开始
2021-08-26 07:24:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876906410512384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:24:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876906410512384 [0;39m ==> Parameters: 
2021-08-26 07:24:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876906410512384 [0;39m <==    Updates: 0
2021-08-26 07:24:10.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876906410512384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:24:15.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876927428169728 [0;39m 生成今日电子书快照开始
2021-08-26 07:24:15.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876927428169728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:24:15.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876927428169728 [0;39m ==> Parameters: 
2021-08-26 07:24:15.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876927428169728 [0;39m <==    Updates: 0
2021-08-26 07:24:15.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876927428169728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:24:20.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876948366135296 [0;39m 生成今日电子书快照开始
2021-08-26 07:24:20.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876948366135296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:24:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876948366135296 [0;39m ==> Parameters: 
2021-08-26 07:24:20.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876948366135296 [0;39m <==    Updates: 0
2021-08-26 07:24:20.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876948366135296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:24:25.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876969341849600 [0;39m 生成今日电子书快照开始
2021-08-26 07:24:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876969341849600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:24:25.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876969341849600 [0;39m ==> Parameters: 
2021-08-26 07:24:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876969341849600 [0;39m <==    Updates: 0
2021-08-26 07:24:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876969341849600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:24:30.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85876990284009472 [0;39m 生成今日电子书快照开始
2021-08-26 07:24:30.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876990284009472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:24:30.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876990284009472 [0;39m ==> Parameters: 
2021-08-26 07:24:30.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85876990284009472 [0;39m <==    Updates: 0
2021-08-26 07:24:30.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85876990284009472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:24:35.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877011263918080 [0;39m 生成今日电子书快照开始
2021-08-26 07:24:35.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877011263918080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:24:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877011263918080 [0;39m ==> Parameters: 
2021-08-26 07:24:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877011263918080 [0;39m <==    Updates: 0
2021-08-26 07:24:35.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877011263918080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:24:35.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85877011272306688 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:24:35.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877011272306688 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:24:35.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877011272306688 [0;39m ==> Parameters: 
2021-08-26 07:24:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877011272306688 [0;39m <==    Updates: 5
2021-08-26 07:24:35.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85877011272306688 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:24:40.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877032285769728 [0;39m 生成今日电子书快照开始
2021-08-26 07:24:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877032285769728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:24:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877032285769728 [0;39m ==> Parameters: 
2021-08-26 07:24:40.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877032285769728 [0;39m <==    Updates: 0
2021-08-26 07:24:40.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877032285769728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:24:45.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877053236318208 [0;39m 生成今日电子书快照开始
2021-08-26 07:24:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877053236318208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:24:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877053236318208 [0;39m ==> Parameters: 
2021-08-26 07:24:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877053236318208 [0;39m <==    Updates: 0
2021-08-26 07:24:45.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877053236318208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:24:50.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877074170089472 [0;39m 生成今日电子书快照开始
2021-08-26 07:24:50.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877074170089472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:24:50.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877074170089472 [0;39m ==> Parameters: 
2021-08-26 07:24:50.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877074170089472 [0;39m <==    Updates: 0
2021-08-26 07:24:50.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877074170089472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:24:55.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877095154192384 [0;39m 生成今日电子书快照开始
2021-08-26 07:24:55.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877095154192384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:24:55.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877095154192384 [0;39m ==> Parameters: 
2021-08-26 07:24:55.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877095154192384 [0;39m <==    Updates: 0
2021-08-26 07:24:55.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877095154192384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:25:00.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877116146683904 [0;39m 生成今日电子书快照开始
2021-08-26 07:25:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877116146683904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:25:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877116146683904 [0;39m ==> Parameters: 
2021-08-26 07:25:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877116146683904 [0;39m <==    Updates: 0
2021-08-26 07:25:00.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877116146683904 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:25:05.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877137130786816 [0;39m 生成今日电子书快照开始
2021-08-26 07:25:05.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877137130786816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:25:05.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877137130786816 [0;39m ==> Parameters: 
2021-08-26 07:25:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877137130786816 [0;39m <==    Updates: 0
2021-08-26 07:25:05.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877137130786816 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:25:05.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85877137143369728 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:25:05.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877137143369728 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:25:05.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877137143369728 [0;39m ==> Parameters: 
2021-08-26 07:25:05.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877137143369728 [0;39m <==    Updates: 5
2021-08-26 07:25:05.016 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85877137143369728 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:25:10.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877158056169472 [0;39m 生成今日电子书快照开始
2021-08-26 07:25:10.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877158056169472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:25:10.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877158056169472 [0;39m ==> Parameters: 
2021-08-26 07:25:10.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877158056169472 [0;39m <==    Updates: 0
2021-08-26 07:25:10.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877158056169472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:25:15.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877179065438208 [0;39m 生成今日电子书快照开始
2021-08-26 07:25:15.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877179065438208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:25:15.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877179065438208 [0;39m ==> Parameters: 
2021-08-26 07:25:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877179065438208 [0;39m <==    Updates: 0
2021-08-26 07:25:15.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877179065438208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:25:20.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877200003403776 [0;39m 生成今日电子书快照开始
2021-08-26 07:25:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877200003403776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:25:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877200003403776 [0;39m ==> Parameters: 
2021-08-26 07:25:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877200003403776 [0;39m <==    Updates: 0
2021-08-26 07:25:20.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877200003403776 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:25:25.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877220979118080 [0;39m 生成今日电子书快照开始
2021-08-26 07:25:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877220979118080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:25:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877220979118080 [0;39m ==> Parameters: 
2021-08-26 07:25:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877220979118080 [0;39m <==    Updates: 0
2021-08-26 07:25:25.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877220979118080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:25:30.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877241946443776 [0;39m 生成今日电子书快照开始
2021-08-26 07:25:30.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877241946443776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:25:30.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877241946443776 [0;39m ==> Parameters: 
2021-08-26 07:25:30.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877241946443776 [0;39m <==    Updates: 0
2021-08-26 07:25:30.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877241946443776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:25:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877262964101120 [0;39m 生成今日电子书快照开始
2021-08-26 07:25:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877262964101120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:25:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877262964101120 [0;39m ==> Parameters: 
2021-08-26 07:25:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877262964101120 [0;39m <==    Updates: 0
2021-08-26 07:25:35.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877262964101120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:25:35.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85877262972489728 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:25:35.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877262972489728 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:25:35.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877262972489728 [0;39m ==> Parameters: 
2021-08-26 07:25:35.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877262972489728 [0;39m <==    Updates: 5
2021-08-26 07:25:35.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85877262972489728 [0;39m 更新电子书下的文档数据结束，耗时：0毫秒
2021-08-26 07:25:40.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877283910455296 [0;39m 生成今日电子书快照开始
2021-08-26 07:25:40.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877283910455296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:25:40.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877283910455296 [0;39m ==> Parameters: 
2021-08-26 07:25:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877283910455296 [0;39m <==    Updates: 0
2021-08-26 07:25:40.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877283910455296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:25:45.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877304894558208 [0;39m 生成今日电子书快照开始
2021-08-26 07:25:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877304894558208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:25:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877304894558208 [0;39m ==> Parameters: 
2021-08-26 07:25:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877304894558208 [0;39m <==    Updates: 0
2021-08-26 07:25:45.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877304894558208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:25:50.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877325866078208 [0;39m 生成今日电子书快照开始
2021-08-26 07:25:50.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877325866078208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:25:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877325866078208 [0;39m ==> Parameters: 
2021-08-26 07:25:50.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877325866078208 [0;39m <==    Updates: 0
2021-08-26 07:25:50.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877325866078208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:25:55.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877346854375424 [0;39m 生成今日电子书快照开始
2021-08-26 07:25:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877346854375424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:25:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877346854375424 [0;39m ==> Parameters: 
2021-08-26 07:25:55.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877346854375424 [0;39m <==    Updates: 0
2021-08-26 07:25:55.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877346854375424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:26:00.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877367817506816 [0;39m 生成今日电子书快照开始
2021-08-26 07:26:00.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877367817506816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:26:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877367817506816 [0;39m ==> Parameters: 
2021-08-26 07:26:00.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877367817506816 [0;39m <==    Updates: 0
2021-08-26 07:26:00.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877367817506816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:26:05.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85877388801609728 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:26:05.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877388801609728 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:26:05.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877388801609728 [0;39m ==> Parameters: 
2021-08-26 07:26:05.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877388801609728 [0;39m <==    Updates: 5
2021-08-26 07:26:05.016 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85877388801609728 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:26:05.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877388805804032 [0;39m 生成今日电子书快照开始
2021-08-26 07:26:05.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877388805804032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:26:05.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877388805804032 [0;39m ==> Parameters: 
2021-08-26 07:26:05.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877388805804032 [0;39m <==    Updates: 0
2021-08-26 07:26:05.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877388805804032 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:26:10.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877409735380992 [0;39m 生成今日电子书快照开始
2021-08-26 07:26:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877409735380992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:26:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877409735380992 [0;39m ==> Parameters: 
2021-08-26 07:26:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877409735380992 [0;39m <==    Updates: 0
2021-08-26 07:26:10.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877409735380992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:26:15.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877430690123776 [0;39m 生成今日电子书快照开始
2021-08-26 07:26:15.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877430690123776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:26:15.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877430690123776 [0;39m ==> Parameters: 
2021-08-26 07:26:15.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877430690123776 [0;39m <==    Updates: 0
2021-08-26 07:26:15.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877430690123776 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:26:20.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877451686809600 [0;39m 生成今日电子书快照开始
2021-08-26 07:26:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877451686809600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:26:20.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877451686809600 [0;39m ==> Parameters: 
2021-08-26 07:26:20.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877451686809600 [0;39m <==    Updates: 0
2021-08-26 07:26:20.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877451686809600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:26:25.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877472637358080 [0;39m 生成今日电子书快照开始
2021-08-26 07:26:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877472637358080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:26:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877472637358080 [0;39m ==> Parameters: 
2021-08-26 07:26:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877472637358080 [0;39m <==    Updates: 0
2021-08-26 07:26:25.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877472637358080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:26:30.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877493629849600 [0;39m 生成今日电子书快照开始
2021-08-26 07:26:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877493629849600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:26:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877493629849600 [0;39m ==> Parameters: 
2021-08-26 07:26:30.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877493629849600 [0;39m <==    Updates: 0
2021-08-26 07:26:30.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877493629849600 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:26:35.003 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85877514580398080 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:26:35.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877514580398080 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:26:35.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877514580398080 [0;39m ==> Parameters: 
2021-08-26 07:26:35.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877514580398080 [0;39m <==    Updates: 5
2021-08-26 07:26:35.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85877514580398080 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:26:35.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877514588786688 [0;39m 生成今日电子书快照开始
2021-08-26 07:26:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877514588786688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:26:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877514588786688 [0;39m ==> Parameters: 
2021-08-26 07:26:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877514588786688 [0;39m <==    Updates: 0
2021-08-26 07:26:35.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877514588786688 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:26:40.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877535577083904 [0;39m 生成今日电子书快照开始
2021-08-26 07:26:40.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877535577083904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:26:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877535577083904 [0;39m ==> Parameters: 
2021-08-26 07:26:40.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877535577083904 [0;39m <==    Updates: 0
2021-08-26 07:26:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877535577083904 [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-08-26 07:26:45.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877556540215296 [0;39m 生成今日电子书快照开始
2021-08-26 07:26:45.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877556540215296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:26:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877556540215296 [0;39m ==> Parameters: 
2021-08-26 07:26:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877556540215296 [0;39m <==    Updates: 0
2021-08-26 07:26:45.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877556540215296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:26:50.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877577545289728 [0;39m 生成今日电子书快照开始
2021-08-26 07:26:50.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877577545289728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:26:50.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877577545289728 [0;39m ==> Parameters: 
2021-08-26 07:26:50.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877577545289728 [0;39m <==    Updates: 0
2021-08-26 07:26:50.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877577545289728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:26:55.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877598458089472 [0;39m 生成今日电子书快照开始
2021-08-26 07:26:55.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877598458089472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:26:55.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877598458089472 [0;39m ==> Parameters: 
2021-08-26 07:26:55.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877598458089472 [0;39m <==    Updates: 0
2021-08-26 07:26:55.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877598458089472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:27:00.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877619471552512 [0;39m 生成今日电子书快照开始
2021-08-26 07:27:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877619471552512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:27:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877619471552512 [0;39m ==> Parameters: 
2021-08-26 07:27:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877619471552512 [0;39m <==    Updates: 0
2021-08-26 07:27:00.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877619471552512 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:27:05.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85877640417906688 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:27:05.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877640417906688 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:27:05.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877640417906688 [0;39m ==> Parameters: 
2021-08-26 07:27:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877640417906688 [0;39m <==    Updates: 5
2021-08-26 07:27:05.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85877640417906688 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:27:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877640426295296 [0;39m 生成今日电子书快照开始
2021-08-26 07:27:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877640426295296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:27:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877640426295296 [0;39m ==> Parameters: 
2021-08-26 07:27:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877640426295296 [0;39m <==    Updates: 0
2021-08-26 07:27:05.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877640426295296 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:27:10.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877661410398208 [0;39m 生成今日电子书快照开始
2021-08-26 07:27:10.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877661410398208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:27:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877661410398208 [0;39m ==> Parameters: 
2021-08-26 07:27:10.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877661410398208 [0;39m <==    Updates: 0
2021-08-26 07:27:10.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877661410398208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:27:15.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877682360946688 [0;39m 生成今日电子书快照开始
2021-08-26 07:27:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877682360946688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:27:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877682360946688 [0;39m ==> Parameters: 
2021-08-26 07:27:15.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877682360946688 [0;39m <==    Updates: 0
2021-08-26 07:27:15.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877682360946688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:27:20.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877703328272384 [0;39m 生成今日电子书快照开始
2021-08-26 07:27:20.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877703328272384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:27:20.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877703328272384 [0;39m ==> Parameters: 
2021-08-26 07:27:20.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877703328272384 [0;39m <==    Updates: 0
2021-08-26 07:27:20.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877703328272384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:27:25.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877724308180992 [0;39m 生成今日电子书快照开始
2021-08-26 07:27:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877724308180992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:27:25.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877724308180992 [0;39m ==> Parameters: 
2021-08-26 07:27:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877724308180992 [0;39m <==    Updates: 0
2021-08-26 07:27:25.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877724308180992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:27:30.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877745292283904 [0;39m 生成今日电子书快照开始
2021-08-26 07:27:30.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877745292283904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:27:30.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877745292283904 [0;39m ==> Parameters: 
2021-08-26 07:27:30.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877745292283904 [0;39m <==    Updates: 0
2021-08-26 07:27:30.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877745292283904 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:27:35.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85877766284775424 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:27:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877766284775424 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:27:35.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877766284775424 [0;39m ==> Parameters: 
2021-08-26 07:27:35.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877766284775424 [0;39m <==    Updates: 5
2021-08-26 07:27:35.016 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85877766284775424 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:27:35.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877766293164032 [0;39m 生成今日电子书快照开始
2021-08-26 07:27:35.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877766293164032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:27:35.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877766293164032 [0;39m ==> Parameters: 
2021-08-26 07:27:35.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877766293164032 [0;39m <==    Updates: 0
2021-08-26 07:27:35.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877766293164032 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:27:40.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877787210158080 [0;39m 生成今日电子书快照开始
2021-08-26 07:27:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877787210158080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:27:40.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877787210158080 [0;39m ==> Parameters: 
2021-08-26 07:27:40.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877787210158080 [0;39m <==    Updates: 0
2021-08-26 07:27:40.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877787210158080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:27:45.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877808190066688 [0;39m 生成今日电子书快照开始
2021-08-26 07:27:45.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877808190066688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:27:45.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877808190066688 [0;39m ==> Parameters: 
2021-08-26 07:27:45.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877808190066688 [0;39m <==    Updates: 0
2021-08-26 07:27:45.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877808190066688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:27:50.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877829178363904 [0;39m 生成今日电子书快照开始
2021-08-26 07:27:50.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877829178363904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:27:50.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877829178363904 [0;39m ==> Parameters: 
2021-08-26 07:27:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877829178363904 [0;39m <==    Updates: 0
2021-08-26 07:27:50.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877829178363904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:27:55.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877850141495296 [0;39m 生成今日电子书快照开始
2021-08-26 07:27:55.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877850141495296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:27:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877850141495296 [0;39m ==> Parameters: 
2021-08-26 07:27:55.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877850141495296 [0;39m <==    Updates: 0
2021-08-26 07:27:55.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877850141495296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:28:00.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877871092043776 [0;39m 生成今日电子书快照开始
2021-08-26 07:28:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877871092043776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:28:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877871092043776 [0;39m ==> Parameters: 
2021-08-26 07:28:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877871092043776 [0;39m <==    Updates: 0
2021-08-26 07:28:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877871092043776 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:28:05.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877892101312512 [0;39m 生成今日电子书快照开始
2021-08-26 07:28:05.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877892101312512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:28:05.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877892101312512 [0;39m ==> Parameters: 
2021-08-26 07:28:05.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877892101312512 [0;39m <==    Updates: 0
2021-08-26 07:28:05.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877892101312512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:28:05.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85877892109701120 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:28:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877892109701120 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:28:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877892109701120 [0;39m ==> Parameters: 
2021-08-26 07:28:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85877892109701120 [0;39m <==    Updates: 5
2021-08-26 07:28:05.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85877892109701120 [0;39m 更新电子书下的文档数据结束，耗时：0毫秒
2021-08-26 07:28:10.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877913043472384 [0;39m 生成今日电子书快照开始
2021-08-26 07:28:10.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877913043472384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:28:10.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877913043472384 [0;39m ==> Parameters: 
2021-08-26 07:28:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877913043472384 [0;39m <==    Updates: 0
2021-08-26 07:28:10.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877913043472384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:28:15.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877934044352512 [0;39m 生成今日电子书快照开始
2021-08-26 07:28:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877934044352512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:28:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877934044352512 [0;39m ==> Parameters: 
2021-08-26 07:28:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877934044352512 [0;39m <==    Updates: 0
2021-08-26 07:28:15.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877934044352512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:28:20.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877954986512384 [0;39m 生成今日电子书快照开始
2021-08-26 07:28:20.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877954986512384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:28:20.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877954986512384 [0;39m ==> Parameters: 
2021-08-26 07:28:20.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877954986512384 [0;39m <==    Updates: 0
2021-08-26 07:28:20.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877954986512384 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:28:25.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877975953838080 [0;39m 生成今日电子书快照开始
2021-08-26 07:28:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877975953838080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:28:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877975953838080 [0;39m ==> Parameters: 
2021-08-26 07:28:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877975953838080 [0;39m <==    Updates: 0
2021-08-26 07:28:25.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877975953838080 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:28:30.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85877996925358080 [0;39m 生成今日电子书快照开始
2021-08-26 07:28:30.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877996925358080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:28:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877996925358080 [0;39m ==> Parameters: 
2021-08-26 07:28:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85877996925358080 [0;39m <==    Updates: 0
2021-08-26 07:28:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85877996925358080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:28:35.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85878017926238208 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:28:35.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878017926238208 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:28:35.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878017926238208 [0;39m ==> Parameters: 
2021-08-26 07:28:35.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878017926238208 [0;39m <==    Updates: 5
2021-08-26 07:28:35.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85878017926238208 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:28:35.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878017930432512 [0;39m 生成今日电子书快照开始
2021-08-26 07:28:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878017930432512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:28:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878017930432512 [0;39m ==> Parameters: 
2021-08-26 07:28:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878017930432512 [0;39m <==    Updates: 0
2021-08-26 07:28:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878017930432512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:28:40.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878038918729728 [0;39m 生成今日电子书快照开始
2021-08-26 07:28:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878038918729728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:28:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878038918729728 [0;39m ==> Parameters: 
2021-08-26 07:28:40.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878038918729728 [0;39m <==    Updates: 0
2021-08-26 07:28:40.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878038918729728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:28:45.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878059856695296 [0;39m 生成今日电子书快照开始
2021-08-26 07:28:45.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878059856695296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:28:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878059856695296 [0;39m ==> Parameters: 
2021-08-26 07:28:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878059856695296 [0;39m <==    Updates: 0
2021-08-26 07:28:45.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878059856695296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:28:50.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878080849186816 [0;39m 生成今日电子书快照开始
2021-08-26 07:28:50.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878080849186816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:28:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878080849186816 [0;39m ==> Parameters: 
2021-08-26 07:28:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878080849186816 [0;39m <==    Updates: 0
2021-08-26 07:28:50.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878080849186816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:28:55.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878101824901120 [0;39m 生成今日电子书快照开始
2021-08-26 07:28:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878101824901120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:28:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878101824901120 [0;39m ==> Parameters: 
2021-08-26 07:28:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878101824901120 [0;39m <==    Updates: 0
2021-08-26 07:28:55.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878101824901120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:29:00.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878122767060992 [0;39m 生成今日电子书快照开始
2021-08-26 07:29:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878122767060992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:29:00.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878122767060992 [0;39m ==> Parameters: 
2021-08-26 07:29:00.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878122767060992 [0;39m <==    Updates: 0
2021-08-26 07:29:00.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878122767060992 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:29:05.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878143734386688 [0;39m 生成今日电子书快照开始
2021-08-26 07:29:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878143734386688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:29:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878143734386688 [0;39m ==> Parameters: 
2021-08-26 07:29:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878143734386688 [0;39m <==    Updates: 0
2021-08-26 07:29:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878143734386688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:29:05.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85878143742775296 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:29:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878143742775296 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:29:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878143742775296 [0;39m ==> Parameters: 
2021-08-26 07:29:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878143742775296 [0;39m <==    Updates: 5
2021-08-26 07:29:05.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85878143742775296 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:29:10.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878164705906688 [0;39m 生成今日电子书快照开始
2021-08-26 07:29:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878164705906688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:29:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878164705906688 [0;39m ==> Parameters: 
2021-08-26 07:29:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878164705906688 [0;39m <==    Updates: 0
2021-08-26 07:29:10.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878164705906688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:29:15.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878185673232384 [0;39m 生成今日电子书快照开始
2021-08-26 07:29:15.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878185673232384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:29:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878185673232384 [0;39m ==> Parameters: 
2021-08-26 07:29:15.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878185673232384 [0;39m <==    Updates: 0
2021-08-26 07:29:15.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878185673232384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:29:20.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878206665723904 [0;39m 生成今日电子书快照开始
2021-08-26 07:29:20.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878206665723904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:29:20.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878206665723904 [0;39m ==> Parameters: 
2021-08-26 07:29:20.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878206665723904 [0;39m <==    Updates: 0
2021-08-26 07:29:20.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878206665723904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:29:25.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878227637243904 [0;39m 生成今日电子书快照开始
2021-08-26 07:29:25.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878227637243904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:29:25.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878227637243904 [0;39m ==> Parameters: 
2021-08-26 07:29:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878227637243904 [0;39m <==    Updates: 0
2021-08-26 07:29:25.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878227637243904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:29:30.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878248583598080 [0;39m 生成今日电子书快照开始
2021-08-26 07:29:30.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878248583598080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:29:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878248583598080 [0;39m ==> Parameters: 
2021-08-26 07:29:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878248583598080 [0;39m <==    Updates: 0
2021-08-26 07:29:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878248583598080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:29:35.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85878269580283904 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:29:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878269580283904 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:29:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878269580283904 [0;39m ==> Parameters: 
2021-08-26 07:29:35.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878269580283904 [0;39m <==    Updates: 5
2021-08-26 07:29:35.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85878269580283904 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:29:35.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878269584478208 [0;39m 生成今日电子书快照开始
2021-08-26 07:29:35.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878269584478208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:29:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878269584478208 [0;39m ==> Parameters: 
2021-08-26 07:29:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878269584478208 [0;39m <==    Updates: 0
2021-08-26 07:29:35.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878269584478208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:29:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878290572775424 [0;39m 生成今日电子书快照开始
2021-08-26 07:29:40.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878290572775424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:29:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878290572775424 [0;39m ==> Parameters: 
2021-08-26 07:29:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878290572775424 [0;39m <==    Updates: 0
2021-08-26 07:29:40.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878290572775424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:29:45.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878311514935296 [0;39m 生成今日电子书快照开始
2021-08-26 07:29:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878311514935296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:29:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878311514935296 [0;39m ==> Parameters: 
2021-08-26 07:29:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878311514935296 [0;39m <==    Updates: 0
2021-08-26 07:29:45.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878311514935296 [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-08-26 07:29:50.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878332515815424 [0;39m 生成今日电子书快照开始
2021-08-26 07:29:50.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878332515815424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:29:50.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878332515815424 [0;39m ==> Parameters: 
2021-08-26 07:29:50.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878332515815424 [0;39m <==    Updates: 0
2021-08-26 07:29:50.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878332515815424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:29:55.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878353462169600 [0;39m 生成今日电子书快照开始
2021-08-26 07:29:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878353462169600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:29:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878353462169600 [0;39m ==> Parameters: 
2021-08-26 07:29:55.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878353462169600 [0;39m <==    Updates: 0
2021-08-26 07:29:55.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878353462169600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:30:00.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878374416912384 [0;39m 生成今日电子书快照开始
2021-08-26 07:30:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878374416912384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:30:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878374416912384 [0;39m ==> Parameters: 
2021-08-26 07:30:00.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878374416912384 [0;39m <==    Updates: 0
2021-08-26 07:30:00.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878374416912384 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:30:05.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878395380043776 [0;39m 生成今日电子书快照开始
2021-08-26 07:30:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878395380043776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:30:05.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878395380043776 [0;39m ==> Parameters: 
2021-08-26 07:30:05.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878395380043776 [0;39m <==    Updates: 0
2021-08-26 07:30:05.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878395380043776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:30:05.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85878395388432384 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:30:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878395388432384 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:30:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878395388432384 [0;39m ==> Parameters: 
2021-08-26 07:30:05.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878395388432384 [0;39m <==    Updates: 5
2021-08-26 07:30:05.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85878395388432384 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:30:10.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878416389312512 [0;39m 生成今日电子书快照开始
2021-08-26 07:30:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878416389312512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:30:10.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878416389312512 [0;39m ==> Parameters: 
2021-08-26 07:30:10.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878416389312512 [0;39m <==    Updates: 0
2021-08-26 07:30:10.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878416389312512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:30:15.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878437344055296 [0;39m 生成今日电子书快照开始
2021-08-26 07:30:15.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878437344055296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:30:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878437344055296 [0;39m ==> Parameters: 
2021-08-26 07:30:15.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878437344055296 [0;39m <==    Updates: 0
2021-08-26 07:30:15.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878437344055296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:30:20.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878458336546816 [0;39m 生成今日电子书快照开始
2021-08-26 07:30:20.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878458336546816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:30:20.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878458336546816 [0;39m ==> Parameters: 
2021-08-26 07:30:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878458336546816 [0;39m <==    Updates: 0
2021-08-26 07:30:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878458336546816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:30:25.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878479295483904 [0;39m 生成今日电子书快照开始
2021-08-26 07:30:25.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878479295483904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:30:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878479295483904 [0;39m ==> Parameters: 
2021-08-26 07:30:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878479295483904 [0;39m <==    Updates: 0
2021-08-26 07:30:25.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878479295483904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:30:30.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878500271198208 [0;39m 生成今日电子书快照开始
2021-08-26 07:30:30.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878500271198208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:30:30.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878500271198208 [0;39m ==> Parameters: 
2021-08-26 07:30:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878500271198208 [0;39m <==    Updates: 0
2021-08-26 07:30:30.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878500271198208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:30:35.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878521251106816 [0;39m 生成今日电子书快照开始
2021-08-26 07:30:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878521251106816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:30:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878521251106816 [0;39m ==> Parameters: 
2021-08-26 07:30:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878521251106816 [0;39m <==    Updates: 0
2021-08-26 07:30:35.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878521251106816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:30:35.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85878521259495424 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:30:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878521259495424 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:30:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878521259495424 [0;39m ==> Parameters: 
2021-08-26 07:30:35.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878521259495424 [0;39m <==    Updates: 5
2021-08-26 07:30:35.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85878521259495424 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:30:40.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878542176489472 [0;39m 生成今日电子书快照开始
2021-08-26 07:30:40.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878542176489472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:30:40.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878542176489472 [0;39m ==> Parameters: 
2021-08-26 07:30:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878542176489472 [0;39m <==    Updates: 0
2021-08-26 07:30:40.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878542176489472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:30:45.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878563194146816 [0;39m 生成今日电子书快照开始
2021-08-26 07:30:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878563194146816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:30:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878563194146816 [0;39m ==> Parameters: 
2021-08-26 07:30:45.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878563194146816 [0;39m <==    Updates: 0
2021-08-26 07:30:45.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878563194146816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:30:50.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878584161472512 [0;39m 生成今日电子书快照开始
2021-08-26 07:30:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878584161472512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:30:50.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878584161472512 [0;39m ==> Parameters: 
2021-08-26 07:30:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878584161472512 [0;39m <==    Updates: 0
2021-08-26 07:30:50.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878584161472512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:30:55.000 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878605086855168 [0;39m 生成今日电子书快照开始
2021-08-26 07:30:55.000 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878605086855168 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:30:55.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878605086855168 [0;39m ==> Parameters: 
2021-08-26 07:30:55.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878605086855168 [0;39m <==    Updates: 0
2021-08-26 07:30:55.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878605086855168 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:31:00.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878626075152384 [0;39m 生成今日电子书快照开始
2021-08-26 07:31:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878626075152384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:31:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878626075152384 [0;39m ==> Parameters: 
2021-08-26 07:31:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878626075152384 [0;39m <==    Updates: 0
2021-08-26 07:31:00.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878626075152384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:31:05.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85878647055060992 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:31:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878647055060992 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:31:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878647055060992 [0;39m ==> Parameters: 
2021-08-26 07:31:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878647055060992 [0;39m <==    Updates: 5
2021-08-26 07:31:05.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85878647055060992 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:31:05.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878647063449600 [0;39m 生成今日电子书快照开始
2021-08-26 07:31:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878647063449600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:31:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878647063449600 [0;39m ==> Parameters: 
2021-08-26 07:31:05.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878647063449600 [0;39m <==    Updates: 0
2021-08-26 07:31:05.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878647063449600 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:31:10.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878668005609472 [0;39m 生成今日电子书快照开始
2021-08-26 07:31:10.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878668005609472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:31:10.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878668005609472 [0;39m ==> Parameters: 
2021-08-26 07:31:10.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878668005609472 [0;39m <==    Updates: 0
2021-08-26 07:31:10.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878668005609472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:31:15.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878689027461120 [0;39m 生成今日电子书快照开始
2021-08-26 07:31:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878689027461120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:31:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878689027461120 [0;39m ==> Parameters: 
2021-08-26 07:31:15.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878689027461120 [0;39m <==    Updates: 0
2021-08-26 07:31:15.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878689027461120 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:31:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878710003175424 [0;39m 生成今日电子书快照开始
2021-08-26 07:31:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878710003175424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:31:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878710003175424 [0;39m ==> Parameters: 
2021-08-26 07:31:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878710003175424 [0;39m <==    Updates: 0
2021-08-26 07:31:20.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878710003175424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:31:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878730957918208 [0;39m 生成今日电子书快照开始
2021-08-26 07:31:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878730957918208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:31:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878730957918208 [0;39m ==> Parameters: 
2021-08-26 07:31:25.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878730957918208 [0;39m <==    Updates: 0
2021-08-26 07:31:25.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878730957918208 [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-08-26 07:31:30.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878751904272384 [0;39m 生成今日电子书快照开始
2021-08-26 07:31:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878751904272384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:31:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878751904272384 [0;39m ==> Parameters: 
2021-08-26 07:31:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878751904272384 [0;39m <==    Updates: 0
2021-08-26 07:31:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878751904272384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:31:35.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878772888375296 [0;39m 生成今日电子书快照开始
2021-08-26 07:31:35.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878772888375296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:31:35.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878772888375296 [0;39m ==> Parameters: 
2021-08-26 07:31:35.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878772888375296 [0;39m <==    Updates: 0
2021-08-26 07:31:35.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878772888375296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:31:35.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85878772896763904 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:31:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878772896763904 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:31:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878772896763904 [0;39m ==> Parameters: 
2021-08-26 07:31:35.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878772896763904 [0;39m <==    Updates: 5
2021-08-26 07:31:35.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85878772896763904 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:31:40.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878793855700992 [0;39m 生成今日电子书快照开始
2021-08-26 07:31:40.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878793855700992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:31:40.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878793855700992 [0;39m ==> Parameters: 
2021-08-26 07:31:40.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878793855700992 [0;39m <==    Updates: 0
2021-08-26 07:31:40.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878793855700992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:31:45.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878814852386816 [0;39m 生成今日电子书快照开始
2021-08-26 07:31:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878814852386816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:31:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878814852386816 [0;39m ==> Parameters: 
2021-08-26 07:31:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878814852386816 [0;39m <==    Updates: 0
2021-08-26 07:31:45.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878814852386816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:31:50.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878835832295424 [0;39m 生成今日电子书快照开始
2021-08-26 07:31:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878835832295424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:31:50.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878835832295424 [0;39m ==> Parameters: 
2021-08-26 07:31:50.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878835832295424 [0;39m <==    Updates: 0
2021-08-26 07:31:50.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878835832295424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:31:55.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878856803815424 [0;39m 生成今日电子书快照开始
2021-08-26 07:31:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878856803815424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:31:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878856803815424 [0;39m ==> Parameters: 
2021-08-26 07:31:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878856803815424 [0;39m <==    Updates: 0
2021-08-26 07:31:55.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878856803815424 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:32:00.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878877720809472 [0;39m 生成今日电子书快照开始
2021-08-26 07:32:00.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878877720809472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:32:00.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878877720809472 [0;39m ==> Parameters: 
2021-08-26 07:32:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878877720809472 [0;39m <==    Updates: 0
2021-08-26 07:32:00.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878877720809472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:32:05.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85878898725883904 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:32:05.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878898725883904 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:32:05.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878898725883904 [0;39m ==> Parameters: 
2021-08-26 07:32:05.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85878898725883904 [0;39m <==    Updates: 5
2021-08-26 07:32:05.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85878898725883904 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:32:05.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878898730078208 [0;39m 生成今日电子书快照开始
2021-08-26 07:32:05.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878898730078208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:32:05.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878898730078208 [0;39m ==> Parameters: 
2021-08-26 07:32:05.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878898730078208 [0;39m <==    Updates: 0
2021-08-26 07:32:05.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878898730078208 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:32:10.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878919663849472 [0;39m 生成今日电子书快照开始
2021-08-26 07:32:10.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878919663849472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:32:10.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878919663849472 [0;39m ==> Parameters: 
2021-08-26 07:32:10.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878919663849472 [0;39m <==    Updates: 0
2021-08-26 07:32:10.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878919663849472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:32:15.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878940689895424 [0;39m 生成今日电子书快照开始
2021-08-26 07:32:15.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878940689895424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:32:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878940689895424 [0;39m ==> Parameters: 
2021-08-26 07:32:15.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878940689895424 [0;39m <==    Updates: 0
2021-08-26 07:32:15.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878940689895424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:32:20.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878961657221120 [0;39m 生成今日电子书快照开始
2021-08-26 07:32:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878961657221120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:32:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878961657221120 [0;39m ==> Parameters: 
2021-08-26 07:32:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878961657221120 [0;39m <==    Updates: 0
2021-08-26 07:32:20.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878961657221120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:32:25.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85878982611963904 [0;39m 生成今日电子书快照开始
2021-08-26 07:32:25.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878982611963904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:32:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878982611963904 [0;39m ==> Parameters: 
2021-08-26 07:32:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85878982611963904 [0;39m <==    Updates: 0
2021-08-26 07:32:25.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85878982611963904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:32:30.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879003612844032 [0;39m 生成今日电子书快照开始
2021-08-26 07:32:30.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879003612844032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:32:30.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879003612844032 [0;39m ==> Parameters: 
2021-08-26 07:32:30.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879003612844032 [0;39m <==    Updates: 0
2021-08-26 07:32:30.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879003612844032 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:32:35.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85879024575975424 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:32:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879024575975424 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:32:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879024575975424 [0;39m ==> Parameters: 
2021-08-26 07:32:35.015 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879024575975424 [0;39m <==    Updates: 5
2021-08-26 07:32:35.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85879024575975424 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:32:35.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879024580169728 [0;39m 生成今日电子书快照开始
2021-08-26 07:32:35.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879024580169728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:32:35.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879024580169728 [0;39m ==> Parameters: 
2021-08-26 07:32:35.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879024580169728 [0;39m <==    Updates: 0
2021-08-26 07:32:35.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879024580169728 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:32:40.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879045539106816 [0;39m 生成今日电子书快照开始
2021-08-26 07:32:40.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879045539106816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:32:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879045539106816 [0;39m ==> Parameters: 
2021-08-26 07:32:40.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879045539106816 [0;39m <==    Updates: 0
2021-08-26 07:32:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879045539106816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:32:45.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879066510626816 [0;39m 生成今日电子书快照开始
2021-08-26 07:32:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879066510626816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:32:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879066510626816 [0;39m ==> Parameters: 
2021-08-26 07:32:45.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879066510626816 [0;39m <==    Updates: 0
2021-08-26 07:32:45.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879066510626816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:32:50.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879087440203776 [0;39m 生成今日电子书快照开始
2021-08-26 07:32:50.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879087440203776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:32:50.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879087440203776 [0;39m ==> Parameters: 
2021-08-26 07:32:50.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879087440203776 [0;39m <==    Updates: 0
2021-08-26 07:32:50.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879087440203776 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:32:55.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879108407529472 [0;39m 生成今日电子书快照开始
2021-08-26 07:32:55.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879108407529472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:32:55.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879108407529472 [0;39m ==> Parameters: 
2021-08-26 07:32:55.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879108407529472 [0;39m <==    Updates: 0
2021-08-26 07:32:55.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879108407529472 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:33:00.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879129420992512 [0;39m 生成今日电子书快照开始
2021-08-26 07:33:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879129420992512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:33:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879129420992512 [0;39m ==> Parameters: 
2021-08-26 07:33:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879129420992512 [0;39m <==    Updates: 0
2021-08-26 07:33:00.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879129420992512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:33:05.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879150405095424 [0;39m 生成今日电子书快照开始
2021-08-26 07:33:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879150405095424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:33:05.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879150405095424 [0;39m ==> Parameters: 
2021-08-26 07:33:05.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879150405095424 [0;39m <==    Updates: 0
2021-08-26 07:33:05.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879150405095424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:33:05.016 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85879150413484032 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:33:05.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879150413484032 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:33:05.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879150413484032 [0;39m ==> Parameters: 
2021-08-26 07:33:05.017 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879150413484032 [0;39m <==    Updates: 5
2021-08-26 07:33:05.017 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85879150413484032 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:33:10.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879171343060992 [0;39m 生成今日电子书快照开始
2021-08-26 07:33:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879171343060992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:33:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879171343060992 [0;39m ==> Parameters: 
2021-08-26 07:33:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879171343060992 [0;39m <==    Updates: 0
2021-08-26 07:33:10.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879171343060992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:33:15.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879192343941120 [0;39m 生成今日电子书快照开始
2021-08-26 07:33:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879192343941120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:33:15.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879192343941120 [0;39m ==> Parameters: 
2021-08-26 07:33:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879192343941120 [0;39m <==    Updates: 0
2021-08-26 07:33:15.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879192343941120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:33:20.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879213281906688 [0;39m 生成今日电子书快照开始
2021-08-26 07:33:20.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879213281906688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:33:20.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879213281906688 [0;39m ==> Parameters: 
2021-08-26 07:33:20.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879213281906688 [0;39m <==    Updates: 0
2021-08-26 07:33:20.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879213281906688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:33:25.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879234245038080 [0;39m 生成今日电子书快照开始
2021-08-26 07:33:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879234245038080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:33:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879234245038080 [0;39m ==> Parameters: 
2021-08-26 07:33:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879234245038080 [0;39m <==    Updates: 0
2021-08-26 07:33:25.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879234245038080 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:33:30.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879255237529600 [0;39m 生成今日电子书快照开始
2021-08-26 07:33:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879255237529600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:33:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879255237529600 [0;39m ==> Parameters: 
2021-08-26 07:33:30.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879255237529600 [0;39m <==    Updates: 0
2021-08-26 07:33:30.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879255237529600 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:33:35.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879276213243904 [0;39m 生成今日电子书快照开始
2021-08-26 07:33:35.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879276213243904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:33:35.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879276213243904 [0;39m ==> Parameters: 
2021-08-26 07:33:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879276213243904 [0;39m <==    Updates: 0
2021-08-26 07:33:35.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879276213243904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:33:35.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85879276221632512 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:33:35.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879276221632512 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:33:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879276221632512 [0;39m ==> Parameters: 
2021-08-26 07:33:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879276221632512 [0;39m <==    Updates: 5
2021-08-26 07:33:35.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85879276221632512 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:33:40.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879297155403776 [0;39m 生成今日电子书快照开始
2021-08-26 07:33:40.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879297155403776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:33:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879297155403776 [0;39m ==> Parameters: 
2021-08-26 07:33:40.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879297155403776 [0;39m <==    Updates: 0
2021-08-26 07:33:40.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879297155403776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:33:45.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879318152089600 [0;39m 生成今日电子书快照开始
2021-08-26 07:33:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879318152089600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:33:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879318152089600 [0;39m ==> Parameters: 
2021-08-26 07:33:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879318152089600 [0;39m <==    Updates: 0
2021-08-26 07:33:45.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879318152089600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:33:50.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879339119415296 [0;39m 生成今日电子书快照开始
2021-08-26 07:33:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879339119415296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:33:50.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879339119415296 [0;39m ==> Parameters: 
2021-08-26 07:33:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879339119415296 [0;39m <==    Updates: 0
2021-08-26 07:33:50.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879339119415296 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:33:55.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879360120295424 [0;39m 生成今日电子书快照开始
2021-08-26 07:33:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879360120295424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:33:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879360120295424 [0;39m ==> Parameters: 
2021-08-26 07:33:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879360120295424 [0;39m <==    Updates: 0
2021-08-26 07:33:55.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879360120295424 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:34:00.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879381070843904 [0;39m 生成今日电子书快照开始
2021-08-26 07:34:00.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879381070843904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:34:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879381070843904 [0;39m ==> Parameters: 
2021-08-26 07:34:00.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879381070843904 [0;39m <==    Updates: 0
2021-08-26 07:34:00.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879381070843904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:34:05.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85879402029780992 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:34:05.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879402029780992 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:34:05.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879402029780992 [0;39m ==> Parameters: 
2021-08-26 07:34:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879402029780992 [0;39m <==    Updates: 5
2021-08-26 07:34:05.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85879402029780992 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:34:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879402033975296 [0;39m 生成今日电子书快照开始
2021-08-26 07:34:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879402033975296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:34:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879402033975296 [0;39m ==> Parameters: 
2021-08-26 07:34:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879402033975296 [0;39m <==    Updates: 0
2021-08-26 07:34:05.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879402033975296 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:34:10.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879423043244032 [0;39m 生成今日电子书快照开始
2021-08-26 07:34:10.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879423043244032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:34:10.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879423043244032 [0;39m ==> Parameters: 
2021-08-26 07:34:10.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879423043244032 [0;39m <==    Updates: 0
2021-08-26 07:34:10.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879423043244032 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:34:15.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879443951849472 [0;39m 生成今日电子书快照开始
2021-08-26 07:34:15.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879443951849472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:34:15.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879443951849472 [0;39m ==> Parameters: 
2021-08-26 07:34:15.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879443951849472 [0;39m <==    Updates: 0
2021-08-26 07:34:15.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879443951849472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:34:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879464977895424 [0;39m 生成今日电子书快照开始
2021-08-26 07:34:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879464977895424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:34:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879464977895424 [0;39m ==> Parameters: 
2021-08-26 07:34:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879464977895424 [0;39m <==    Updates: 0
2021-08-26 07:34:20.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879464977895424 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:34:25.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879485894889472 [0;39m 生成今日电子书快照开始
2021-08-26 07:34:25.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879485894889472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:34:25.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879485894889472 [0;39m ==> Parameters: 
2021-08-26 07:34:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879485894889472 [0;39m <==    Updates: 0
2021-08-26 07:34:25.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879485894889472 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:34:30.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879506912546816 [0;39m 生成今日电子书快照开始
2021-08-26 07:34:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879506912546816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:34:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879506912546816 [0;39m ==> Parameters: 
2021-08-26 07:34:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879506912546816 [0;39m <==    Updates: 0
2021-08-26 07:34:30.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879506912546816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:34:35.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85879527884066816 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:34:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879527884066816 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:34:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879527884066816 [0;39m ==> Parameters: 
2021-08-26 07:34:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879527884066816 [0;39m <==    Updates: 5
2021-08-26 07:34:35.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85879527884066816 [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-08-26 07:34:35.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879527896649728 [0;39m 生成今日电子书快照开始
2021-08-26 07:34:35.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879527896649728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:34:35.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879527896649728 [0;39m ==> Parameters: 
2021-08-26 07:34:35.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879527896649728 [0;39m <==    Updates: 0
2021-08-26 07:34:35.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879527896649728 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:34:40.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879548809449472 [0;39m 生成今日电子书快照开始
2021-08-26 07:34:40.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879548809449472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:34:40.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879548809449472 [0;39m ==> Parameters: 
2021-08-26 07:34:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879548809449472 [0;39m <==    Updates: 0
2021-08-26 07:34:40.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879548809449472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:34:45.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879569785163776 [0;39m 生成今日电子书快照开始
2021-08-26 07:34:45.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879569785163776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:34:45.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879569785163776 [0;39m ==> Parameters: 
2021-08-26 07:34:45.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879569785163776 [0;39m <==    Updates: 0
2021-08-26 07:34:45.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879569785163776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:34:50.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879590760878080 [0;39m 生成今日电子书快照开始
2021-08-26 07:34:50.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879590760878080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:34:50.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879590760878080 [0;39m ==> Parameters: 
2021-08-26 07:34:50.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879590760878080 [0;39m <==    Updates: 0
2021-08-26 07:34:50.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879590760878080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:34:55.000 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879611719815168 [0;39m 生成今日电子书快照开始
2021-08-26 07:34:55.000 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879611719815168 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:34:55.000 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879611719815168 [0;39m ==> Parameters: 
2021-08-26 07:34:55.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879611719815168 [0;39m <==    Updates: 0
2021-08-26 07:34:55.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879611719815168 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:35:00.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879632699723776 [0;39m 生成今日电子书快照开始
2021-08-26 07:35:00.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879632699723776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:35:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879632699723776 [0;39m ==> Parameters: 
2021-08-26 07:35:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879632699723776 [0;39m <==    Updates: 0
2021-08-26 07:35:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879632699723776 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:35:05.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85879653713186816 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:35:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879653713186816 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:35:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879653713186816 [0;39m ==> Parameters: 
2021-08-26 07:35:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879653713186816 [0;39m <==    Updates: 5
2021-08-26 07:35:05.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85879653713186816 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:35:05.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879653721575424 [0;39m 生成今日电子书快照开始
2021-08-26 07:35:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879653721575424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:35:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879653721575424 [0;39m ==> Parameters: 
2021-08-26 07:35:05.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879653721575424 [0;39m <==    Updates: 0
2021-08-26 07:35:05.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879653721575424 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:35:10.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879674638569472 [0;39m 生成今日电子书快照开始
2021-08-26 07:35:10.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879674638569472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:35:10.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879674638569472 [0;39m ==> Parameters: 
2021-08-26 07:35:10.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879674638569472 [0;39m <==    Updates: 0
2021-08-26 07:35:10.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879674638569472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:35:15.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879695652032512 [0;39m 生成今日电子书快照开始
2021-08-26 07:35:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879695652032512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:35:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879695652032512 [0;39m ==> Parameters: 
2021-08-26 07:35:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879695652032512 [0;39m <==    Updates: 0
2021-08-26 07:35:15.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879695652032512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:35:20.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879716615163904 [0;39m 生成今日电子书快照开始
2021-08-26 07:35:20.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879716615163904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:35:20.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879716615163904 [0;39m ==> Parameters: 
2021-08-26 07:35:20.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879716615163904 [0;39m <==    Updates: 0
2021-08-26 07:35:20.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879716615163904 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:35:25.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879737599266816 [0;39m 生成今日电子书快照开始
2021-08-26 07:35:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879737599266816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:35:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879737599266816 [0;39m ==> Parameters: 
2021-08-26 07:35:25.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879737599266816 [0;39m <==    Updates: 0
2021-08-26 07:35:25.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879737599266816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:35:30.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879758537232384 [0;39m 生成今日电子书快照开始
2021-08-26 07:35:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879758537232384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:35:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879758537232384 [0;39m ==> Parameters: 
2021-08-26 07:35:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879758537232384 [0;39m <==    Updates: 0
2021-08-26 07:35:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879758537232384 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:35:35.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85879779517140992 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:35:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879779517140992 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:35:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879779517140992 [0;39m ==> Parameters: 
2021-08-26 07:35:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879779517140992 [0;39m <==    Updates: 5
2021-08-26 07:35:35.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85879779517140992 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:35:35.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879779521335296 [0;39m 生成今日电子书快照开始
2021-08-26 07:35:35.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879779521335296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:35:35.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879779521335296 [0;39m ==> Parameters: 
2021-08-26 07:35:35.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879779521335296 [0;39m <==    Updates: 0
2021-08-26 07:35:35.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879779521335296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:35:40.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879800467689472 [0;39m 生成今日电子书快照开始
2021-08-26 07:35:40.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879800467689472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:35:40.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879800467689472 [0;39m ==> Parameters: 
2021-08-26 07:35:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879800467689472 [0;39m <==    Updates: 0
2021-08-26 07:35:40.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879800467689472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:35:45.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879821481152512 [0;39m 生成今日电子书快照开始
2021-08-26 07:35:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879821481152512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:35:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879821481152512 [0;39m ==> Parameters: 
2021-08-26 07:35:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879821481152512 [0;39m <==    Updates: 0
2021-08-26 07:35:45.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879821481152512 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:35:50.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879842452672512 [0;39m 生成今日电子书快照开始
2021-08-26 07:35:50.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879842452672512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:35:50.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879842452672512 [0;39m ==> Parameters: 
2021-08-26 07:35:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879842452672512 [0;39m <==    Updates: 0
2021-08-26 07:35:50.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879842452672512 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:35:55.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879863428386816 [0;39m 生成今日电子书快照开始
2021-08-26 07:35:55.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879863428386816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:35:55.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879863428386816 [0;39m ==> Parameters: 
2021-08-26 07:35:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879863428386816 [0;39m <==    Updates: 0
2021-08-26 07:35:55.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879863428386816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:36:00.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879884387323904 [0;39m 生成今日电子书快照开始
2021-08-26 07:36:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879884387323904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:36:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879884387323904 [0;39m ==> Parameters: 
2021-08-26 07:36:00.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879884387323904 [0;39m <==    Updates: 0
2021-08-26 07:36:00.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879884387323904 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:36:05.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879905342066688 [0;39m 生成今日电子书快照开始
2021-08-26 07:36:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879905342066688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:36:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879905342066688 [0;39m ==> Parameters: 
2021-08-26 07:36:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879905342066688 [0;39m <==    Updates: 0
2021-08-26 07:36:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879905342066688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:36:05.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85879905350455296 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:36:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879905350455296 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:36:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879905350455296 [0;39m ==> Parameters: 
2021-08-26 07:36:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85879905350455296 [0;39m <==    Updates: 5
2021-08-26 07:36:05.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85879905350455296 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:36:10.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879926305198080 [0;39m 生成今日电子书快照开始
2021-08-26 07:36:10.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879926305198080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:36:10.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879926305198080 [0;39m ==> Parameters: 
2021-08-26 07:36:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879926305198080 [0;39m <==    Updates: 0
2021-08-26 07:36:10.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879926305198080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:36:15.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879947285106688 [0;39m 生成今日电子书快照开始
2021-08-26 07:36:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879947285106688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:36:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879947285106688 [0;39m ==> Parameters: 
2021-08-26 07:36:15.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879947285106688 [0;39m <==    Updates: 0
2021-08-26 07:36:15.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879947285106688 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:36:20.000 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879968235655168 [0;39m 生成今日电子书快照开始
2021-08-26 07:36:20.000 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879968235655168 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:36:20.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879968235655168 [0;39m ==> Parameters: 
2021-08-26 07:36:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879968235655168 [0;39m <==    Updates: 0
2021-08-26 07:36:20.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879968235655168 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:36:25.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85879989265895424 [0;39m 生成今日电子书快照开始
2021-08-26 07:36:25.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879989265895424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:36:25.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879989265895424 [0;39m ==> Parameters: 
2021-08-26 07:36:25.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85879989265895424 [0;39m <==    Updates: 0
2021-08-26 07:36:25.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85879989265895424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:36:30.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880010195472384 [0;39m 生成今日电子书快照开始
2021-08-26 07:36:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880010195472384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:36:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880010195472384 [0;39m ==> Parameters: 
2021-08-26 07:36:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880010195472384 [0;39m <==    Updates: 0
2021-08-26 07:36:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880010195472384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:36:35.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880031166992384 [0;39m 生成今日电子书快照开始
2021-08-26 07:36:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880031166992384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:36:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880031166992384 [0;39m ==> Parameters: 
2021-08-26 07:36:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880031166992384 [0;39m <==    Updates: 0
2021-08-26 07:36:35.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880031166992384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:36:35.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85880031175380992 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:36:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880031175380992 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:36:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880031175380992 [0;39m ==> Parameters: 
2021-08-26 07:36:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880031175380992 [0;39m <==    Updates: 5
2021-08-26 07:36:35.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85880031175380992 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:36:40.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880052142706688 [0;39m 生成今日电子书快照开始
2021-08-26 07:36:40.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880052142706688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:36:40.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880052142706688 [0;39m ==> Parameters: 
2021-08-26 07:36:40.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880052142706688 [0;39m <==    Updates: 0
2021-08-26 07:36:40.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880052142706688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:36:45.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880073110032384 [0;39m 生成今日电子书快照开始
2021-08-26 07:36:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880073110032384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:36:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880073110032384 [0;39m ==> Parameters: 
2021-08-26 07:36:45.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880073110032384 [0;39m <==    Updates: 0
2021-08-26 07:36:45.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880073110032384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:36:50.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880094102523904 [0;39m 生成今日电子书快照开始
2021-08-26 07:36:50.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880094102523904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:36:50.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880094102523904 [0;39m ==> Parameters: 
2021-08-26 07:36:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880094102523904 [0;39m <==    Updates: 0
2021-08-26 07:36:50.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880094102523904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:36:55.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880115086626816 [0;39m 生成今日电子书快照开始
2021-08-26 07:36:55.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880115086626816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:36:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880115086626816 [0;39m ==> Parameters: 
2021-08-26 07:36:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880115086626816 [0;39m <==    Updates: 0
2021-08-26 07:36:55.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880115086626816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:37:00.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880136049758208 [0;39m 生成今日电子书快照开始
2021-08-26 07:37:00.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880136049758208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:37:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880136049758208 [0;39m ==> Parameters: 
2021-08-26 07:37:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880136049758208 [0;39m <==    Updates: 0
2021-08-26 07:37:00.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880136049758208 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:37:05.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880157012889600 [0;39m 生成今日电子书快照开始
2021-08-26 07:37:05.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880157012889600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:37:05.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880157012889600 [0;39m ==> Parameters: 
2021-08-26 07:37:05.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880157012889600 [0;39m <==    Updates: 0
2021-08-26 07:37:05.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880157012889600 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:37:05.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85880157025472512 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:37:05.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880157025472512 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:37:05.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880157025472512 [0;39m ==> Parameters: 
2021-08-26 07:37:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880157025472512 [0;39m <==    Updates: 5
2021-08-26 07:37:05.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85880157025472512 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:37:10.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880177971826688 [0;39m 生成今日电子书快照开始
2021-08-26 07:37:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880177971826688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:37:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880177971826688 [0;39m ==> Parameters: 
2021-08-26 07:37:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880177971826688 [0;39m <==    Updates: 0
2021-08-26 07:37:10.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880177971826688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:37:15.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880198943346688 [0;39m 生成今日电子书快照开始
2021-08-26 07:37:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880198943346688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:37:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880198943346688 [0;39m ==> Parameters: 
2021-08-26 07:37:15.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880198943346688 [0;39m <==    Updates: 0
2021-08-26 07:37:15.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880198943346688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:37:20.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880219898089472 [0;39m 生成今日电子书快照开始
2021-08-26 07:37:20.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880219898089472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:37:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880219898089472 [0;39m ==> Parameters: 
2021-08-26 07:37:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880219898089472 [0;39m <==    Updates: 0
2021-08-26 07:37:20.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880219898089472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:37:24.526 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring DispatcherServlet 'dispatcherServlet'
2021-08-26 07:37:24.527 INFO  org.springframework.web.servlet.DispatcherServlet :525  [32m                  [0;39m Initializing Servlet 'dispatcherServlet'
2021-08-26 07:37:24.527 INFO  org.springframework.web.servlet.DispatcherServlet :547  [32m                  [0;39m Completed initialization in 0 ms
2021-08-26 07:37:24.529 INFO  com.haoyu.knowlagebase.websocket.WebSocketServer  :33   [32m                  [0;39m 有新连接：token：iTk01cttq2，session id：1，当前连接数：1
2021-08-26 07:37:24.690 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85880239565180928 [0;39m ------------- 开始 -------------
2021-08-26 07:37:24.691 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85880239565180928 [0;39m 请求地址: http://127.0.0.1:8880/ebook-snapshot/get-statistic GET
2021-08-26 07:37:24.691 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85880239565180928 [0;39m 类名方法: com.haoyu.knowlagebase.controller.EbookSnapshotController.getStatistic
2021-08-26 07:37:24.691 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85880239565180928 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:37:24.692 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85880239565180928 [0;39m 请求参数: []
2021-08-26 07:37:24.694 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85880239565180928 [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-08-26 07:37:24.694 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85880239565180928 [0;39m ==> Parameters: 
2021-08-26 07:37:24.698 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85880239565180928 [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-08-26 07:37:24.699 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85880239565180928 [0;39m <==        Row: 2021-08-26, 62, 19, 62, 19
2021-08-26 07:37:24.700 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85880239565180928 [0;39m <==      Total: 1
2021-08-26 07:37:24.703 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85880239565180928 [0;39m 返回结果: {"content":[{"date":1629907200000,"viewCount":62,"viewIncrease":62,"voteCount":19,"voteIncrease":19}],"success":true}
2021-08-26 07:37:24.703 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85880239565180928 [0;39m ------------- 结束 耗时：13 ms -------------
2021-08-26 07:37:24.740 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85880239774896128 [0;39m ------------- 开始 -------------
2021-08-26 07:37:24.740 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85880239774896128 [0;39m 请求地址: http://127.0.0.1:8880/category/all GET
2021-08-26 07:37:24.740 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85880239774896128 [0;39m 类名方法: com.haoyu.knowlagebase.controller.CategoryController.all
2021-08-26 07:37:24.740 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85880239774896128 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:37:24.741 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85880239774896128 [0;39m 请求参数: []
2021-08-26 07:37:24.744 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85880239774896128 [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-08-26 07:37:24.744 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85880239774896128 [0;39m ==> Parameters: 
2021-08-26 07:37:24.745 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==    Columns: id, parent, name, sort
2021-08-26 07:37:24.745 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 82110017238601728, 100, test2, 1
2021-08-26 07:37:24.746 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 100, 0, 前端开发, 100
2021-08-26 07:37:24.746 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 101, 100, Vue, 101
2021-08-26 07:37:24.747 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 102, 100, HTML & CSS, 102
2021-08-26 07:37:24.747 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 200, 0, Java, 200
2021-08-26 07:37:24.747 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 201, 200, 基础应用, 201
2021-08-26 07:37:24.747 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 202, 200, 框架应用, 202
2021-08-26 07:37:24.748 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 300, 0, Python, 300
2021-08-26 07:37:24.748 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 301, 300, 基础应用, 301
2021-08-26 07:37:24.748 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 302, 300, 进阶方向应用, 302
2021-08-26 07:37:24.748 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 400, 0, 数据库, 400
2021-08-26 07:37:24.748 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 401, 400, MySQL, 401
2021-08-26 07:37:24.749 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 500, 0, 其它, 500
2021-08-26 07:37:24.749 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 501, 500, 服务器, 501
2021-08-26 07:37:24.749 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 502, 500, 开发工具, 502
2021-08-26 07:37:24.749 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880239774896128 [0;39m <==        Row: 503, 500, 热门服务端语言, 503
2021-08-26 07:37:24.750 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85880239774896128 [0;39m <==      Total: 16
2021-08-26 07:37:24.757 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85880239774896128 [0;39m 返回结果: {"content":[{"id":82110017238601728,"name":"test2","parent":100,"sort":1},{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"基础应用","parent":300,"sort":301},{"id":302,"name":"进阶方向应用","parent":300,"sort":302},{"id":400,"name":"数据库","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":500,"name":"其它","parent":0,"sort":500},{"id":501,"name":"服务器","parent":500,"sort":501},{"id":502,"name":"开发工具","parent":500,"sort":502},{"id":503,"name":"热门服务端语言","parent":500,"sort":503}],"success":true}
2021-08-26 07:37:24.757 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85880239774896128 [0;39m ------------- 结束 耗时：17 ms -------------
2021-08-26 07:37:25.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880240877998080 [0;39m 生成今日电子书快照开始
2021-08-26 07:37:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880240877998080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:37:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880240877998080 [0;39m ==> Parameters: 
2021-08-26 07:37:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880240877998080 [0;39m <==    Updates: 0
2021-08-26 07:37:25.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880240877998080 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:37:30.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880261895655424 [0;39m 生成今日电子书快照开始
2021-08-26 07:37:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880261895655424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:37:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880261895655424 [0;39m ==> Parameters: 
2021-08-26 07:37:30.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880261895655424 [0;39m <==    Updates: 0
2021-08-26 07:37:30.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880261895655424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:37:35.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880282867175424 [0;39m 生成今日电子书快照开始
2021-08-26 07:37:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880282867175424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:37:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880282867175424 [0;39m ==> Parameters: 
2021-08-26 07:37:35.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880282867175424 [0;39m <==    Updates: 0
2021-08-26 07:37:35.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880282867175424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:37:35.016 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85880282875564032 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:37:35.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880282875564032 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:37:35.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880282875564032 [0;39m ==> Parameters: 
2021-08-26 07:37:35.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880282875564032 [0;39m <==    Updates: 5
2021-08-26 07:37:35.017 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85880282875564032 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:37:39.956 INFO  com.haoyu.knowlagebase.websocket.WebSocketServer  :42   [32m                  [0;39m 连接关闭，token：iTk01cttq2，session id：1！当前连接数：0
2021-08-26 07:37:40.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880303834501120 [0;39m 生成今日电子书快照开始
2021-08-26 07:37:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880303834501120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:37:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880303834501120 [0;39m ==> Parameters: 
2021-08-26 07:37:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880303834501120 [0;39m <==    Updates: 0
2021-08-26 07:37:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880303834501120 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:37:40.645 INFO  com.haoyu.knowlagebase.websocket.WebSocketServer  :33   [32m                  [0;39m 有新连接：token：bqB256VD9l，session id：2，当前连接数：1
2021-08-26 07:37:40.749 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85880306921508864 [0;39m ------------- 开始 -------------
2021-08-26 07:37:40.749 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85880306921508864 [0;39m 请求地址: http://127.0.0.1:8880/ebook-snapshot/get-statistic GET
2021-08-26 07:37:40.749 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85880306921508864 [0;39m 类名方法: com.haoyu.knowlagebase.controller.EbookSnapshotController.getStatistic
2021-08-26 07:37:40.749 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85880306921508864 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:37:40.749 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85880306921508864 [0;39m 请求参数: []
2021-08-26 07:37:40.750 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85880306921508864 [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-08-26 07:37:40.750 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85880306921508864 [0;39m ==> Parameters: 
2021-08-26 07:37:40.751 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85880306921508864 [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-08-26 07:37:40.751 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85880306921508864 [0;39m <==        Row: 2021-08-26, 62, 19, 62, 19
2021-08-26 07:37:40.752 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85880306921508864 [0;39m <==      Total: 1
2021-08-26 07:37:40.753 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85880306921508864 [0;39m 返回结果: {"content":[{"date":1629907200000,"viewCount":62,"viewIncrease":62,"voteCount":19,"voteIncrease":19}],"success":true}
2021-08-26 07:37:40.753 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85880306921508864 [0;39m ------------- 结束 耗时：4 ms -------------
2021-08-26 07:37:40.756 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85880306950868992 [0;39m ------------- 开始 -------------
2021-08-26 07:37:40.756 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85880306950868992 [0;39m 请求地址: http://127.0.0.1:8880/category/all GET
2021-08-26 07:37:40.756 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85880306950868992 [0;39m 类名方法: com.haoyu.knowlagebase.controller.CategoryController.all
2021-08-26 07:37:40.756 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85880306950868992 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:37:40.756 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85880306950868992 [0;39m 请求参数: []
2021-08-26 07:37:40.757 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85880306950868992 [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-08-26 07:37:40.757 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85880306950868992 [0;39m ==> Parameters: 
2021-08-26 07:37:40.757 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==    Columns: id, parent, name, sort
2021-08-26 07:37:40.758 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 82110017238601728, 100, test2, 1
2021-08-26 07:37:40.758 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 100, 0, 前端开发, 100
2021-08-26 07:37:40.758 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 101, 100, Vue, 101
2021-08-26 07:37:40.758 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 102, 100, HTML & CSS, 102
2021-08-26 07:37:40.759 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 200, 0, Java, 200
2021-08-26 07:37:40.759 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 201, 200, 基础应用, 201
2021-08-26 07:37:40.759 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 202, 200, 框架应用, 202
2021-08-26 07:37:40.759 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 300, 0, Python, 300
2021-08-26 07:37:40.759 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 301, 300, 基础应用, 301
2021-08-26 07:37:40.760 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 302, 300, 进阶方向应用, 302
2021-08-26 07:37:40.760 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 400, 0, 数据库, 400
2021-08-26 07:37:40.760 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 401, 400, MySQL, 401
2021-08-26 07:37:40.760 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 500, 0, 其它, 500
2021-08-26 07:37:40.760 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 501, 500, 服务器, 501
2021-08-26 07:37:40.760 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 502, 500, 开发工具, 502
2021-08-26 07:37:40.761 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85880306950868992 [0;39m <==        Row: 503, 500, 热门服务端语言, 503
2021-08-26 07:37:40.761 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85880306950868992 [0;39m <==      Total: 16
2021-08-26 07:37:40.762 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85880306950868992 [0;39m 返回结果: {"content":[{"id":82110017238601728,"name":"test2","parent":100,"sort":1},{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"基础应用","parent":300,"sort":301},{"id":302,"name":"进阶方向应用","parent":300,"sort":302},{"id":400,"name":"数据库","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":500,"name":"其它","parent":0,"sort":500},{"id":501,"name":"服务器","parent":500,"sort":501},{"id":502,"name":"开发工具","parent":500,"sort":502},{"id":503,"name":"热门服务端语言","parent":500,"sort":503}],"success":true}
2021-08-26 07:37:40.762 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85880306950868992 [0;39m ------------- 结束 耗时：6 ms -------------
2021-08-26 07:37:45.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880324793438208 [0;39m 生成今日电子书快照开始
2021-08-26 07:37:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880324793438208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:37:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880324793438208 [0;39m ==> Parameters: 
2021-08-26 07:37:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880324793438208 [0;39m <==    Updates: 0
2021-08-26 07:37:45.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880324793438208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:37:50.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880345756569600 [0;39m 生成今日电子书快照开始
2021-08-26 07:37:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880345756569600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:37:50.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880345756569600 [0;39m ==> Parameters: 
2021-08-26 07:37:50.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880345756569600 [0;39m <==    Updates: 0
2021-08-26 07:37:50.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880345756569600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:37:55.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880366698729472 [0;39m 生成今日电子书快照开始
2021-08-26 07:37:55.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880366698729472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:37:55.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880366698729472 [0;39m ==> Parameters: 
2021-08-26 07:37:55.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880366698729472 [0;39m <==    Updates: 0
2021-08-26 07:37:55.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880366698729472 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:38:00.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880387720581120 [0;39m 生成今日电子书快照开始
2021-08-26 07:38:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880387720581120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:38:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880387720581120 [0;39m ==> Parameters: 
2021-08-26 07:38:00.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880387720581120 [0;39m <==    Updates: 0
2021-08-26 07:38:00.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880387720581120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:38:05.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85880408692101120 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:38:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880408692101120 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:38:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880408692101120 [0;39m ==> Parameters: 
2021-08-26 07:38:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880408692101120 [0;39m <==    Updates: 5
2021-08-26 07:38:05.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85880408692101120 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:38:05.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880408696295424 [0;39m 生成今日电子书快照开始
2021-08-26 07:38:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880408696295424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:38:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880408696295424 [0;39m ==> Parameters: 
2021-08-26 07:38:05.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880408696295424 [0;39m <==    Updates: 0
2021-08-26 07:38:05.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880408696295424 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:38:10.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880429630066688 [0;39m 生成今日电子书快照开始
2021-08-26 07:38:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880429630066688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:38:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880429630066688 [0;39m ==> Parameters: 
2021-08-26 07:38:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880429630066688 [0;39m <==    Updates: 0
2021-08-26 07:38:10.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880429630066688 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:38:15.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880450609975296 [0;39m 生成今日电子书快照开始
2021-08-26 07:38:15.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880450609975296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:38:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880450609975296 [0;39m ==> Parameters: 
2021-08-26 07:38:15.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880450609975296 [0;39m <==    Updates: 0
2021-08-26 07:38:15.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880450609975296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:38:20.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880471615049728 [0;39m 生成今日电子书快照开始
2021-08-26 07:38:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880471615049728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:38:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880471615049728 [0;39m ==> Parameters: 
2021-08-26 07:38:20.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880471615049728 [0;39m <==    Updates: 0
2021-08-26 07:38:20.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880471615049728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:38:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880492565598208 [0;39m 生成今日电子书快照开始
2021-08-26 07:38:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880492565598208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:38:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880492565598208 [0;39m ==> Parameters: 
2021-08-26 07:38:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880492565598208 [0;39m <==    Updates: 0
2021-08-26 07:38:25.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880492565598208 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:38:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880513520340992 [0;39m 生成今日电子书快照开始
2021-08-26 07:38:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880513520340992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:38:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880513520340992 [0;39m ==> Parameters: 
2021-08-26 07:38:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880513520340992 [0;39m <==    Updates: 0
2021-08-26 07:38:30.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880513520340992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:38:35.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85880534529609728 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:38:35.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880534529609728 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:38:35.017 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880534529609728 [0;39m ==> Parameters: 
2021-08-26 07:38:35.018 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880534529609728 [0;39m <==    Updates: 5
2021-08-26 07:38:35.018 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85880534529609728 [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-08-26 07:38:35.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880534542192640 [0;39m 生成今日电子书快照开始
2021-08-26 07:38:35.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880534542192640 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:38:35.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880534542192640 [0;39m ==> Parameters: 
2021-08-26 07:38:35.019 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880534542192640 [0;39m <==    Updates: 0
2021-08-26 07:38:35.021 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880534542192640 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:38:40.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880555475963904 [0;39m 生成今日电子书快照开始
2021-08-26 07:38:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880555475963904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:38:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880555475963904 [0;39m ==> Parameters: 
2021-08-26 07:38:40.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880555475963904 [0;39m <==    Updates: 0
2021-08-26 07:38:40.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880555475963904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:38:45.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880576455872512 [0;39m 生成今日电子书快照开始
2021-08-26 07:38:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880576455872512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:38:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880576455872512 [0;39m ==> Parameters: 
2021-08-26 07:38:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880576455872512 [0;39m <==    Updates: 0
2021-08-26 07:38:45.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880576455872512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:38:50.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880597431586816 [0;39m 生成今日电子书快照开始
2021-08-26 07:38:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880597431586816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:38:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880597431586816 [0;39m ==> Parameters: 
2021-08-26 07:38:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880597431586816 [0;39m <==    Updates: 0
2021-08-26 07:38:50.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880597431586816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:38:55.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880618356969472 [0;39m 生成今日电子书快照开始
2021-08-26 07:38:55.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880618356969472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:38:55.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880618356969472 [0;39m ==> Parameters: 
2021-08-26 07:38:55.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880618356969472 [0;39m <==    Updates: 0
2021-08-26 07:38:55.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880618356969472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:39:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880639345266688 [0;39m 生成今日电子书快照开始
2021-08-26 07:39:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880639345266688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:39:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880639345266688 [0;39m ==> Parameters: 
2021-08-26 07:39:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880639345266688 [0;39m <==    Updates: 0
2021-08-26 07:39:00.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880639345266688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:39:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880660325175296 [0;39m 生成今日电子书快照开始
2021-08-26 07:39:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880660325175296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:39:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880660325175296 [0;39m ==> Parameters: 
2021-08-26 07:39:05.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880660325175296 [0;39m <==    Updates: 0
2021-08-26 07:39:05.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880660325175296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:39:05.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85880660333563904 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:39:05.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880660333563904 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:39:05.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880660333563904 [0;39m ==> Parameters: 
2021-08-26 07:39:05.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880660333563904 [0;39m <==    Updates: 5
2021-08-26 07:39:05.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85880660333563904 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:39:10.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880681326055424 [0;39m 生成今日电子书快照开始
2021-08-26 07:39:10.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880681326055424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:39:10.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880681326055424 [0;39m ==> Parameters: 
2021-08-26 07:39:10.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880681326055424 [0;39m <==    Updates: 0
2021-08-26 07:39:10.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880681326055424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:39:15.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880702289186816 [0;39m 生成今日电子书快照开始
2021-08-26 07:39:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880702289186816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:39:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880702289186816 [0;39m ==> Parameters: 
2021-08-26 07:39:15.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880702289186816 [0;39m <==    Updates: 0
2021-08-26 07:39:15.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880702289186816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:39:20.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880723222958080 [0;39m 生成今日电子书快照开始
2021-08-26 07:39:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880723222958080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:39:20.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880723222958080 [0;39m ==> Parameters: 
2021-08-26 07:39:20.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880723222958080 [0;39m <==    Updates: 0
2021-08-26 07:39:20.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880723222958080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:39:25.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880744194478080 [0;39m 生成今日电子书快照开始
2021-08-26 07:39:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880744194478080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:39:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880744194478080 [0;39m ==> Parameters: 
2021-08-26 07:39:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880744194478080 [0;39m <==    Updates: 0
2021-08-26 07:39:25.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880744194478080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:39:30.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880765165998080 [0;39m 生成今日电子书快照开始
2021-08-26 07:39:30.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880765165998080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:39:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880765165998080 [0;39m ==> Parameters: 
2021-08-26 07:39:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880765165998080 [0;39m <==    Updates: 0
2021-08-26 07:39:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880765165998080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:39:35.000 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85880786124935168 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:39:35.001 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880786124935168 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:39:35.001 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880786124935168 [0;39m ==> Parameters: 
2021-08-26 07:39:35.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880786124935168 [0;39m <==    Updates: 5
2021-08-26 07:39:35.002 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85880786124935168 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:39:35.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880786133323776 [0;39m 生成今日电子书快照开始
2021-08-26 07:39:35.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880786133323776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:39:35.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880786133323776 [0;39m ==> Parameters: 
2021-08-26 07:39:35.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880786133323776 [0;39m <==    Updates: 0
2021-08-26 07:39:35.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880786133323776 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:39:40.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880807100649472 [0;39m 生成今日电子书快照开始
2021-08-26 07:39:40.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880807100649472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:39:40.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880807100649472 [0;39m ==> Parameters: 
2021-08-26 07:39:40.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880807100649472 [0;39m <==    Updates: 0
2021-08-26 07:39:40.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880807100649472 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:39:45.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880828130889728 [0;39m 生成今日电子书快照开始
2021-08-26 07:39:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880828130889728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:39:45.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880828130889728 [0;39m ==> Parameters: 
2021-08-26 07:39:45.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880828130889728 [0;39m <==    Updates: 0
2021-08-26 07:39:45.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880828130889728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:39:50.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880849106604032 [0;39m 生成今日电子书快照开始
2021-08-26 07:39:50.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880849106604032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:39:50.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880849106604032 [0;39m ==> Parameters: 
2021-08-26 07:39:50.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880849106604032 [0;39m <==    Updates: 0
2021-08-26 07:39:50.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880849106604032 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:39:55.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880870078124032 [0;39m 生成今日电子书快照开始
2021-08-26 07:39:55.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880870078124032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:39:55.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880870078124032 [0;39m ==> Parameters: 
2021-08-26 07:39:55.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880870078124032 [0;39m <==    Updates: 0
2021-08-26 07:39:55.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880870078124032 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:40:00.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880891041255424 [0;39m 生成今日电子书快照开始
2021-08-26 07:40:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880891041255424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:40:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880891041255424 [0;39m ==> Parameters: 
2021-08-26 07:40:00.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880891041255424 [0;39m <==    Updates: 0
2021-08-26 07:40:00.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880891041255424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:40:05.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880911958249472 [0;39m 生成今日电子书快照开始
2021-08-26 07:40:05.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880911958249472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:40:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880911958249472 [0;39m ==> Parameters: 
2021-08-26 07:40:05.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880911958249472 [0;39m <==    Updates: 0
2021-08-26 07:40:05.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880911958249472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:40:05.003 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85880911966638080 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:40:05.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880911966638080 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:40:05.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880911966638080 [0;39m ==> Parameters: 
2021-08-26 07:40:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85880911966638080 [0;39m <==    Updates: 5
2021-08-26 07:40:05.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85880911966638080 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:40:10.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880932971712512 [0;39m 生成今日电子书快照开始
2021-08-26 07:40:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880932971712512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:40:10.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880932971712512 [0;39m ==> Parameters: 
2021-08-26 07:40:10.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880932971712512 [0;39m <==    Updates: 0
2021-08-26 07:40:10.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880932971712512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:40:15.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880953926455296 [0;39m 生成今日电子书快照开始
2021-08-26 07:40:15.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880953926455296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:40:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880953926455296 [0;39m ==> Parameters: 
2021-08-26 07:40:15.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880953926455296 [0;39m <==    Updates: 0
2021-08-26 07:40:15.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880953926455296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:40:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880974927335424 [0;39m 生成今日电子书快照开始
2021-08-26 07:40:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880974927335424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:40:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880974927335424 [0;39m ==> Parameters: 
2021-08-26 07:40:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880974927335424 [0;39m <==    Updates: 0
2021-08-26 07:40:20.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880974927335424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:40:25.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85880995890466816 [0;39m 生成今日电子书快照开始
2021-08-26 07:40:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880995890466816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:40:25.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880995890466816 [0;39m ==> Parameters: 
2021-08-26 07:40:25.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85880995890466816 [0;39m <==    Updates: 0
2021-08-26 07:40:25.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85880995890466816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:40:30.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881016874569728 [0;39m 生成今日电子书快照开始
2021-08-26 07:40:30.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881016874569728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:40:30.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881016874569728 [0;39m ==> Parameters: 
2021-08-26 07:40:30.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881016874569728 [0;39m <==    Updates: 0
2021-08-26 07:40:30.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881016874569728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:40:35.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85881037833506816 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:40:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881037833506816 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:40:35.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881037833506816 [0;39m ==> Parameters: 
2021-08-26 07:40:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881037833506816 [0;39m <==    Updates: 5
2021-08-26 07:40:35.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85881037833506816 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:40:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881037837701120 [0;39m 生成今日电子书快照开始
2021-08-26 07:40:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881037837701120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:40:35.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881037837701120 [0;39m ==> Parameters: 
2021-08-26 07:40:35.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881037837701120 [0;39m <==    Updates: 0
2021-08-26 07:40:35.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881037837701120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:40:40.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881058775666688 [0;39m 生成今日电子书快照开始
2021-08-26 07:40:40.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881058775666688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:40:40.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881058775666688 [0;39m ==> Parameters: 
2021-08-26 07:40:40.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881058775666688 [0;39m <==    Updates: 0
2021-08-26 07:40:40.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881058775666688 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:40:45.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881079768158208 [0;39m 生成今日电子书快照开始
2021-08-26 07:40:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881079768158208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:40:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881079768158208 [0;39m ==> Parameters: 
2021-08-26 07:40:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881079768158208 [0;39m <==    Updates: 0
2021-08-26 07:40:45.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881079768158208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:40:50.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881100722900992 [0;39m 生成今日电子书快照开始
2021-08-26 07:40:50.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881100722900992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:40:50.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881100722900992 [0;39m ==> Parameters: 
2021-08-26 07:40:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881100722900992 [0;39m <==    Updates: 0
2021-08-26 07:40:50.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881100722900992 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:40:55.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881121719586816 [0;39m 生成今日电子书快照开始
2021-08-26 07:40:55.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881121719586816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:40:55.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881121719586816 [0;39m ==> Parameters: 
2021-08-26 07:40:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881121719586816 [0;39m <==    Updates: 0
2021-08-26 07:40:55.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881121719586816 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:41:00.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881142649163776 [0;39m 生成今日电子书快照开始
2021-08-26 07:41:00.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881142649163776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:41:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881142649163776 [0;39m ==> Parameters: 
2021-08-26 07:41:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881142649163776 [0;39m <==    Updates: 0
2021-08-26 07:41:00.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881142649163776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:41:05.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881163629072384 [0;39m 生成今日电子书快照开始
2021-08-26 07:41:05.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881163629072384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:41:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881163629072384 [0;39m ==> Parameters: 
2021-08-26 07:41:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881163629072384 [0;39m <==    Updates: 0
2021-08-26 07:41:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881163629072384 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:41:05.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85881163641655296 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:41:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881163641655296 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:41:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881163641655296 [0;39m ==> Parameters: 
2021-08-26 07:41:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881163641655296 [0;39m <==    Updates: 5
2021-08-26 07:41:05.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85881163641655296 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:41:10.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881184629952512 [0;39m 生成今日电子书快照开始
2021-08-26 07:41:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881184629952512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:41:10.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881184629952512 [0;39m ==> Parameters: 
2021-08-26 07:41:10.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881184629952512 [0;39m <==    Updates: 0
2021-08-26 07:41:10.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881184629952512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:41:15.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881205567918080 [0;39m 生成今日电子书快照开始
2021-08-26 07:41:15.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881205567918080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:41:15.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881205567918080 [0;39m ==> Parameters: 
2021-08-26 07:41:15.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881205567918080 [0;39m <==    Updates: 0
2021-08-26 07:41:15.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881205567918080 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:41:20.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881226568798208 [0;39m 生成今日电子书快照开始
2021-08-26 07:41:20.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881226568798208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:41:20.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881226568798208 [0;39m ==> Parameters: 
2021-08-26 07:41:20.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881226568798208 [0;39m <==    Updates: 0
2021-08-26 07:41:20.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881226568798208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:41:25.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881247531929600 [0;39m 生成今日电子书快照开始
2021-08-26 07:41:25.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881247531929600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:41:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881247531929600 [0;39m ==> Parameters: 
2021-08-26 07:41:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881247531929600 [0;39m <==    Updates: 0
2021-08-26 07:41:25.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881247531929600 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:41:30.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881268478283776 [0;39m 生成今日电子书快照开始
2021-08-26 07:41:30.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881268478283776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:41:30.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881268478283776 [0;39m ==> Parameters: 
2021-08-26 07:41:30.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881268478283776 [0;39m <==    Updates: 0
2021-08-26 07:41:30.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881268478283776 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:41:35.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881289491746816 [0;39m 生成今日电子书快照开始
2021-08-26 07:41:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881289491746816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:41:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881289491746816 [0;39m ==> Parameters: 
2021-08-26 07:41:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881289491746816 [0;39m <==    Updates: 0
2021-08-26 07:41:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881289491746816 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:41:35.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85881289500135424 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:41:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881289500135424 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:41:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881289500135424 [0;39m ==> Parameters: 
2021-08-26 07:41:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881289500135424 [0;39m <==    Updates: 5
2021-08-26 07:41:35.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85881289500135424 [0;39m 更新电子书下的文档数据结束，耗时：0毫秒
2021-08-26 07:41:40.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881310433906688 [0;39m 生成今日电子书快照开始
2021-08-26 07:41:40.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881310433906688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:41:40.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881310433906688 [0;39m ==> Parameters: 
2021-08-26 07:41:40.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881310433906688 [0;39m <==    Updates: 0
2021-08-26 07:41:40.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881310433906688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:41:45.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881331401232384 [0;39m 生成今日电子书快照开始
2021-08-26 07:41:45.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881331401232384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:41:45.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881331401232384 [0;39m ==> Parameters: 
2021-08-26 07:41:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881331401232384 [0;39m <==    Updates: 0
2021-08-26 07:41:45.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881331401232384 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:41:50.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881352410501120 [0;39m 生成今日电子书快照开始
2021-08-26 07:41:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881352410501120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:41:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881352410501120 [0;39m ==> Parameters: 
2021-08-26 07:41:50.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881352410501120 [0;39m <==    Updates: 0
2021-08-26 07:41:50.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881352410501120 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:41:55.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881373344272384 [0;39m 生成今日电子书快照开始
2021-08-26 07:41:55.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881373344272384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:41:55.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881373344272384 [0;39m ==> Parameters: 
2021-08-26 07:41:55.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881373344272384 [0;39m <==    Updates: 0
2021-08-26 07:41:55.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881373344272384 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:42:00.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881394340958208 [0;39m 生成今日电子书快照开始
2021-08-26 07:42:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881394340958208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:42:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881394340958208 [0;39m ==> Parameters: 
2021-08-26 07:42:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881394340958208 [0;39m <==    Updates: 0
2021-08-26 07:42:00.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881394340958208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:42:05.001 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85881415274729472 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:42:05.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881415274729472 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:42:05.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881415274729472 [0;39m ==> Parameters: 
2021-08-26 07:42:05.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881415274729472 [0;39m <==    Updates: 5
2021-08-26 07:42:05.003 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85881415274729472 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:42:05.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881415283118080 [0;39m 生成今日电子书快照开始
2021-08-26 07:42:05.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881415283118080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:42:05.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881415283118080 [0;39m ==> Parameters: 
2021-08-26 07:42:05.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881415283118080 [0;39m <==    Updates: 0
2021-08-26 07:42:05.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881415283118080 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:42:10.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881436296581120 [0;39m 生成今日电子书快照开始
2021-08-26 07:42:10.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881436296581120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:42:10.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881436296581120 [0;39m ==> Parameters: 
2021-08-26 07:42:10.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881436296581120 [0;39m <==    Updates: 0
2021-08-26 07:42:10.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881436296581120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:42:15.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881457221963776 [0;39m 生成今日电子书快照开始
2021-08-26 07:42:15.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881457221963776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:42:15.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881457221963776 [0;39m ==> Parameters: 
2021-08-26 07:42:15.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881457221963776 [0;39m <==    Updates: 0
2021-08-26 07:42:15.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881457221963776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:42:20.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881478214455296 [0;39m 生成今日电子书快照开始
2021-08-26 07:42:20.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881478214455296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:42:20.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881478214455296 [0;39m ==> Parameters: 
2021-08-26 07:42:20.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881478214455296 [0;39m <==    Updates: 0
2021-08-26 07:42:20.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881478214455296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:42:25.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881499202752512 [0;39m 生成今日电子书快照开始
2021-08-26 07:42:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881499202752512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:42:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881499202752512 [0;39m ==> Parameters: 
2021-08-26 07:42:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881499202752512 [0;39m <==    Updates: 0
2021-08-26 07:42:25.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881499202752512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:42:30.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881520140718080 [0;39m 生成今日电子书快照开始
2021-08-26 07:42:30.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881520140718080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:42:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881520140718080 [0;39m ==> Parameters: 
2021-08-26 07:42:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881520140718080 [0;39m <==    Updates: 0
2021-08-26 07:42:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881520140718080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:42:35.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881541145792512 [0;39m 生成今日电子书快照开始
2021-08-26 07:42:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881541145792512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:42:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881541145792512 [0;39m ==> Parameters: 
2021-08-26 07:42:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881541145792512 [0;39m <==    Updates: 0
2021-08-26 07:42:35.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881541145792512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:42:35.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85881541154181120 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:42:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881541154181120 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:42:35.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881541154181120 [0;39m ==> Parameters: 
2021-08-26 07:42:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881541154181120 [0;39m <==    Updates: 5
2021-08-26 07:42:35.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85881541154181120 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:42:40.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881562108923904 [0;39m 生成今日电子书快照开始
2021-08-26 07:42:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881562108923904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:42:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881562108923904 [0;39m ==> Parameters: 
2021-08-26 07:42:40.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881562108923904 [0;39m <==    Updates: 0
2021-08-26 07:42:40.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881562108923904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:42:45.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881583072055296 [0;39m 生成今日电子书快照开始
2021-08-26 07:42:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881583072055296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:42:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881583072055296 [0;39m ==> Parameters: 
2021-08-26 07:42:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881583072055296 [0;39m <==    Updates: 0
2021-08-26 07:42:45.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881583072055296 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:42:50.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881604030992384 [0;39m 生成今日电子书快照开始
2021-08-26 07:42:50.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881604030992384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:42:50.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881604030992384 [0;39m ==> Parameters: 
2021-08-26 07:42:50.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881604030992384 [0;39m <==    Updates: 0
2021-08-26 07:42:50.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881604030992384 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:42:55.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881624998318080 [0;39m 生成今日电子书快照开始
2021-08-26 07:42:55.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881624998318080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:42:55.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881624998318080 [0;39m ==> Parameters: 
2021-08-26 07:42:55.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881624998318080 [0;39m <==    Updates: 0
2021-08-26 07:42:55.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881624998318080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:43:00.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881645961449472 [0;39m 生成今日电子书快照开始
2021-08-26 07:43:00.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881645961449472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:43:00.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881645961449472 [0;39m ==> Parameters: 
2021-08-26 07:43:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881645961449472 [0;39m <==    Updates: 0
2021-08-26 07:43:00.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881645961449472 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:43:05.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881666932969472 [0;39m 生成今日电子书快照开始
2021-08-26 07:43:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881666932969472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:43:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881666932969472 [0;39m ==> Parameters: 
2021-08-26 07:43:05.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881666932969472 [0;39m <==    Updates: 0
2021-08-26 07:43:05.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881666932969472 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:43:05.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85881666945552384 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:43:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881666945552384 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:43:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881666945552384 [0;39m ==> Parameters: 
2021-08-26 07:43:05.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881666945552384 [0;39m <==    Updates: 5
2021-08-26 07:43:05.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85881666945552384 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:43:10.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881687938043904 [0;39m 生成今日电子书快照开始
2021-08-26 07:43:10.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881687938043904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:43:10.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881687938043904 [0;39m ==> Parameters: 
2021-08-26 07:43:10.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881687938043904 [0;39m <==    Updates: 0
2021-08-26 07:43:10.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881687938043904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:43:15.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881708901175296 [0;39m 生成今日电子书快照开始
2021-08-26 07:43:15.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881708901175296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:43:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881708901175296 [0;39m ==> Parameters: 
2021-08-26 07:43:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881708901175296 [0;39m <==    Updates: 0
2021-08-26 07:43:15.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881708901175296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:43:20.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881729851723776 [0;39m 生成今日电子书快照开始
2021-08-26 07:43:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881729851723776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:43:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881729851723776 [0;39m ==> Parameters: 
2021-08-26 07:43:20.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881729851723776 [0;39m <==    Updates: 0
2021-08-26 07:43:20.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881729851723776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:43:25.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881750819049472 [0;39m 生成今日电子书快照开始
2021-08-26 07:43:25.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881750819049472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:43:25.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881750819049472 [0;39m ==> Parameters: 
2021-08-26 07:43:25.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881750819049472 [0;39m <==    Updates: 0
2021-08-26 07:43:25.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881750819049472 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:43:30.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881771849289728 [0;39m 生成今日电子书快照开始
2021-08-26 07:43:30.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881771849289728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:43:30.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881771849289728 [0;39m ==> Parameters: 
2021-08-26 07:43:30.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881771849289728 [0;39m <==    Updates: 0
2021-08-26 07:43:30.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881771849289728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:43:35.001 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85881792762089472 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:43:35.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881792762089472 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:43:35.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881792762089472 [0;39m ==> Parameters: 
2021-08-26 07:43:35.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881792762089472 [0;39m <==    Updates: 5
2021-08-26 07:43:35.003 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85881792762089472 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:43:35.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881792770478080 [0;39m 生成今日电子书快照开始
2021-08-26 07:43:35.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881792770478080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:43:35.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881792770478080 [0;39m ==> Parameters: 
2021-08-26 07:43:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881792770478080 [0;39m <==    Updates: 0
2021-08-26 07:43:35.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881792770478080 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:43:40.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881813783941120 [0;39m 生成今日电子书快照开始
2021-08-26 07:43:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881813783941120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:43:40.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881813783941120 [0;39m ==> Parameters: 
2021-08-26 07:43:40.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881813783941120 [0;39m <==    Updates: 0
2021-08-26 07:43:40.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881813783941120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:43:45.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881834755461120 [0;39m 生成今日电子书快照开始
2021-08-26 07:43:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881834755461120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:43:45.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881834755461120 [0;39m ==> Parameters: 
2021-08-26 07:43:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881834755461120 [0;39m <==    Updates: 0
2021-08-26 07:43:45.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881834755461120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:43:50.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881855718592512 [0;39m 生成今日电子书快照开始
2021-08-26 07:43:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881855718592512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:43:50.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881855718592512 [0;39m ==> Parameters: 
2021-08-26 07:43:50.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881855718592512 [0;39m <==    Updates: 0
2021-08-26 07:43:50.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881855718592512 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:43:55.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881876702695424 [0;39m 生成今日电子书快照开始
2021-08-26 07:43:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881876702695424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:43:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881876702695424 [0;39m ==> Parameters: 
2021-08-26 07:43:55.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881876702695424 [0;39m <==    Updates: 0
2021-08-26 07:43:55.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881876702695424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:44:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881897636466688 [0;39m 生成今日电子书快照开始
2021-08-26 07:44:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881897636466688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:44:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881897636466688 [0;39m ==> Parameters: 
2021-08-26 07:44:00.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881897636466688 [0;39m <==    Updates: 0
2021-08-26 07:44:00.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881897636466688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:44:05.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881918607986688 [0;39m 生成今日电子书快照开始
2021-08-26 07:44:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881918607986688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:44:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881918607986688 [0;39m ==> Parameters: 
2021-08-26 07:44:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881918607986688 [0;39m <==    Updates: 0
2021-08-26 07:44:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881918607986688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:44:05.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85881918616375296 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:44:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881918616375296 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:44:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881918616375296 [0;39m ==> Parameters: 
2021-08-26 07:44:05.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85881918616375296 [0;39m <==    Updates: 5
2021-08-26 07:44:05.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85881918616375296 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:44:10.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881939579506688 [0;39m 生成今日电子书快照开始
2021-08-26 07:44:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881939579506688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:44:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881939579506688 [0;39m ==> Parameters: 
2021-08-26 07:44:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881939579506688 [0;39m <==    Updates: 0
2021-08-26 07:44:10.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881939579506688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:44:15.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881960542638080 [0;39m 生成今日电子书快照开始
2021-08-26 07:44:15.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881960542638080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:44:15.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881960542638080 [0;39m ==> Parameters: 
2021-08-26 07:44:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881960542638080 [0;39m <==    Updates: 0
2021-08-26 07:44:15.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881960542638080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:44:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85881981560295424 [0;39m 生成今日电子书快照开始
2021-08-26 07:44:20.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881981560295424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:44:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881981560295424 [0;39m ==> Parameters: 
2021-08-26 07:44:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85881981560295424 [0;39m <==    Updates: 0
2021-08-26 07:44:20.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85881981560295424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:44:25.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882002477289472 [0;39m 生成今日电子书快照开始
2021-08-26 07:44:25.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882002477289472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:44:25.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882002477289472 [0;39m ==> Parameters: 
2021-08-26 07:44:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882002477289472 [0;39m <==    Updates: 0
2021-08-26 07:44:25.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882002477289472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:44:30.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882023499141120 [0;39m 生成今日电子书快照开始
2021-08-26 07:44:30.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882023499141120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:44:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882023499141120 [0;39m ==> Parameters: 
2021-08-26 07:44:30.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882023499141120 [0;39m <==    Updates: 0
2021-08-26 07:44:30.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882023499141120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:44:35.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882044437106688 [0;39m 生成今日电子书快照开始
2021-08-26 07:44:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882044437106688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:44:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882044437106688 [0;39m ==> Parameters: 
2021-08-26 07:44:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882044437106688 [0;39m <==    Updates: 0
2021-08-26 07:44:35.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882044437106688 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:44:35.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85882044441300992 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:44:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882044441300992 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:44:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882044441300992 [0;39m ==> Parameters: 
2021-08-26 07:44:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882044441300992 [0;39m <==    Updates: 5
2021-08-26 07:44:35.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85882044441300992 [0;39m 更新电子书下的文档数据结束，耗时：0毫秒
2021-08-26 07:44:40.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882065446375424 [0;39m 生成今日电子书快照开始
2021-08-26 07:44:40.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882065446375424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:44:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882065446375424 [0;39m ==> Parameters: 
2021-08-26 07:44:40.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882065446375424 [0;39m <==    Updates: 0
2021-08-26 07:44:40.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882065446375424 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:44:45.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882086417895424 [0;39m 生成今日电子书快照开始
2021-08-26 07:44:45.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882086417895424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:44:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882086417895424 [0;39m ==> Parameters: 
2021-08-26 07:44:45.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882086417895424 [0;39m <==    Updates: 0
2021-08-26 07:44:45.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882086417895424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:44:50.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882107393609728 [0;39m 生成今日电子书快照开始
2021-08-26 07:44:50.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882107393609728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:44:50.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882107393609728 [0;39m ==> Parameters: 
2021-08-26 07:44:50.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882107393609728 [0;39m <==    Updates: 0
2021-08-26 07:44:50.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882107393609728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:44:55.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882128318992384 [0;39m 生成今日电子书快照开始
2021-08-26 07:44:55.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882128318992384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:44:55.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882128318992384 [0;39m ==> Parameters: 
2021-08-26 07:44:55.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882128318992384 [0;39m <==    Updates: 0
2021-08-26 07:44:55.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882128318992384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:45:00.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882149319872512 [0;39m 生成今日电子书快照开始
2021-08-26 07:45:00.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882149319872512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:45:00.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882149319872512 [0;39m ==> Parameters: 
2021-08-26 07:45:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882149319872512 [0;39m <==    Updates: 0
2021-08-26 07:45:00.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882149319872512 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:45:05.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882170253643776 [0;39m 生成今日电子书快照开始
2021-08-26 07:45:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882170253643776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:45:05.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882170253643776 [0;39m ==> Parameters: 
2021-08-26 07:45:05.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882170253643776 [0;39m <==    Updates: 0
2021-08-26 07:45:05.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882170253643776 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:45:05.003 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85882170257838080 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:45:05.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882170257838080 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:45:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882170257838080 [0;39m ==> Parameters: 
2021-08-26 07:45:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882170257838080 [0;39m <==    Updates: 5
2021-08-26 07:45:05.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85882170257838080 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:45:10.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882191246135296 [0;39m 生成今日电子书快照开始
2021-08-26 07:45:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882191246135296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:45:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882191246135296 [0;39m ==> Parameters: 
2021-08-26 07:45:10.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882191246135296 [0;39m <==    Updates: 0
2021-08-26 07:45:10.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882191246135296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:45:15.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882212192489472 [0;39m 生成今日电子书快照开始
2021-08-26 07:45:15.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882212192489472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:45:15.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882212192489472 [0;39m ==> Parameters: 
2021-08-26 07:45:15.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882212192489472 [0;39m <==    Updates: 0
2021-08-26 07:45:15.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882212192489472 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:45:20.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882233164009472 [0;39m 生成今日电子书快照开始
2021-08-26 07:45:20.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882233164009472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:45:20.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882233164009472 [0;39m ==> Parameters: 
2021-08-26 07:45:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882233164009472 [0;39m <==    Updates: 0
2021-08-26 07:45:20.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882233164009472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:45:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882254173278208 [0;39m 生成今日电子书快照开始
2021-08-26 07:45:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882254173278208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:45:25.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882254173278208 [0;39m ==> Parameters: 
2021-08-26 07:45:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882254173278208 [0;39m <==    Updates: 0
2021-08-26 07:45:25.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882254173278208 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:45:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882275128020992 [0;39m 生成今日电子书快照开始
2021-08-26 07:45:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882275128020992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:45:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882275128020992 [0;39m ==> Parameters: 
2021-08-26 07:45:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882275128020992 [0;39m <==    Updates: 0
2021-08-26 07:45:30.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882275128020992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:45:35.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882296103735296 [0;39m 生成今日电子书快照开始
2021-08-26 07:45:35.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882296103735296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:45:35.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882296103735296 [0;39m ==> Parameters: 
2021-08-26 07:45:35.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882296103735296 [0;39m <==    Updates: 0
2021-08-26 07:45:35.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882296103735296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:45:35.009 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85882296112123904 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:45:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882296112123904 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:45:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882296112123904 [0;39m ==> Parameters: 
2021-08-26 07:45:35.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882296112123904 [0;39m <==    Updates: 5
2021-08-26 07:45:35.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85882296112123904 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:45:40.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882317083643904 [0;39m 生成今日电子书快照开始
2021-08-26 07:45:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882317083643904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:45:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882317083643904 [0;39m ==> Parameters: 
2021-08-26 07:45:40.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882317083643904 [0;39m <==    Updates: 0
2021-08-26 07:45:40.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882317083643904 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:45:45.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882338071941120 [0;39m 生成今日电子书快照开始
2021-08-26 07:45:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882338071941120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:45:45.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882338071941120 [0;39m ==> Parameters: 
2021-08-26 07:45:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882338071941120 [0;39m <==    Updates: 0
2021-08-26 07:45:45.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882338071941120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:45:50.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882359043461120 [0;39m 生成今日电子书快照开始
2021-08-26 07:45:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882359043461120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:45:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882359043461120 [0;39m ==> Parameters: 
2021-08-26 07:45:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882359043461120 [0;39m <==    Updates: 0
2021-08-26 07:45:50.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882359043461120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:45:55.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882380014981120 [0;39m 生成今日电子书快照开始
2021-08-26 07:45:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882380014981120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:45:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882380014981120 [0;39m ==> Parameters: 
2021-08-26 07:45:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882380014981120 [0;39m <==    Updates: 0
2021-08-26 07:45:55.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882380014981120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:46:00.000 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882400931975168 [0;39m 生成今日电子书快照开始
2021-08-26 07:46:00.000 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882400931975168 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:46:00.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882400931975168 [0;39m ==> Parameters: 
2021-08-26 07:46:00.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882400931975168 [0;39m <==    Updates: 0
2021-08-26 07:46:00.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882400931975168 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:46:05.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85882421953826816 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:46:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882421953826816 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:46:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882421953826816 [0;39m ==> Parameters: 
2021-08-26 07:46:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882421953826816 [0;39m <==    Updates: 5
2021-08-26 07:46:05.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85882421953826816 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:46:05.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882421958021120 [0;39m 生成今日电子书快照开始
2021-08-26 07:46:05.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882421958021120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:46:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882421958021120 [0;39m ==> Parameters: 
2021-08-26 07:46:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882421958021120 [0;39m <==    Updates: 0
2021-08-26 07:46:05.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882421958021120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:46:10.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882442895986688 [0;39m 生成今日电子书快照开始
2021-08-26 07:46:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882442895986688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:46:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882442895986688 [0;39m ==> Parameters: 
2021-08-26 07:46:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882442895986688 [0;39m <==    Updates: 0
2021-08-26 07:46:10.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882442895986688 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:46:15.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882463892672512 [0;39m 生成今日电子书快照开始
2021-08-26 07:46:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882463892672512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:46:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882463892672512 [0;39m ==> Parameters: 
2021-08-26 07:46:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882463892672512 [0;39m <==    Updates: 0
2021-08-26 07:46:15.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882463892672512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:46:20.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882484855803904 [0;39m 生成今日电子书快照开始
2021-08-26 07:46:20.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882484855803904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:46:20.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882484855803904 [0;39m ==> Parameters: 
2021-08-26 07:46:20.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882484855803904 [0;39m <==    Updates: 0
2021-08-26 07:46:20.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882484855803904 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:46:25.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882505839906816 [0;39m 生成今日电子书快照开始
2021-08-26 07:46:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882505839906816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:46:25.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882505839906816 [0;39m ==> Parameters: 
2021-08-26 07:46:25.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882505839906816 [0;39m <==    Updates: 0
2021-08-26 07:46:25.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882505839906816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:46:30.000 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882526761095168 [0;39m 生成今日电子书快照开始
2021-08-26 07:46:30.000 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882526761095168 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:46:30.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882526761095168 [0;39m ==> Parameters: 
2021-08-26 07:46:30.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882526761095168 [0;39m <==    Updates: 0
2021-08-26 07:46:30.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882526761095168 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:46:35.001 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85882547736809472 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:46:35.001 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882547736809472 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:46:35.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882547736809472 [0;39m ==> Parameters: 
2021-08-26 07:46:35.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882547736809472 [0;39m <==    Updates: 5
2021-08-26 07:46:35.002 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85882547736809472 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:46:35.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882547745198080 [0;39m 生成今日电子书快照开始
2021-08-26 07:46:35.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882547745198080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:46:35.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882547745198080 [0;39m ==> Parameters: 
2021-08-26 07:46:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882547745198080 [0;39m <==    Updates: 0
2021-08-26 07:46:35.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882547745198080 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:46:40.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882568741883904 [0;39m 生成今日电子书快照开始
2021-08-26 07:46:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882568741883904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:46:40.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882568741883904 [0;39m ==> Parameters: 
2021-08-26 07:46:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882568741883904 [0;39m <==    Updates: 0
2021-08-26 07:46:40.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882568741883904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:46:45.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882589725986816 [0;39m 生成今日电子书快照开始
2021-08-26 07:46:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882589725986816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:46:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882589725986816 [0;39m ==> Parameters: 
2021-08-26 07:46:45.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882589725986816 [0;39m <==    Updates: 0
2021-08-26 07:46:45.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882589725986816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:46:50.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882610693312512 [0;39m 生成今日电子书快照开始
2021-08-26 07:46:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882610693312512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:46:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882610693312512 [0;39m ==> Parameters: 
2021-08-26 07:46:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882610693312512 [0;39m <==    Updates: 0
2021-08-26 07:46:50.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882610693312512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:46:55.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882631673221120 [0;39m 生成今日电子书快照开始
2021-08-26 07:46:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882631673221120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:46:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882631673221120 [0;39m ==> Parameters: 
2021-08-26 07:46:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882631673221120 [0;39m <==    Updates: 0
2021-08-26 07:46:55.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882631673221120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:47:00.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882652636352512 [0;39m 生成今日电子书快照开始
2021-08-26 07:47:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882652636352512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:47:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882652636352512 [0;39m ==> Parameters: 
2021-08-26 07:47:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882652636352512 [0;39m <==    Updates: 0
2021-08-26 07:47:00.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882652636352512 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:47:05.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85882673578512384 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:47:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882673578512384 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:47:05.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882673578512384 [0;39m ==> Parameters: 
2021-08-26 07:47:05.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882673578512384 [0;39m <==    Updates: 5
2021-08-26 07:47:05.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85882673578512384 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:47:05.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882673586900992 [0;39m 生成今日电子书快照开始
2021-08-26 07:47:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882673586900992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:47:05.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882673586900992 [0;39m ==> Parameters: 
2021-08-26 07:47:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882673586900992 [0;39m <==    Updates: 0
2021-08-26 07:47:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882673586900992 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:47:10.000 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882694533255168 [0;39m 生成今日电子书快照开始
2021-08-26 07:47:10.000 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882694533255168 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:47:10.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882694533255168 [0;39m ==> Parameters: 
2021-08-26 07:47:10.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882694533255168 [0;39m <==    Updates: 0
2021-08-26 07:47:10.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882694533255168 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:47:15.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882715538329600 [0;39m 生成今日电子书快照开始
2021-08-26 07:47:15.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882715538329600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:47:15.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882715538329600 [0;39m ==> Parameters: 
2021-08-26 07:47:15.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882715538329600 [0;39m <==    Updates: 0
2021-08-26 07:47:15.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882715538329600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:47:20.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882736501460992 [0;39m 生成今日电子书快照开始
2021-08-26 07:47:20.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882736501460992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:47:20.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882736501460992 [0;39m ==> Parameters: 
2021-08-26 07:47:20.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882736501460992 [0;39m <==    Updates: 0
2021-08-26 07:47:20.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882736501460992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:47:25.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882757481369600 [0;39m 生成今日电子书快照开始
2021-08-26 07:47:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882757481369600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:47:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882757481369600 [0;39m ==> Parameters: 
2021-08-26 07:47:25.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882757481369600 [0;39m <==    Updates: 0
2021-08-26 07:47:25.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882757481369600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:47:30.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882778423529472 [0;39m 生成今日电子书快照开始
2021-08-26 07:47:30.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882778423529472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:47:30.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882778423529472 [0;39m ==> Parameters: 
2021-08-26 07:47:30.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882778423529472 [0;39m <==    Updates: 0
2021-08-26 07:47:30.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882778423529472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:47:35.002 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85882799399243776 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:47:35.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882799399243776 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:47:35.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882799399243776 [0;39m ==> Parameters: 
2021-08-26 07:47:35.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882799399243776 [0;39m <==    Updates: 5
2021-08-26 07:47:35.003 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85882799399243776 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:47:35.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882799403438080 [0;39m 生成今日电子书快照开始
2021-08-26 07:47:35.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882799403438080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:47:35.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882799403438080 [0;39m ==> Parameters: 
2021-08-26 07:47:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882799403438080 [0;39m <==    Updates: 0
2021-08-26 07:47:35.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882799403438080 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:47:40.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882820408512512 [0;39m 生成今日电子书快照开始
2021-08-26 07:47:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882820408512512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:47:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882820408512512 [0;39m ==> Parameters: 
2021-08-26 07:47:40.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882820408512512 [0;39m <==    Updates: 0
2021-08-26 07:47:40.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882820408512512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:47:45.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882841375838208 [0;39m 生成今日电子书快照开始
2021-08-26 07:47:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882841375838208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:47:45.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882841375838208 [0;39m ==> Parameters: 
2021-08-26 07:47:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882841375838208 [0;39m <==    Updates: 0
2021-08-26 07:47:45.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882841375838208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:47:50.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882862334775296 [0;39m 生成今日电子书快照开始
2021-08-26 07:47:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882862334775296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:47:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882862334775296 [0;39m ==> Parameters: 
2021-08-26 07:47:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882862334775296 [0;39m <==    Updates: 0
2021-08-26 07:47:50.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882862334775296 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:47:55.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882883306295296 [0;39m 生成今日电子书快照开始
2021-08-26 07:47:55.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882883306295296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:47:55.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882883306295296 [0;39m ==> Parameters: 
2021-08-26 07:47:55.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882883306295296 [0;39m <==    Updates: 0
2021-08-26 07:47:55.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882883306295296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:48:00.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882904261038080 [0;39m 生成今日电子书快照开始
2021-08-26 07:48:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882904261038080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:48:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882904261038080 [0;39m ==> Parameters: 
2021-08-26 07:48:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882904261038080 [0;39m <==    Updates: 0
2021-08-26 07:48:00.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882904261038080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:48:05.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85882925266112512 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:48:05.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882925266112512 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:48:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882925266112512 [0;39m ==> Parameters: 
2021-08-26 07:48:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85882925266112512 [0;39m <==    Updates: 5
2021-08-26 07:48:05.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85882925266112512 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:48:05.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882925270306816 [0;39m 生成今日电子书快照开始
2021-08-26 07:48:05.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882925270306816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:48:05.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882925270306816 [0;39m ==> Parameters: 
2021-08-26 07:48:05.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882925270306816 [0;39m <==    Updates: 0
2021-08-26 07:48:05.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882925270306816 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:48:10.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882946254409728 [0;39m 生成今日电子书快照开始
2021-08-26 07:48:10.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882946254409728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:48:10.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882946254409728 [0;39m ==> Parameters: 
2021-08-26 07:48:10.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882946254409728 [0;39m <==    Updates: 0
2021-08-26 07:48:10.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882946254409728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:48:15.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882967225929728 [0;39m 生成今日电子书快照开始
2021-08-26 07:48:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882967225929728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:48:15.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882967225929728 [0;39m ==> Parameters: 
2021-08-26 07:48:15.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882967225929728 [0;39m <==    Updates: 0
2021-08-26 07:48:15.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882967225929728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:48:20.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85882988197449728 [0;39m 生成今日电子书快照开始
2021-08-26 07:48:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882988197449728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:48:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882988197449728 [0;39m ==> Parameters: 
2021-08-26 07:48:20.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85882988197449728 [0;39m <==    Updates: 0
2021-08-26 07:48:20.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85882988197449728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:48:25.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883009114443776 [0;39m 生成今日电子书快照开始
2021-08-26 07:48:25.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883009114443776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:48:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883009114443776 [0;39m ==> Parameters: 
2021-08-26 07:48:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883009114443776 [0;39m <==    Updates: 0
2021-08-26 07:48:25.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883009114443776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:48:30.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883030090158080 [0;39m 生成今日电子书快照开始
2021-08-26 07:48:30.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883030090158080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:48:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883030090158080 [0;39m ==> Parameters: 
2021-08-26 07:48:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883030090158080 [0;39m <==    Updates: 0
2021-08-26 07:48:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883030090158080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:48:35.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883051065872384 [0;39m 生成今日电子书快照开始
2021-08-26 07:48:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883051065872384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:48:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883051065872384 [0;39m ==> Parameters: 
2021-08-26 07:48:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883051065872384 [0;39m <==    Updates: 0
2021-08-26 07:48:35.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883051065872384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:48:35.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85883051074260992 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:48:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883051074260992 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:48:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883051074260992 [0;39m ==> Parameters: 
2021-08-26 07:48:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883051074260992 [0;39m <==    Updates: 5
2021-08-26 07:48:35.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85883051074260992 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:48:40.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883072024809472 [0;39m 生成今日电子书快照开始
2021-08-26 07:48:40.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883072024809472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:48:40.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883072024809472 [0;39m ==> Parameters: 
2021-08-26 07:48:40.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883072024809472 [0;39m <==    Updates: 0
2021-08-26 07:48:40.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883072024809472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:48:45.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883093008912384 [0;39m 生成今日电子书快照开始
2021-08-26 07:48:45.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883093008912384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:48:45.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883093008912384 [0;39m ==> Parameters: 
2021-08-26 07:48:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883093008912384 [0;39m <==    Updates: 0
2021-08-26 07:48:45.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883093008912384 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:48:50.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883114022375424 [0;39m 生成今日电子书快照开始
2021-08-26 07:48:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883114022375424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:48:50.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883114022375424 [0;39m ==> Parameters: 
2021-08-26 07:48:50.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883114022375424 [0;39m <==    Updates: 0
2021-08-26 07:48:50.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883114022375424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:48:55.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883134981312512 [0;39m 生成今日电子书快照开始
2021-08-26 07:48:55.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883134981312512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:48:55.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883134981312512 [0;39m ==> Parameters: 
2021-08-26 07:48:55.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883134981312512 [0;39m <==    Updates: 0
2021-08-26 07:48:55.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883134981312512 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:49:00.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883155948638208 [0;39m 生成今日电子书快照开始
2021-08-26 07:49:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883155948638208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:49:00.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883155948638208 [0;39m ==> Parameters: 
2021-08-26 07:49:00.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883155948638208 [0;39m <==    Updates: 0
2021-08-26 07:49:00.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883155948638208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:49:05.003 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85883176890798080 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:49:05.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883176890798080 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:49:05.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883176890798080 [0;39m ==> Parameters: 
2021-08-26 07:49:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883176890798080 [0;39m <==    Updates: 5
2021-08-26 07:49:05.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85883176890798080 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:49:05.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883176894992384 [0;39m 生成今日电子书快照开始
2021-08-26 07:49:05.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883176894992384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:49:05.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883176894992384 [0;39m ==> Parameters: 
2021-08-26 07:49:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883176894992384 [0;39m <==    Updates: 0
2021-08-26 07:49:05.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883176894992384 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:49:10.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883197900066816 [0;39m 生成今日电子书快照开始
2021-08-26 07:49:10.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883197900066816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:49:10.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883197900066816 [0;39m ==> Parameters: 
2021-08-26 07:49:10.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883197900066816 [0;39m <==    Updates: 0
2021-08-26 07:49:10.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883197900066816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:49:15.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883218833838080 [0;39m 生成今日电子书快照开始
2021-08-26 07:49:15.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883218833838080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:49:15.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883218833838080 [0;39m ==> Parameters: 
2021-08-26 07:49:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883218833838080 [0;39m <==    Updates: 0
2021-08-26 07:49:15.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883218833838080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:49:20.000 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883239792775168 [0;39m 生成今日电子书快照开始
2021-08-26 07:49:20.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883239792775168 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:49:20.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883239792775168 [0;39m ==> Parameters: 
2021-08-26 07:49:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883239792775168 [0;39m <==    Updates: 0
2021-08-26 07:49:20.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883239792775168 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:49:25.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883260810432512 [0;39m 生成今日电子书快照开始
2021-08-26 07:49:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883260810432512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:49:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883260810432512 [0;39m ==> Parameters: 
2021-08-26 07:49:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883260810432512 [0;39m <==    Updates: 0
2021-08-26 07:49:25.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883260810432512 [0;39m 生成今日电子书快照结束，耗时：0毫秒
2021-08-26 07:49:30.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883281752592384 [0;39m 生成今日电子书快照开始
2021-08-26 07:49:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883281752592384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:49:30.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883281752592384 [0;39m ==> Parameters: 
2021-08-26 07:49:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883281752592384 [0;39m <==    Updates: 0
2021-08-26 07:49:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883281752592384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:49:35.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883302745083904 [0;39m 生成今日电子书快照开始
2021-08-26 07:49:35.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883302745083904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:49:35.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883302745083904 [0;39m ==> Parameters: 
2021-08-26 07:49:35.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883302745083904 [0;39m <==    Updates: 0
2021-08-26 07:49:35.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883302745083904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:49:35.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85883302753472512 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:49:35.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883302753472512 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:49:35.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883302753472512 [0;39m ==> Parameters: 
2021-08-26 07:49:35.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883302753472512 [0;39m <==    Updates: 5
2021-08-26 07:49:35.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85883302753472512 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:49:40.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883323687243776 [0;39m 生成今日电子书快照开始
2021-08-26 07:49:40.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883323687243776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:49:40.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883323687243776 [0;39m ==> Parameters: 
2021-08-26 07:49:40.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883323687243776 [0;39m <==    Updates: 0
2021-08-26 07:49:40.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883323687243776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:49:45.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883344704901120 [0;39m 生成今日电子书快照开始
2021-08-26 07:49:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883344704901120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:49:45.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883344704901120 [0;39m ==> Parameters: 
2021-08-26 07:49:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883344704901120 [0;39m <==    Updates: 0
2021-08-26 07:49:45.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883344704901120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:49:50.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883365626089472 [0;39m 生成今日电子书快照开始
2021-08-26 07:49:50.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883365626089472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:49:50.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883365626089472 [0;39m ==> Parameters: 
2021-08-26 07:49:50.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883365626089472 [0;39m <==    Updates: 0
2021-08-26 07:49:50.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883365626089472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:49:55.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883386597609472 [0;39m 生成今日电子书快照开始
2021-08-26 07:49:55.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883386597609472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:49:55.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883386597609472 [0;39m ==> Parameters: 
2021-08-26 07:49:55.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883386597609472 [0;39m <==    Updates: 0
2021-08-26 07:49:55.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883386597609472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:49:58.939 INFO  com.haoyu.knowlagebase.websocket.WebSocketServer  :42   [32m                  [0;39m 连接关闭，token：bqB256VD9l，session id：2！当前连接数：0
2021-08-26 07:49:59.652 INFO  com.haoyu.knowlagebase.websocket.WebSocketServer  :33   [32m                  [0;39m 有新连接：token：uaXAHN4R9E，session id：3，当前连接数：1
2021-08-26 07:49:59.732 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85883406440861696 [0;39m ------------- 开始 -------------
2021-08-26 07:49:59.733 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85883406440861696 [0;39m 请求地址: http://127.0.0.1:8880/ebook-snapshot/get-statistic GET
2021-08-26 07:49:59.733 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85883406440861696 [0;39m 类名方法: com.haoyu.knowlagebase.controller.EbookSnapshotController.getStatistic
2021-08-26 07:49:59.733 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85883406440861696 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:49:59.733 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85883406440861696 [0;39m 请求参数: []
2021-08-26 07:49:59.733 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85883406440861696 [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-08-26 07:49:59.734 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85883406440861696 [0;39m ==> Parameters: 
2021-08-26 07:49:59.735 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85883406440861696 [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-08-26 07:49:59.735 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85883406440861696 [0;39m <==        Row: 2021-08-26, 62, 19, 62, 19
2021-08-26 07:49:59.736 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85883406440861696 [0;39m <==      Total: 1
2021-08-26 07:49:59.736 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85883406440861696 [0;39m 返回结果: {"content":[{"date":1629907200000,"viewCount":62,"viewIncrease":62,"voteCount":19,"voteIncrease":19}],"success":true}
2021-08-26 07:49:59.736 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85883406440861696 [0;39m ------------- 结束 耗时：4 ms -------------
2021-08-26 07:49:59.800 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85883406726074368 [0;39m ------------- 开始 -------------
2021-08-26 07:49:59.800 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85883406726074368 [0;39m 请求地址: http://127.0.0.1:8880/category/all GET
2021-08-26 07:49:59.801 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85883406726074368 [0;39m 类名方法: com.haoyu.knowlagebase.controller.CategoryController.all
2021-08-26 07:49:59.801 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85883406726074368 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:49:59.801 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85883406726074368 [0;39m 请求参数: []
2021-08-26 07:49:59.802 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85883406726074368 [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-08-26 07:49:59.802 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85883406726074368 [0;39m ==> Parameters: 
2021-08-26 07:49:59.803 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==    Columns: id, parent, name, sort
2021-08-26 07:49:59.803 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 82110017238601728, 100, test2, 1
2021-08-26 07:49:59.803 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 100, 0, 前端开发, 100
2021-08-26 07:49:59.804 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 101, 100, Vue, 101
2021-08-26 07:49:59.804 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 102, 100, HTML & CSS, 102
2021-08-26 07:49:59.805 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 200, 0, Java, 200
2021-08-26 07:49:59.805 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 201, 200, 基础应用, 201
2021-08-26 07:49:59.805 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 202, 200, 框架应用, 202
2021-08-26 07:49:59.805 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 300, 0, Python, 300
2021-08-26 07:49:59.806 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 301, 300, 基础应用, 301
2021-08-26 07:49:59.806 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 302, 300, 进阶方向应用, 302
2021-08-26 07:49:59.806 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 400, 0, 数据库, 400
2021-08-26 07:49:59.806 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 401, 400, MySQL, 401
2021-08-26 07:49:59.806 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 500, 0, 其它, 500
2021-08-26 07:49:59.807 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 501, 500, 服务器, 501
2021-08-26 07:49:59.807 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 502, 500, 开发工具, 502
2021-08-26 07:49:59.807 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883406726074368 [0;39m <==        Row: 503, 500, 热门服务端语言, 503
2021-08-26 07:49:59.808 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85883406726074368 [0;39m <==      Total: 16
2021-08-26 07:49:59.809 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85883406726074368 [0;39m 返回结果: {"content":[{"id":82110017238601728,"name":"test2","parent":100,"sort":1},{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"基础应用","parent":300,"sort":301},{"id":302,"name":"进阶方向应用","parent":300,"sort":302},{"id":400,"name":"数据库","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":500,"name":"其它","parent":0,"sort":500},{"id":501,"name":"服务器","parent":500,"sort":501},{"id":502,"name":"开发工具","parent":500,"sort":502},{"id":503,"name":"热门服务端语言","parent":500,"sort":503}],"success":true}
2021-08-26 07:49:59.810 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85883406726074368 [0;39m ------------- 结束 耗时：10 ms -------------
2021-08-26 07:50:00.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883407598489600 [0;39m 生成今日电子书快照开始
2021-08-26 07:50:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883407598489600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:50:00.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883407598489600 [0;39m ==> Parameters: 
2021-08-26 07:50:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883407598489600 [0;39m <==    Updates: 0
2021-08-26 07:50:00.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883407598489600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:50:05.002 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85883428544843776 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:50:05.002 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883428544843776 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:50:05.003 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883428544843776 [0;39m ==> Parameters: 
2021-08-26 07:50:05.004 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883428544843776 [0;39m <==    Updates: 5
2021-08-26 07:50:05.004 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85883428544843776 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:50:05.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883428553232384 [0;39m 生成今日电子书快照开始
2021-08-26 07:50:05.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883428553232384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:50:05.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883428553232384 [0;39m ==> Parameters: 
2021-08-26 07:50:05.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883428553232384 [0;39m <==    Updates: 0
2021-08-26 07:50:05.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883428553232384 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:50:10.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883449575084032 [0;39m 生成今日电子书快照开始
2021-08-26 07:50:10.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883449575084032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:50:10.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883449575084032 [0;39m ==> Parameters: 
2021-08-26 07:50:10.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883449575084032 [0;39m <==    Updates: 0
2021-08-26 07:50:10.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883449575084032 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:50:15.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883470517243904 [0;39m 生成今日电子书快照开始
2021-08-26 07:50:15.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883470517243904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:50:15.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883470517243904 [0;39m ==> Parameters: 
2021-08-26 07:50:15.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883470517243904 [0;39m <==    Updates: 0
2021-08-26 07:50:15.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883470517243904 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:50:20.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883491501346816 [0;39m 生成今日电子书快照开始
2021-08-26 07:50:20.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883491501346816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:50:20.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883491501346816 [0;39m ==> Parameters: 
2021-08-26 07:50:20.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883491501346816 [0;39m <==    Updates: 0
2021-08-26 07:50:20.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883491501346816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:50:25.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883512447700992 [0;39m 生成今日电子书快照开始
2021-08-26 07:50:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883512447700992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:50:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883512447700992 [0;39m ==> Parameters: 
2021-08-26 07:50:25.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883512447700992 [0;39m <==    Updates: 0
2021-08-26 07:50:25.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883512447700992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:50:30.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883533419220992 [0;39m 生成今日电子书快照开始
2021-08-26 07:50:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883533419220992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:50:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883533419220992 [0;39m ==> Parameters: 
2021-08-26 07:50:30.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883533419220992 [0;39m <==    Updates: 0
2021-08-26 07:50:30.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883533419220992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:50:35.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883554369769472 [0;39m 生成今日电子书快照开始
2021-08-26 07:50:35.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883554369769472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:50:35.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883554369769472 [0;39m ==> Parameters: 
2021-08-26 07:50:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883554369769472 [0;39m <==    Updates: 0
2021-08-26 07:50:35.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883554369769472 [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-08-26 07:50:35.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85883554386546688 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:50:35.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883554386546688 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:50:35.005 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883554386546688 [0;39m ==> Parameters: 
2021-08-26 07:50:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883554386546688 [0;39m <==    Updates: 5
2021-08-26 07:50:35.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85883554386546688 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:50:40.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883575370649600 [0;39m 生成今日电子书快照开始
2021-08-26 07:50:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883575370649600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:50:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883575370649600 [0;39m ==> Parameters: 
2021-08-26 07:50:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883575370649600 [0;39m <==    Updates: 0
2021-08-26 07:50:40.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883575370649600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:50:45.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883596363141120 [0;39m 生成今日电子书快照开始
2021-08-26 07:50:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883596363141120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:50:45.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883596363141120 [0;39m ==> Parameters: 
2021-08-26 07:50:45.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883596363141120 [0;39m <==    Updates: 0
2021-08-26 07:50:45.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883596363141120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:50:50.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883617334661120 [0;39m 生成今日电子书快照开始
2021-08-26 07:50:50.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883617334661120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:50:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883617334661120 [0;39m ==> Parameters: 
2021-08-26 07:50:50.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883617334661120 [0;39m <==    Updates: 0
2021-08-26 07:50:50.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883617334661120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:50:55.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883638314569728 [0;39m 生成今日电子书快照开始
2021-08-26 07:50:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883638314569728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:50:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883638314569728 [0;39m ==> Parameters: 
2021-08-26 07:50:55.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883638314569728 [0;39m <==    Updates: 0
2021-08-26 07:50:55.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883638314569728 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:51:00.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883659256729600 [0;39m 生成今日电子书快照开始
2021-08-26 07:51:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883659256729600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:51:00.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883659256729600 [0;39m ==> Parameters: 
2021-08-26 07:51:00.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883659256729600 [0;39m <==    Updates: 0
2021-08-26 07:51:00.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883659256729600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:51:05.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883680219860992 [0;39m 生成今日电子书快照开始
2021-08-26 07:51:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883680219860992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:51:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883680219860992 [0;39m ==> Parameters: 
2021-08-26 07:51:05.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883680219860992 [0;39m <==    Updates: 0
2021-08-26 07:51:05.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883680219860992 [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-08-26 07:51:05.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85883680249221120 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:51:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883680249221120 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:51:05.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883680249221120 [0;39m ==> Parameters: 
2021-08-26 07:51:05.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883680249221120 [0;39m <==    Updates: 5
2021-08-26 07:51:05.016 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85883680249221120 [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-08-26 07:51:10.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883701182992384 [0;39m 生成今日电子书快照开始
2021-08-26 07:51:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883701182992384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:51:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883701182992384 [0;39m ==> Parameters: 
2021-08-26 07:51:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883701182992384 [0;39m <==    Updates: 0
2021-08-26 07:51:10.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883701182992384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:51:15.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883722188066816 [0;39m 生成今日电子书快照开始
2021-08-26 07:51:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883722188066816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:51:15.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883722188066816 [0;39m ==> Parameters: 
2021-08-26 07:51:15.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883722188066816 [0;39m <==    Updates: 0
2021-08-26 07:51:15.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883722188066816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:51:20.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883743113449472 [0;39m 生成今日电子书快照开始
2021-08-26 07:51:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883743113449472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:51:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883743113449472 [0;39m ==> Parameters: 
2021-08-26 07:51:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883743113449472 [0;39m <==    Updates: 0
2021-08-26 07:51:20.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883743113449472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:51:25.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883764093358080 [0;39m 生成今日电子书快照开始
2021-08-26 07:51:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883764093358080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:51:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883764093358080 [0;39m ==> Parameters: 
2021-08-26 07:51:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883764093358080 [0;39m <==    Updates: 0
2021-08-26 07:51:25.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883764093358080 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:51:30.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883785098432512 [0;39m 生成今日电子书快照开始
2021-08-26 07:51:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883785098432512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:51:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883785098432512 [0;39m ==> Parameters: 
2021-08-26 07:51:30.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883785098432512 [0;39m <==    Updates: 0
2021-08-26 07:51:30.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883785098432512 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:51:35.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883806053175296 [0;39m 生成今日电子书快照开始
2021-08-26 07:51:35.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883806053175296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:51:35.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883806053175296 [0;39m ==> Parameters: 
2021-08-26 07:51:35.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883806053175296 [0;39m <==    Updates: 0
2021-08-26 07:51:35.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883806053175296 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:51:35.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85883806057369600 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:51:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883806057369600 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:51:35.009 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883806057369600 [0;39m ==> Parameters: 
2021-08-26 07:51:35.010 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883806057369600 [0;39m <==    Updates: 5
2021-08-26 07:51:35.010 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85883806057369600 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:51:40.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883827066638336 [0;39m 生成今日电子书快照开始
2021-08-26 07:51:40.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883827066638336 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:51:40.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883827066638336 [0;39m ==> Parameters: 
2021-08-26 07:51:40.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883827066638336 [0;39m <==    Updates: 0
2021-08-26 07:51:40.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883827066638336 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:51:45.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883848000409600 [0;39m 生成今日电子书快照开始
2021-08-26 07:51:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883848000409600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:51:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883848000409600 [0;39m ==> Parameters: 
2021-08-26 07:51:45.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883848000409600 [0;39m <==    Updates: 0
2021-08-26 07:51:45.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883848000409600 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:51:50.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883868967735296 [0;39m 生成今日电子书快照开始
2021-08-26 07:51:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883868967735296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:51:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883868967735296 [0;39m ==> Parameters: 
2021-08-26 07:51:50.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883868967735296 [0;39m <==    Updates: 0
2021-08-26 07:51:50.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883868967735296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:51:55.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883889972809728 [0;39m 生成今日电子书快照开始
2021-08-26 07:51:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883889972809728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:51:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883889972809728 [0;39m ==> Parameters: 
2021-08-26 07:51:55.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883889972809728 [0;39m <==    Updates: 0
2021-08-26 07:51:55.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883889972809728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:51:55.781 INFO  com.haoyu.knowlagebase.websocket.WebSocketServer  :42   [32m                  [0;39m 连接关闭，token：uaXAHN4R9E，session id：3！当前连接数：0
2021-08-26 07:51:56.864 INFO  com.haoyu.knowlagebase.websocket.WebSocketServer  :33   [32m                  [0;39m 有新连接：token：wgVKp4Y1tK，session id：4，当前连接数：1
2021-08-26 07:51:56.940 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85883898046844928 [0;39m ------------- 开始 -------------
2021-08-26 07:51:56.940 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85883898046844928 [0;39m 请求地址: http://127.0.0.1:8880/ebook-snapshot/get-statistic GET
2021-08-26 07:51:56.940 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85883898046844928 [0;39m 类名方法: com.haoyu.knowlagebase.controller.EbookSnapshotController.getStatistic
2021-08-26 07:51:56.940 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85883898046844928 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:51:56.941 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85883898046844928 [0;39m 请求参数: []
2021-08-26 07:51:56.941 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85883898046844928 [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-08-26 07:51:56.941 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85883898046844928 [0;39m ==> Parameters: 
2021-08-26 07:51:56.942 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85883898046844928 [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-08-26 07:51:56.942 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85883898046844928 [0;39m <==        Row: 2021-08-26, 62, 19, 62, 19
2021-08-26 07:51:56.942 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85883898046844928 [0;39m <==      Total: 1
2021-08-26 07:51:56.943 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85883898046844928 [0;39m 返回结果: {"content":[{"date":1629907200000,"viewCount":62,"viewIncrease":62,"voteCount":19,"voteIncrease":19}],"success":true}
2021-08-26 07:51:56.943 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85883898046844928 [0;39m ------------- 结束 耗时：3 ms -------------
2021-08-26 07:51:56.989 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85883898252365824 [0;39m ------------- 开始 -------------
2021-08-26 07:51:56.989 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85883898252365824 [0;39m 请求地址: http://127.0.0.1:8880/category/all GET
2021-08-26 07:51:56.989 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85883898252365824 [0;39m 类名方法: com.haoyu.knowlagebase.controller.CategoryController.all
2021-08-26 07:51:56.989 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85883898252365824 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:51:56.989 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85883898252365824 [0;39m 请求参数: []
2021-08-26 07:51:56.990 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85883898252365824 [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-08-26 07:51:56.990 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85883898252365824 [0;39m ==> Parameters: 
2021-08-26 07:51:56.991 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==    Columns: id, parent, name, sort
2021-08-26 07:51:56.991 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 82110017238601728, 100, test2, 1
2021-08-26 07:51:56.992 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 100, 0, 前端开发, 100
2021-08-26 07:51:56.992 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 101, 100, Vue, 101
2021-08-26 07:51:56.992 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 102, 100, HTML & CSS, 102
2021-08-26 07:51:56.992 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 200, 0, Java, 200
2021-08-26 07:51:56.992 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 201, 200, 基础应用, 201
2021-08-26 07:51:56.992 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 202, 200, 框架应用, 202
2021-08-26 07:51:56.993 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 300, 0, Python, 300
2021-08-26 07:51:56.993 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 301, 300, 基础应用, 301
2021-08-26 07:51:56.993 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 302, 300, 进阶方向应用, 302
2021-08-26 07:51:56.993 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 400, 0, 数据库, 400
2021-08-26 07:51:56.993 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 401, 400, MySQL, 401
2021-08-26 07:51:56.993 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 500, 0, 其它, 500
2021-08-26 07:51:56.994 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 501, 500, 服务器, 501
2021-08-26 07:51:56.994 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 502, 500, 开发工具, 502
2021-08-26 07:51:56.994 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85883898252365824 [0;39m <==        Row: 503, 500, 热门服务端语言, 503
2021-08-26 07:51:56.994 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85883898252365824 [0;39m <==      Total: 16
2021-08-26 07:51:56.995 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85883898252365824 [0;39m 返回结果: {"content":[{"id":82110017238601728,"name":"test2","parent":100,"sort":1},{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"基础应用","parent":300,"sort":301},{"id":302,"name":"进阶方向应用","parent":300,"sort":302},{"id":400,"name":"数据库","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":500,"name":"其它","parent":0,"sort":500},{"id":501,"name":"服务器","parent":500,"sort":501},{"id":502,"name":"开发工具","parent":500,"sort":502},{"id":503,"name":"热门服务端语言","parent":500,"sort":503}],"success":true}
2021-08-26 07:51:56.996 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85883898252365824 [0;39m ------------- 结束 耗时：7 ms -------------
2021-08-26 07:52:00.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883910940135424 [0;39m 生成今日电子书快照开始
2021-08-26 07:52:00.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883910940135424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:52:00.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883910940135424 [0;39m ==> Parameters: 
2021-08-26 07:52:00.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883910940135424 [0;39m <==    Updates: 0
2021-08-26 07:52:00.019 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883910940135424 [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-08-26 07:52:05.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883931890683904 [0;39m 生成今日电子书快照开始
2021-08-26 07:52:05.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883931890683904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:52:05.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883931890683904 [0;39m ==> Parameters: 
2021-08-26 07:52:05.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883931890683904 [0;39m <==    Updates: 0
2021-08-26 07:52:05.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883931890683904 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:52:05.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85883931899072512 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:52:05.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883931899072512 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:52:05.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883931899072512 [0;39m ==> Parameters: 
2021-08-26 07:52:05.011 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85883931899072512 [0;39m <==    Updates: 5
2021-08-26 07:52:05.011 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85883931899072512 [0;39m 更新电子书下的文档数据结束，耗时：0毫秒
2021-08-26 07:52:10.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883952853815296 [0;39m 生成今日电子书快照开始
2021-08-26 07:52:10.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883952853815296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:52:10.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883952853815296 [0;39m ==> Parameters: 
2021-08-26 07:52:10.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883952853815296 [0;39m <==    Updates: 0
2021-08-26 07:52:10.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883952853815296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:52:15.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883973858889728 [0;39m 生成今日电子书快照开始
2021-08-26 07:52:15.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883973858889728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:52:15.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883973858889728 [0;39m ==> Parameters: 
2021-08-26 07:52:15.017 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883973858889728 [0;39m <==    Updates: 0
2021-08-26 07:52:15.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883973858889728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:52:20.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85883994775883776 [0;39m 生成今日电子书快照开始
2021-08-26 07:52:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883994775883776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:52:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883994775883776 [0;39m ==> Parameters: 
2021-08-26 07:52:20.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85883994775883776 [0;39m <==    Updates: 0
2021-08-26 07:52:20.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85883994775883776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:52:25.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884015785152512 [0;39m 生成今日电子书快照开始
2021-08-26 07:52:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884015785152512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:52:25.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884015785152512 [0;39m ==> Parameters: 
2021-08-26 07:52:25.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884015785152512 [0;39m <==    Updates: 0
2021-08-26 07:52:25.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884015785152512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:52:30.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884036756672512 [0;39m 生成今日电子书快照开始
2021-08-26 07:52:30.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884036756672512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:52:30.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884036756672512 [0;39m ==> Parameters: 
2021-08-26 07:52:30.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884036756672512 [0;39m <==    Updates: 0
2021-08-26 07:52:30.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884036756672512 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:52:35.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884057698832384 [0;39m 生成今日电子书快照开始
2021-08-26 07:52:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884057698832384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:52:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884057698832384 [0;39m ==> Parameters: 
2021-08-26 07:52:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884057698832384 [0;39m <==    Updates: 0
2021-08-26 07:52:35.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884057698832384 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:52:35.005 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85884057703026688 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:52:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884057703026688 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:52:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884057703026688 [0;39m ==> Parameters: 
2021-08-26 07:52:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884057703026688 [0;39m <==    Updates: 5
2021-08-26 07:52:35.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85884057703026688 [0;39m 更新电子书下的文档数据结束，耗时：0毫秒
2021-08-26 07:52:40.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884078682935296 [0;39m 生成今日电子书快照开始
2021-08-26 07:52:40.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884078682935296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:52:40.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884078682935296 [0;39m ==> Parameters: 
2021-08-26 07:52:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884078682935296 [0;39m <==    Updates: 0
2021-08-26 07:52:40.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884078682935296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:52:45.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884099650260992 [0;39m 生成今日电子书快照开始
2021-08-26 07:52:45.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884099650260992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:52:45.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884099650260992 [0;39m ==> Parameters: 
2021-08-26 07:52:45.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884099650260992 [0;39m <==    Updates: 0
2021-08-26 07:52:45.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884099650260992 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:52:50.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884120625975296 [0;39m 生成今日电子书快照开始
2021-08-26 07:52:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884120625975296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:52:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884120625975296 [0;39m ==> Parameters: 
2021-08-26 07:52:50.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884120625975296 [0;39m <==    Updates: 0
2021-08-26 07:52:50.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884120625975296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:52:55.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884141601689600 [0;39m 生成今日电子书快照开始
2021-08-26 07:52:55.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884141601689600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:52:55.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884141601689600 [0;39m ==> Parameters: 
2021-08-26 07:52:55.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884141601689600 [0;39m <==    Updates: 0
2021-08-26 07:52:55.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884141601689600 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:53:00.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884162552238080 [0;39m 生成今日电子书快照开始
2021-08-26 07:53:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884162552238080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:53:00.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884162552238080 [0;39m ==> Parameters: 
2021-08-26 07:53:00.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884162552238080 [0;39m <==    Updates: 0
2021-08-26 07:53:00.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884162552238080 [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-08-26 07:53:05.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884183553118208 [0;39m 生成今日电子书快照开始
2021-08-26 07:53:05.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884183553118208 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:53:05.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884183553118208 [0;39m ==> Parameters: 
2021-08-26 07:53:05.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884183553118208 [0;39m <==    Updates: 0
2021-08-26 07:53:05.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884183553118208 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:53:05.012 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85884183561506816 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:53:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884183561506816 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:53:05.012 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884183561506816 [0;39m ==> Parameters: 
2021-08-26 07:53:05.013 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884183561506816 [0;39m <==    Updates: 5
2021-08-26 07:53:05.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85884183561506816 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:53:10.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884204541415424 [0;39m 生成今日电子书快照开始
2021-08-26 07:53:10.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884204541415424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:53:10.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884204541415424 [0;39m ==> Parameters: 
2021-08-26 07:53:10.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884204541415424 [0;39m <==    Updates: 0
2021-08-26 07:53:10.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884204541415424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:53:15.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884225470992384 [0;39m 生成今日电子书快照开始
2021-08-26 07:53:15.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884225470992384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:53:15.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884225470992384 [0;39m ==> Parameters: 
2021-08-26 07:53:15.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884225470992384 [0;39m <==    Updates: 0
2021-08-26 07:53:15.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884225470992384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:53:20.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884246488649728 [0;39m 生成今日电子书快照开始
2021-08-26 07:53:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884246488649728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:53:20.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884246488649728 [0;39m ==> Parameters: 
2021-08-26 07:53:20.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884246488649728 [0;39m <==    Updates: 0
2021-08-26 07:53:20.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884246488649728 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:53:25.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884267405643776 [0;39m 生成今日电子书快照开始
2021-08-26 07:53:25.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884267405643776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:53:25.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884267405643776 [0;39m ==> Parameters: 
2021-08-26 07:53:25.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884267405643776 [0;39m <==    Updates: 0
2021-08-26 07:53:25.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884267405643776 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:53:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884288389746688 [0;39m 生成今日电子书快照开始
2021-08-26 07:53:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884288389746688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:53:30.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884288389746688 [0;39m ==> Parameters: 
2021-08-26 07:53:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884288389746688 [0;39m <==    Updates: 0
2021-08-26 07:53:30.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884288389746688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:53:35.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884309365460992 [0;39m 生成今日电子书快照开始
2021-08-26 07:53:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884309365460992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:53:35.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884309365460992 [0;39m ==> Parameters: 
2021-08-26 07:53:35.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884309365460992 [0;39m <==    Updates: 0
2021-08-26 07:53:35.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884309365460992 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:53:35.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85884309369655296 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:53:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884309369655296 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:53:35.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884309369655296 [0;39m ==> Parameters: 
2021-08-26 07:53:35.008 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884309369655296 [0;39m <==    Updates: 5
2021-08-26 07:53:35.008 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85884309369655296 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:53:40.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884330374729728 [0;39m 生成今日电子书快照开始
2021-08-26 07:53:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884330374729728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:53:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884330374729728 [0;39m ==> Parameters: 
2021-08-26 07:53:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884330374729728 [0;39m <==    Updates: 0
2021-08-26 07:53:40.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884330374729728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:53:45.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884351316889600 [0;39m 生成今日电子书快照开始
2021-08-26 07:53:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884351316889600 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:53:45.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884351316889600 [0;39m ==> Parameters: 
2021-08-26 07:53:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884351316889600 [0;39m <==    Updates: 0
2021-08-26 07:53:45.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884351316889600 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:53:50.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884372313575424 [0;39m 生成今日电子书快照开始
2021-08-26 07:53:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884372313575424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:53:50.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884372313575424 [0;39m ==> Parameters: 
2021-08-26 07:53:50.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884372313575424 [0;39m <==    Updates: 0
2021-08-26 07:53:50.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884372313575424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:53:55.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884393238958080 [0;39m 生成今日电子书快照开始
2021-08-26 07:53:55.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884393238958080 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:53:55.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884393238958080 [0;39m ==> Parameters: 
2021-08-26 07:53:55.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884393238958080 [0;39m <==    Updates: 0
2021-08-26 07:53:55.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884393238958080 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:54:00.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884414227255296 [0;39m 生成今日电子书快照开始
2021-08-26 07:54:00.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884414227255296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:54:00.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884414227255296 [0;39m ==> Parameters: 
2021-08-26 07:54:00.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884414227255296 [0;39m <==    Updates: 0
2021-08-26 07:54:00.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884414227255296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:54:05.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85884435194580992 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:54:05.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884435194580992 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:54:05.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884435194580992 [0;39m ==> Parameters: 
2021-08-26 07:54:05.007 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884435194580992 [0;39m <==    Updates: 5
2021-08-26 07:54:05.007 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85884435194580992 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:54:05.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884435198775296 [0;39m 生成今日电子书快照开始
2021-08-26 07:54:05.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884435198775296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:54:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884435198775296 [0;39m ==> Parameters: 
2021-08-26 07:54:05.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884435198775296 [0;39m <==    Updates: 0
2021-08-26 07:54:05.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884435198775296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:54:10.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884456145129472 [0;39m 生成今日电子书快照开始
2021-08-26 07:54:10.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884456145129472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:54:10.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884456145129472 [0;39m ==> Parameters: 
2021-08-26 07:54:10.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884456145129472 [0;39m <==    Updates: 0
2021-08-26 07:54:10.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884456145129472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:54:15.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884477141815296 [0;39m 生成今日电子书快照开始
2021-08-26 07:54:15.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884477141815296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:54:15.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884477141815296 [0;39m ==> Parameters: 
2021-08-26 07:54:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884477141815296 [0;39m <==    Updates: 0
2021-08-26 07:54:15.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884477141815296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:54:20.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884498104946688 [0;39m 生成今日电子书快照开始
2021-08-26 07:54:20.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884498104946688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:54:20.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884498104946688 [0;39m ==> Parameters: 
2021-08-26 07:54:20.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884498104946688 [0;39m <==    Updates: 0
2021-08-26 07:54:20.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884498104946688 [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-08-26 07:54:25.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884519072272384 [0;39m 生成今日电子书快照开始
2021-08-26 07:54:25.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884519072272384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:54:25.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884519072272384 [0;39m ==> Parameters: 
2021-08-26 07:54:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884519072272384 [0;39m <==    Updates: 0
2021-08-26 07:54:25.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884519072272384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:54:27.247 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85884528480096256 [0;39m ------------- 开始 -------------
2021-08-26 07:54:27.247 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85884528480096256 [0;39m 请求地址: http://127.0.0.1:8880/ebook-snapshot/get-statistic GET
2021-08-26 07:54:27.248 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85884528480096256 [0;39m 类名方法: com.haoyu.knowlagebase.controller.EbookSnapshotController.getStatistic
2021-08-26 07:54:27.248 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85884528480096256 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:54:27.248 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85884528480096256 [0;39m 请求参数: []
2021-08-26 07:54:27.249 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884528480096256 [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-08-26 07:54:27.250 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884528480096256 [0;39m ==> Parameters: 
2021-08-26 07:54:27.251 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85884528480096256 [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-08-26 07:54:27.251 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85884528480096256 [0;39m <==        Row: 2021-08-26, 62, 19, 62, 19
2021-08-26 07:54:27.252 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884528480096256 [0;39m <==      Total: 1
2021-08-26 07:54:27.252 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85884528480096256 [0;39m 返回结果: {"content":[{"date":1629907200000,"viewCount":62,"viewIncrease":62,"voteCount":19,"voteIncrease":19}],"success":true}
2021-08-26 07:54:27.252 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85884528480096256 [0;39m ------------- 结束 耗时：5 ms -------------
2021-08-26 07:54:27.278 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85884528610119680 [0;39m ------------- 开始 -------------
2021-08-26 07:54:27.278 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85884528610119680 [0;39m 请求地址: http://127.0.0.1:8880/ebook-snapshot/get-statistic GET
2021-08-26 07:54:27.278 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85884528610119680 [0;39m 类名方法: com.haoyu.knowlagebase.controller.EbookSnapshotController.getStatistic
2021-08-26 07:54:27.278 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85884528610119680 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:54:27.278 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85884528610119680 [0;39m 请求参数: []
2021-08-26 07:54:27.279 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884528610119680 [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-08-26 07:54:27.279 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884528610119680 [0;39m ==> Parameters: 
2021-08-26 07:54:27.280 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85884528610119680 [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-08-26 07:54:27.280 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85884528610119680 [0;39m <==        Row: 2021-08-26, 62, 19, 62, 19
2021-08-26 07:54:27.280 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884528610119680 [0;39m <==      Total: 1
2021-08-26 07:54:27.281 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85884528610119680 [0;39m 返回结果: {"content":[{"date":1629907200000,"viewCount":62,"viewIncrease":62,"voteCount":19,"voteIncrease":19}],"success":true}
2021-08-26 07:54:27.281 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85884528610119680 [0;39m ------------- 结束 耗时：3 ms -------------
2021-08-26 07:54:30.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884540047986688 [0;39m 生成今日电子书快照开始
2021-08-26 07:54:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884540047986688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:54:30.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884540047986688 [0;39m ==> Parameters: 
2021-08-26 07:54:30.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884540047986688 [0;39m <==    Updates: 0
2021-08-26 07:54:30.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884540047986688 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:54:35.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884561048866816 [0;39m 生成今日电子书快照开始
2021-08-26 07:54:35.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884561048866816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:54:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884561048866816 [0;39m ==> Parameters: 
2021-08-26 07:54:35.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884561048866816 [0;39m <==    Updates: 0
2021-08-26 07:54:35.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884561048866816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:54:35.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85884561057255424 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:54:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884561057255424 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:54:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884561057255424 [0;39m ==> Parameters: 
2021-08-26 07:54:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884561057255424 [0;39m <==    Updates: 5
2021-08-26 07:54:35.014 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85884561057255424 [0;39m 更新电子书下的文档数据结束，耗时：0毫秒
2021-08-26 07:54:40.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884582032969728 [0;39m 生成今日电子书快照开始
2021-08-26 07:54:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884582032969728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:54:40.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884582032969728 [0;39m ==> Parameters: 
2021-08-26 07:54:40.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884582032969728 [0;39m <==    Updates: 0
2021-08-26 07:54:40.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884582032969728 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:54:45.005 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884602962546688 [0;39m 生成今日电子书快照开始
2021-08-26 07:54:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884602962546688 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:54:45.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884602962546688 [0;39m ==> Parameters: 
2021-08-26 07:54:45.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884602962546688 [0;39m <==    Updates: 0
2021-08-26 07:54:45.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884602962546688 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:54:50.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884623980204032 [0;39m 生成今日电子书快照开始
2021-08-26 07:54:50.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884623980204032 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:54:50.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884623980204032 [0;39m ==> Parameters: 
2021-08-26 07:54:50.018 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884623980204032 [0;39m <==    Updates: 0
2021-08-26 07:54:50.018 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884623980204032 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:54:54.596 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85884643190116352 [0;39m ------------- 开始 -------------
2021-08-26 07:54:54.597 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85884643190116352 [0;39m 请求地址: http://127.0.0.1:8880/ebook-snapshot/get-statistic GET
2021-08-26 07:54:54.597 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85884643190116352 [0;39m 类名方法: com.haoyu.knowlagebase.controller.EbookSnapshotController.getStatistic
2021-08-26 07:54:54.597 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85884643190116352 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:54:54.597 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85884643190116352 [0;39m 请求参数: []
2021-08-26 07:54:54.598 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884643190116352 [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-08-26 07:54:54.598 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884643190116352 [0;39m ==> Parameters: 
2021-08-26 07:54:54.600 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85884643190116352 [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-08-26 07:54:54.600 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85884643190116352 [0;39m <==        Row: 2021-08-26, 62, 19, 62, 19
2021-08-26 07:54:54.600 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884643190116352 [0;39m <==      Total: 1
2021-08-26 07:54:54.601 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85884643190116352 [0;39m 返回结果: {"content":[{"date":1629907200000,"viewCount":62,"viewIncrease":62,"voteCount":19,"voteIncrease":19}],"success":true}
2021-08-26 07:54:54.601 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85884643190116352 [0;39m ------------- 结束 耗时：5 ms -------------
2021-08-26 07:54:55.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884644939141120 [0;39m 生成今日电子书快照开始
2021-08-26 07:54:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884644939141120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:54:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884644939141120 [0;39m ==> Parameters: 
2021-08-26 07:54:55.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884644939141120 [0;39m <==    Updates: 0
2021-08-26 07:54:55.017 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884644939141120 [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-08-26 07:55:00.002 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884665864523776 [0;39m 生成今日电子书快照开始
2021-08-26 07:55:00.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884665864523776 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:55:00.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884665864523776 [0;39m ==> Parameters: 
2021-08-26 07:55:00.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884665864523776 [0;39m <==    Updates: 0
2021-08-26 07:55:00.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884665864523776 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:55:05.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884686886375424 [0;39m 生成今日电子书快照开始
2021-08-26 07:55:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884686886375424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:55:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884686886375424 [0;39m ==> Parameters: 
2021-08-26 07:55:05.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884686886375424 [0;39m <==    Updates: 0
2021-08-26 07:55:05.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884686886375424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:55:05.016 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85884686894764032 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:55:05.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884686894764032 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:55:05.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884686894764032 [0;39m ==> Parameters: 
2021-08-26 07:55:05.017 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884686894764032 [0;39m <==    Updates: 5
2021-08-26 07:55:05.018 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85884686894764032 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:55:10.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884707815952384 [0;39m 生成今日电子书快照开始
2021-08-26 07:55:10.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884707815952384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:55:10.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884707815952384 [0;39m ==> Parameters: 
2021-08-26 07:55:10.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884707815952384 [0;39m <==    Updates: 0
2021-08-26 07:55:10.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884707815952384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:55:15.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884728821026816 [0;39m 生成今日电子书快照开始
2021-08-26 07:55:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884728821026816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:55:15.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884728821026816 [0;39m ==> Parameters: 
2021-08-26 07:55:15.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884728821026816 [0;39m <==    Updates: 0
2021-08-26 07:55:15.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884728821026816 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:55:20.001 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884749746409472 [0;39m 生成今日电子书快照开始
2021-08-26 07:55:20.001 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884749746409472 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:55:20.002 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884749746409472 [0;39m ==> Parameters: 
2021-08-26 07:55:20.003 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884749746409472 [0;39m <==    Updates: 0
2021-08-26 07:55:20.003 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884749746409472 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:55:25.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884770759872512 [0;39m 生成今日电子书快照开始
2021-08-26 07:55:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884770759872512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:55:25.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884770759872512 [0;39m ==> Parameters: 
2021-08-26 07:55:25.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884770759872512 [0;39m <==    Updates: 0
2021-08-26 07:55:25.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884770759872512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:55:30.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884791723003904 [0;39m 生成今日电子书快照开始
2021-08-26 07:55:30.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884791723003904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:55:30.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884791723003904 [0;39m ==> Parameters: 
2021-08-26 07:55:30.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884791723003904 [0;39m <==    Updates: 0
2021-08-26 07:55:30.010 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884791723003904 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:55:35.013 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85884812711301120 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:55:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884812711301120 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:55:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884812711301120 [0;39m ==> Parameters: 
2021-08-26 07:55:35.014 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884812711301120 [0;39m <==    Updates: 5
2021-08-26 07:55:35.015 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85884812711301120 [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-08-26 07:55:35.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884812719689728 [0;39m 生成今日电子书快照开始
2021-08-26 07:55:35.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884812719689728 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:55:35.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884812719689728 [0;39m ==> Parameters: 
2021-08-26 07:55:35.016 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884812719689728 [0;39m <==    Updates: 0
2021-08-26 07:55:35.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884812719689728 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:55:37.873 INFO  com.haoyu.knowlagebase.websocket.WebSocketServer  :33   [32m85883406726074368 [0;39m 有新连接：token：Uqg9clKtof，session id：5，当前连接数：2
2021-08-26 07:55:38.078 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85884825566842880 [0;39m ------------- 开始 -------------
2021-08-26 07:55:38.079 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85884825566842880 [0;39m 请求地址: http://127.0.0.1:8880/ebook-snapshot/get-statistic GET
2021-08-26 07:55:38.079 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85884825566842880 [0;39m 类名方法: com.haoyu.knowlagebase.controller.EbookSnapshotController.getStatistic
2021-08-26 07:55:38.079 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85884825566842880 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:55:38.079 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85884825566842880 [0;39m 请求参数: []
2021-08-26 07:55:38.079 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884825566842880 [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-08-26 07:55:38.080 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884825566842880 [0;39m ==> Parameters: 
2021-08-26 07:55:38.081 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85884825566842880 [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-08-26 07:55:38.081 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85884825566842880 [0;39m <==        Row: 2021-08-26, 62, 19, 62, 19
2021-08-26 07:55:38.081 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884825566842880 [0;39m <==      Total: 1
2021-08-26 07:55:38.082 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85884825566842880 [0;39m 返回结果: {"content":[{"date":1629907200000,"viewCount":62,"viewIncrease":62,"voteCount":19,"voteIncrease":19}],"success":true}
2021-08-26 07:55:38.082 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85884825566842880 [0;39m ------------- 结束 耗时：4 ms -------------
2021-08-26 07:55:38.133 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85884825797529600 [0;39m ------------- 开始 -------------
2021-08-26 07:55:38.133 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85884825797529600 [0;39m 请求地址: http://127.0.0.1:8880/category/all GET
2021-08-26 07:55:38.133 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85884825797529600 [0;39m 类名方法: com.haoyu.knowlagebase.controller.CategoryController.all
2021-08-26 07:55:38.134 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85884825797529600 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:55:38.134 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85884825797529600 [0;39m 请求参数: []
2021-08-26 07:55:38.134 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85884825797529600 [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-08-26 07:55:38.134 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85884825797529600 [0;39m ==> Parameters: 
2021-08-26 07:55:38.135 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==    Columns: id, parent, name, sort
2021-08-26 07:55:38.136 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 82110017238601728, 100, test2, 1
2021-08-26 07:55:38.136 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 100, 0, 前端开发, 100
2021-08-26 07:55:38.136 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 101, 100, Vue, 101
2021-08-26 07:55:38.136 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 102, 100, HTML & CSS, 102
2021-08-26 07:55:38.136 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 200, 0, Java, 200
2021-08-26 07:55:38.137 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 201, 200, 基础应用, 201
2021-08-26 07:55:38.137 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 202, 200, 框架应用, 202
2021-08-26 07:55:38.137 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 300, 0, Python, 300
2021-08-26 07:55:38.137 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 301, 300, 基础应用, 301
2021-08-26 07:55:38.137 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 302, 300, 进阶方向应用, 302
2021-08-26 07:55:38.138 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 400, 0, 数据库, 400
2021-08-26 07:55:38.138 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 401, 400, MySQL, 401
2021-08-26 07:55:38.138 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 500, 0, 其它, 500
2021-08-26 07:55:38.138 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 501, 500, 服务器, 501
2021-08-26 07:55:38.138 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 502, 500, 开发工具, 502
2021-08-26 07:55:38.139 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884825797529600 [0;39m <==        Row: 503, 500, 热门服务端语言, 503
2021-08-26 07:55:38.139 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85884825797529600 [0;39m <==      Total: 16
2021-08-26 07:55:38.140 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85884825797529600 [0;39m 返回结果: {"content":[{"id":82110017238601728,"name":"test2","parent":100,"sort":1},{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"基础应用","parent":300,"sort":301},{"id":302,"name":"进阶方向应用","parent":300,"sort":302},{"id":400,"name":"数据库","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":500,"name":"其它","parent":0,"sort":500},{"id":501,"name":"服务器","parent":500,"sort":501},{"id":502,"name":"开发工具","parent":500,"sort":502},{"id":503,"name":"热门服务端语言","parent":500,"sort":503}],"success":true}
2021-08-26 07:55:38.140 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85884825797529600 [0;39m ------------- 结束 耗时：7 ms -------------
2021-08-26 07:55:40.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884833657655296 [0;39m 生成今日电子书快照开始
2021-08-26 07:55:40.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884833657655296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:55:40.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884833657655296 [0;39m ==> Parameters: 
2021-08-26 07:55:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884833657655296 [0;39m <==    Updates: 0
2021-08-26 07:55:40.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884833657655296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:55:42.720 INFO  com.haoyu.knowlagebase.websocket.WebSocketServer  :42   [32m                  [0;39m 连接关闭，token：Uqg9clKtof，session id：5！当前连接数：1
2021-08-26 07:55:43.278 INFO  com.haoyu.knowlagebase.websocket.WebSocketServer  :33   [32m85883898046844928 [0;39m 有新连接：token：TWX6fpg7JW，session id：6，当前连接数：2
2021-08-26 07:55:43.396 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85884847872151552 [0;39m ------------- 开始 -------------
2021-08-26 07:55:43.396 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85884847872151552 [0;39m 请求地址: http://127.0.0.1:8880/ebook-snapshot/get-statistic GET
2021-08-26 07:55:43.397 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85884847872151552 [0;39m 类名方法: com.haoyu.knowlagebase.controller.EbookSnapshotController.getStatistic
2021-08-26 07:55:43.397 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85884847872151552 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:55:43.397 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85884847872151552 [0;39m 请求参数: []
2021-08-26 07:55:43.397 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884847872151552 [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-08-26 07:55:43.397 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884847872151552 [0;39m ==> Parameters: 
2021-08-26 07:55:43.398 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85884847872151552 [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-08-26 07:55:43.399 TRACE c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m85884847872151552 [0;39m <==        Row: 2021-08-26, 62, 19, 62, 19
2021-08-26 07:55:43.399 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m85884847872151552 [0;39m <==      Total: 1
2021-08-26 07:55:43.399 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85884847872151552 [0;39m 返回结果: {"content":[{"date":1629907200000,"viewCount":62,"viewIncrease":62,"voteCount":19,"voteIncrease":19}],"success":true}
2021-08-26 07:55:43.400 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85884847872151552 [0;39m ------------- 结束 耗时：4 ms -------------
2021-08-26 07:55:43.404 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :54   [32m85884847905705984 [0;39m ------------- 开始 -------------
2021-08-26 07:55:43.405 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :55   [32m85884847905705984 [0;39m 请求地址: http://127.0.0.1:8880/category/all GET
2021-08-26 07:55:43.405 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :56   [32m85884847905705984 [0;39m 类名方法: com.haoyu.knowlagebase.controller.CategoryController.all
2021-08-26 07:55:43.405 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :57   [32m85884847905705984 [0;39m 远程地址: 127.0.0.1
2021-08-26 07:55:43.405 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :79   [32m85884847905705984 [0;39m 请求参数: []
2021-08-26 07:55:43.406 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85884847905705984 [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-08-26 07:55:43.406 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85884847905705984 [0;39m ==> Parameters: 
2021-08-26 07:55:43.407 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==    Columns: id, parent, name, sort
2021-08-26 07:55:43.408 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 82110017238601728, 100, test2, 1
2021-08-26 07:55:43.408 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 100, 0, 前端开发, 100
2021-08-26 07:55:43.408 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 101, 100, Vue, 101
2021-08-26 07:55:43.408 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 102, 100, HTML & CSS, 102
2021-08-26 07:55:43.408 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 200, 0, Java, 200
2021-08-26 07:55:43.409 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 201, 200, 基础应用, 201
2021-08-26 07:55:43.409 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 202, 200, 框架应用, 202
2021-08-26 07:55:43.409 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 300, 0, Python, 300
2021-08-26 07:55:43.409 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 301, 300, 基础应用, 301
2021-08-26 07:55:43.409 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 302, 300, 进阶方向应用, 302
2021-08-26 07:55:43.409 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 400, 0, 数据库, 400
2021-08-26 07:55:43.410 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 401, 400, MySQL, 401
2021-08-26 07:55:43.410 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 500, 0, 其它, 500
2021-08-26 07:55:43.410 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 501, 500, 服务器, 501
2021-08-26 07:55:43.410 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 502, 500, 开发工具, 502
2021-08-26 07:55:43.410 TRACE c.h.k.mapper.CategoryMapper.selectByExample       :143  [32m85884847905705984 [0;39m <==        Row: 503, 500, 热门服务端语言, 503
2021-08-26 07:55:43.410 DEBUG c.h.k.mapper.CategoryMapper.selectByExample       :137  [32m85884847905705984 [0;39m <==      Total: 16
2021-08-26 07:55:43.411 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :91   [32m85884847905705984 [0;39m 返回结果: {"content":[{"id":82110017238601728,"name":"test2","parent":100,"sort":1},{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"基础应用","parent":300,"sort":301},{"id":302,"name":"进阶方向应用","parent":300,"sort":302},{"id":400,"name":"数据库","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":500,"name":"其它","parent":0,"sort":500},{"id":501,"name":"服务器","parent":500,"sort":501},{"id":502,"name":"开发工具","parent":500,"sort":502},{"id":503,"name":"热门服务端语言","parent":500,"sort":503}],"success":true}
2021-08-26 07:55:43.412 INFO  com.haoyu.knowlagebase.aspect.LogAspect           :92   [32m85884847905705984 [0;39m ------------- 结束 耗时：8 ms -------------
2021-08-26 07:55:45.011 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884854645952512 [0;39m 生成今日电子书快照开始
2021-08-26 07:55:45.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884854645952512 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:55:45.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884854645952512 [0;39m ==> Parameters: 
2021-08-26 07:55:45.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884854645952512 [0;39m <==    Updates: 0
2021-08-26 07:55:45.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884854645952512 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:55:50.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884875600695296 [0;39m 生成今日电子书快照开始
2021-08-26 07:55:50.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884875600695296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:55:50.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884875600695296 [0;39m ==> Parameters: 
2021-08-26 07:55:50.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884875600695296 [0;39m <==    Updates: 0
2021-08-26 07:55:50.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884875600695296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:55:55.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884896597381120 [0;39m 生成今日电子书快照开始
2021-08-26 07:55:55.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884896597381120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:55:55.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884896597381120 [0;39m ==> Parameters: 
2021-08-26 07:55:55.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884896597381120 [0;39m <==    Updates: 0
2021-08-26 07:55:55.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884896597381120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:56:00.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884917568901120 [0;39m 生成今日电子书快照开始
2021-08-26 07:56:00.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884917568901120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:56:00.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884917568901120 [0;39m ==> Parameters: 
2021-08-26 07:56:00.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884917568901120 [0;39m <==    Updates: 0
2021-08-26 07:56:00.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884917568901120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:56:05.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884938544615424 [0;39m 生成今日电子书快照开始
2021-08-26 07:56:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884938544615424 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:56:05.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884938544615424 [0;39m ==> Parameters: 
2021-08-26 07:56:05.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884938544615424 [0;39m <==    Updates: 0
2021-08-26 07:56:05.016 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884938544615424 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:56:05.016 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85884938553004032 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:56:05.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884938553004032 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:56:05.016 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884938553004032 [0;39m ==> Parameters: 
2021-08-26 07:56:05.017 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85884938553004032 [0;39m <==    Updates: 5
2021-08-26 07:56:05.017 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85884938553004032 [0;39m 更新电子书下的文档数据结束，耗时：1毫秒
2021-08-26 07:56:10.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884959511941120 [0;39m 生成今日电子书快照开始
2021-08-26 07:56:10.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884959511941120 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:56:10.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884959511941120 [0;39m ==> Parameters: 
2021-08-26 07:56:10.015 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884959511941120 [0;39m <==    Updates: 0
2021-08-26 07:56:10.015 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884959511941120 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:56:15.007 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85884980458295296 [0;39m 生成今日电子书快照开始
2021-08-26 07:56:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884980458295296 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:56:15.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884980458295296 [0;39m ==> Parameters: 
2021-08-26 07:56:15.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85884980458295296 [0;39m <==    Updates: 0
2021-08-26 07:56:15.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85884980458295296 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:56:20.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85885001450786816 [0;39m 生成今日电子书快照开始
2021-08-26 07:56:20.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885001450786816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:56:20.012 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885001450786816 [0;39m ==> Parameters: 
2021-08-26 07:56:20.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885001450786816 [0;39m <==    Updates: 0
2021-08-26 07:56:20.013 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85885001450786816 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:56:25.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85885022397140992 [0;39m 生成今日电子书快照开始
2021-08-26 07:56:25.006 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885022397140992 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:56:25.007 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885022397140992 [0;39m ==> Parameters: 
2021-08-26 07:56:25.008 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885022397140992 [0;39m <==    Updates: 0
2021-08-26 07:56:25.008 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85885022397140992 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:56:30.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85885043393826816 [0;39m 生成今日电子书快照开始
2021-08-26 07:56:30.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885043393826816 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:56:30.013 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885043393826816 [0;39m ==> Parameters: 
2021-08-26 07:56:30.014 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885043393826816 [0;39m <==    Updates: 0
2021-08-26 07:56:30.014 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85885043393826816 [0;39m 生成今日电子书快照结束，耗时：1毫秒
2021-08-26 07:56:35.004 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85885064331792384 [0;39m 生成今日电子书快照开始
2021-08-26 07:56:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885064331792384 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:56:35.004 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885064331792384 [0;39m ==> Parameters: 
2021-08-26 07:56:35.005 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885064331792384 [0;39m <==    Updates: 0
2021-08-26 07:56:35.006 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85885064331792384 [0;39m 生成今日电子书快照结束，耗时：2毫秒
2021-08-26 07:56:35.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :33   [32m85885064340180992 [0;39m 更新电子书下的文档数据开始
2021-08-26 07:56:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85885064340180992 [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-08-26 07:56:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85885064340180992 [0;39m ==> Parameters: 
2021-08-26 07:56:35.006 DEBUG c.h.k.mapper.DocMapperCust.updateEbookInfo        :137  [32m85885064340180992 [0;39m <==    Updates: 5
2021-08-26 07:56:35.006 INFO  com.haoyu.knowlagebase.job.DocJob                 :36   [32m85885064340180992 [0;39m 更新电子书下的文档数据结束，耗时：0毫秒
2021-08-26 07:56:40.009 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :32   [32m85885085324283904 [0;39m 生成今日电子书快照开始
2021-08-26 07:56:40.009 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885085324283904 [0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2021-08-26 07:56:40.010 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885085324283904 [0;39m ==> Parameters: 
2021-08-26 07:56:40.011 DEBUG c.h.k.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m85885085324283904 [0;39m <==    Updates: 0
2021-08-26 07:56:40.012 INFO  com.haoyu.knowlagebase.job.EbookSnapshotJob       :35   [32m85885085324283904 [0;39m 生成今日电子书快照结束，耗时：3毫秒
